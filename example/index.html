<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Network Visualizer</title>
    <link rel="stylesheet" type="text/css" href="netvis.css" />
    <!-- only for example reasons -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">
</head>
<body>
    <svg id="root"></svg>

    <div class="zoom">
        <div>
            <div id="zoomOut" onclick="network.scale(0.66)" title="Zoom out">&#xe016</div>
            <div id="zoomIn" onclick="network.scale(1.5)" title="Zoom in">&#xe015</div>
        </div>
    </div>

    <div class="selection">
        <a href=".">Personen</a>
        <a href="?n=1">Themen</a>
    </div>

    <script id="detailForm" type="text/x-handlebars-template">
        <h2>
            <button class="close">Ã—</button>
            {{name}}
        </h2>

        {{#image}}<div style="background-image: url({{this}})" class="profile-picture"></div>{{/image}}

        <p>{{{mdDescription}}}</p>

        <!--suppress HtmlUnknownTarget -->
        {{#url}}<a href="{{this}}" target="_blank">{{this}}</a>{{/url}}

        <p class="tag-view">
            {{#each links}}
                <a href="#" class="command" data-cmd="showNodes" data-params="{{this.type}}">{{this.linkTitle}}</a>
            {{/each}}
        </p>
    </script>

    <script src="../dist/bundle.js"></script>

    <!-- Only needed for the example -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.12/handlebars.min.js"
            integrity="sha256-qlku5J3WO/ehJpgXYoJWC2px3+bZquKChi4oIWrAKoI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.8.6/showdown.min.js"
            integrity="sha256-dwhppIrxD8qC6lNulndZgtIm4XBU9zoMd9OUoXzIDAE=" crossorigin="anonymous"></script>
    <script src="./texts.js"></script>

    <script>
      const converter = new showdown.Converter()
      const source = document.getElementById('detailForm').innerHTML
      const detailFormTemplate = Handlebars.compile(source)
      const name = location.search.match(/n=(\w+)/) ? 'data.' + RegExp.$1 + '.json' : 'data.json'
      const network = new Network(name, '#root', {
        nameRequired: function() {
          return Promise.resolve(window.prompt('Name'))
        },
        newNode: function(name) {
          console.log('New node', name)
          return {name, shape: 'circle'}
        },
        nodeRemoved: function(node) {
          console.log('Node removed', node)
        },
        newLink: function(link) {
          console.log('New link', link)
        },
        showDetails: function(data, form, node) {
          return new Promise(resolve => {
            Object.keys(data.links).forEach(function (index) {
              data.links[index].linkTitle = Handlebars.compile(texts.linkTitle)(data.links[index])
            })
            data.mdDescription = converter.makeHtml(data.description || texts['defaultDescription'])
            form.innerHTML = detailFormTemplate(data)
            document.querySelectorAll('.command').forEach(el => {
              el.classList.toggle('active', !el.dataset.visible || !!eval(el.dataset.visible))
              el.addEventListener('click', event => {
                network[event.target.dataset.cmd](node, event.target.dataset.params)
                resolve()
              })
            })
            form.getElementsByClassName('close')[0].addEventListener('click', event => {
              event.preventDefault()
              resolve()
            })
          })
        }
      }, texts)
    </script>

</body>
</html>
