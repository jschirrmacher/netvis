<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Network Visualizer</title>
    <link rel="stylesheet" type="text/css" href="netvis.css" />
    <!-- only for example reasons -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">
</head>
<body>
    <svg id="root"></svg>

    <div class="zoom">
        <div>
            <div id="zoomOut" onclick="network.scale(0.66)" title="Zoom out">&#xe016</div>
            <div id="zoomIn" onclick="network.scale(1.5)" title="Zoom in">&#xe015</div>
        </div>
    </div>

    <div class="selection">
        <a href=".">Personen</a>
        <a href="?n=1">Themen</a>
    </div>

    <script id="detailForm" type="text/x-handlebars-template">
        <h2>
            <button class="close">Ã—</button>
            {{name}}
        </h2>

        <div style="background-image: url({{image}})" class="profile-picture"></div>

        <p>{{description}}</p>

        {{#url}}
            <a href="{{url}}" target="_blank">{{url}}</a>
        {{/url}}

        <p class="tag-view">
            {{#each links}}
                <span class="tag" data-id="{{this.id}}">{{this.name}}</span>
            {{/each}}
        </p>

        <a href="#" class="command" data-visible="!node.open" data-cmd="openNode">Verbindungen einblenden</a><br>
        <a href="#" class="command" data-visible="node.open" data-cmd="closeNode">Verbindungen ausblenden</a>
    </script>

    <script src="//d3js.org/d3.v4.min.js"></script>
    <script src="../dist/Network.js"></script>
    <script src="../dist/ForceDiagram.js"></script>

    <!-- Only needed for the example -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>

    <script>
      const source = document.getElementById('detailForm').innerHTML
      const detailFormTemplate = Handlebars.compile(source)
      const name = location.search.match(/n=(\d+)/) ? 'data.' + RegExp.$1 + '.json' : 'data.json'
      const network = new Network(name, '#root', {
        nameRequired: function() {
          return Promise.resolve(window.prompt('Name'))
        },
        newNode: function(name) {
          console.log('New node', name)
          return {name, shape: 'circle'}
        },
        nodeRemoved: function(node) {
          console.log('Node removed', node)
        },
        newLink: function(link) {
          console.log('New link', link)
        },
        showDetails: function(data, form, node) {
          return new Promise(resolve => {
            form.innerHTML = detailFormTemplate(data)
            document.querySelectorAll('.command').forEach(el => {
              if (el.dataset.visible) {
                el.classList.toggle('active', !!eval(el.dataset.visible))
              }
              el.addEventListener('click', event => {
                network[event.target.dataset.cmd](node)
                resolve()
              })
            })
            form.getElementsByClassName('close')[0].addEventListener('click', event => {
              event.preventDefault()
              resolve()
            })
          })
        }
      })
    </script>

</body>
</html>
