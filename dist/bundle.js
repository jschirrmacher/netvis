var NetVis=function(){'use strict';var ma=Math.PI,ya=Math.exp,fa=Math.atan2,_a=Math.max,xa=Math.round,va=Math.pow,ka=Math.sin,ba=Math.cos,wa=Math.sqrt,za=Math.min;function e(e){var t=e+="",n=t.indexOf(":");return 0<=n&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Aa.hasOwnProperty(t)?{space:Aa[t],local:e}:e}function t(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n==="http://www.w3.org/1999/xhtml"&&t.documentElement.namespaceURI==="http://www.w3.org/1999/xhtml"?t.createElement(e):t.createElementNS(n,e)}}function n(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function a(a){var i=e(a);return(i.local?n:t)(i)}function i(){}function o(e){return null==e?i:function(){return this.querySelector(e)}}function r(e){"function"!=typeof e&&(e=o(e));for(var t=this._groups,a=t.length,r=Array(a),l=0;l<a;++l)for(var s,c,p=t[l],u=p.length,n=r[l]=Array(u),g=0;g<u;++g)(s=p[g])&&(c=e.call(s,s.__data__,g,p))&&("__data__"in s&&(c.__data__=s.__data__),n[g]=c);return new me(r,this._parents)}function l(){return[]}function s(e){return null==e?l:function(){return this.querySelectorAll(e)}}function c(e){return function(){return this.matches(e)}}function p(e){return Array(e.length)}function u(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function g(e){return function(){return e}}// Protect against keys like “__proto__”.
function h(e,t,n,a,o,r){// Put any non-null nodes that fit into update.
// Put any null nodes into enter.
// Put any remaining data into enter.
for(var l,s=0,c=t.length,p=r.length;s<p;++s)(l=t[s])?(l.__data__=r[s],a[s]=l):n[s]=new u(e,r[s]);// Put any non-null nodes that don’t fit into exit.
for(;s<c;++s)(l=t[s])&&(o[s]=l)}function f(e,t,n,a,o,r,l){var s,c,p,g={},h=t.length,m=r.length,y=Array(h);// Compute the key for each node.
// If multiple nodes have the same key, the duplicates are added to exit.
for(s=0;s<h;++s)(c=t[s])&&(y[s]=p="$"+l.call(c,c.__data__,s,t),p in g?o[s]=c:g[p]=c);// Compute the key for each datum.
// If there a node associated with this key, join and add it to update.
// If there is not (or the key is a duplicate), add it to enter.
for(s=0;s<m;++s)p="$"+l.call(e,r[s],s,r),(c=g[p])?(a[s]=c,c.__data__=r[s],g[p]=null):n[s]=new u(e,r[s]);// Add any remaining nodes that were not bound to data to exit.
for(s=0;s<h;++s)(c=t[s])&&g[y[s]]===c&&(o[s]=c)}function _(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function v(e){return function(){this.removeAttribute(e)}}function k(e){return function(){this.removeAttributeNS(e.space,e.local)}}function b(e,t){return function(){this.setAttribute(e,t)}}function w(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function z(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function N(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function j(e){return e.ownerDocument&&e.ownerDocument.defaultView||// node is a Node
e.document&&e// node is a Window
||e.defaultView;// node is a Document
}function S(e){return function(){this.style.removeProperty(e)}}function L(e,t,n){return function(){this.style.setProperty(e,t,n)}}function T(e,t,n){return function(){var a=t.apply(this,arguments);null==a?this.style.removeProperty(e):this.style.setProperty(e,a,n)}}function X(e,t){return e.style.getPropertyValue(t)||j(e).getComputedStyle(e,null).getPropertyValue(t)}function P(e){return function(){delete this[e]}}function R(e,t){return function(){this[e]=t}}function Y(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function O(e){return e.trim().split(/^|\s+/)}function q(e){return e.classList||new V(e)}function V(e){this._node=e,this._names=O(e.getAttribute("class")||"")}function $(e,t){for(var a=q(e),o=-1,r=t.length;++o<r;)a.add(t[o])}function I(e,t){for(var a=q(e),o=-1,r=t.length;++o<r;)a.remove(t[o])}function M(e){return function(){$(this,e)}}function U(e){return function(){I(this,e)}}function G(e,t){return function(){(t.apply(this,arguments)?$:I)(this,e)}}function H(){this.textContent=""}function F(e){return function(){this.textContent=e}}function Z(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function W(){this.innerHTML=""}function Q(e){return function(){this.innerHTML=e}}function J(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function ee(){this.nextSibling&&this.parentNode.appendChild(this)}function te(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ne(){return null}function ae(){var e=this.parentNode;e&&e.removeChild(this)}function ie(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function oe(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}function re(e,t,n){return e=de(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function de(e,t,n){return function(a){var i=ja;// Events can be reentrant (e.g., focus).
ja=a;try{e.call(this,this.__data__,t,n)}finally{ja=i}}}function le(e){return e.trim().split(/^|\s+/).map(function(e){var n="",a=e.indexOf(".");return 0<=a&&(n=e.slice(a+1),e=e.slice(0,a)),{type:e,name:n}})}function se(e){return function(){var t=this.__on;if(t){for(var n,a=0,r=-1,l=t.length;a<l;++a)(n=t[a],(!e.type||n.type===e.type)&&n.name===e.name)?this.removeEventListener(n.type,n.listener,n.capture):t[++r]=n;++r?t.length=r:delete this.__on}}}function ce(e,t,n){var a=Na.hasOwnProperty(e.type)?re:de;return function(r,l,i){var s,c=this.__on,p=a(t,l,i);if(c)for(var u=0,g=c.length;u<g;++u)if((s=c[u]).type===e.type&&s.name===e.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=p,s.capture=n),void(s.value=t);this.addEventListener(e.type,p,n),s={type:e.type,name:e.name,value:t,listener:p,capture:n},c?c.push(s):this.__on=[s]}}function pe(e,t,n,a){var i=ja;e.sourceEvent=ja,ja=e;try{return t.apply(n,a)}finally{ja=i}}function ue(e,t,n){var a=j(e),i=a.CustomEvent;"function"==typeof i?i=new i(t,n):(i=a.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function ge(e,t){return function(){return ue(this,e,t)}}function he(e,t){return function(){return ue(this,e,t.apply(this,arguments))}}function me(e,t){this._groups=e,this._parents=t}function ye(){return new me([[document.documentElement]],Ca)}function fe(e){return"string"==typeof e?new me([[document.querySelector(e)]],[document.documentElement]):new me([[e]],Ca)}function _e(){for(var e,t=ja;e=t.sourceEvent;)t=e;return t}function xe(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var a=n.createSVGPoint();return a.x=t.clientX,a.y=t.clientY,a=a.matrixTransform(e.getScreenCTM().inverse()),[a.x,a.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function ve(e){var t=_e();return t.changedTouches&&(t=t.changedTouches[0]),xe(e,t)}function ke(e,t,a){3>arguments.length&&(a=t,t=_e().changedTouches);for(var o,r=0,l=t?t.length:0;r<l;++r)if((o=t[r]).identifier===a)return xe(e,o);return null}function be(e,t){function n(){var o,r,l=a.length,n=0,s=0;for(o=0;o<l;++o)r=a[o],n+=r.x,s+=r.y;for(n=n/l-e,s=s/l-t,o=0;o<l;++o)r=a[o],r.x-=n,r.y-=s}var a;return null==e&&(e=0),null==t&&(t=0),n.initialize=function(e){a=e},n.x=function(t){return arguments.length?(e=+t,n):e},n.y=function(e){return arguments.length?(t=+e,n):t},n}function we(e){return function(){return e}}function ze(){return 1e-6*(Math.random()-.5)}function Ae(e,t,n,a){if(isNaN(t)||isNaN(n))return e;// ignore invalid points
var o,r,l,s,c,p,u,g,h,m=e._root,y={data:a},f=e._x0,_=e._y0,x=e._x1,v=e._y1;// If the tree is empty, initialize the root as a leaf.
if(!m)return e._root=y,e;// Find the existing leaf for the new point, or add it.
for(;m.length;)if((p=t>=(r=(f+x)/2))?f=r:x=r,(u=n>=(l=(_+v)/2))?_=l:v=l,(o=m,!(m=m[g=u<<1|p])))return o[g]=y,e;// Is the new point is exactly coincident with the existing point?
if(s=+e._x.call(null,m.data),c=+e._y.call(null,m.data),t===s&&n===c)return y.next=m,o?o[g]=y:e._root=y,e;// Otherwise, split the leaf node until the old and new point are separated.
do o=o?o[g]=[,,,,]:e._root=[,,,,],(p=t>=(r=(f+x)/2))?f=r:x=r,(u=n>=(l=(_+v)/2))?_=l:v=l;while((g=u<<1|p)==(h=(c>=l)<<1|s>=r));return o[h]=m,o[g]=y,e}function Ne(e,t,n,a,i){this.node=e,this.x0=t,this.y0=n,this.x1=a,this.y1=i}function je(e){return e[0]}function Se(e){return e[1]}function Ce(e,t,n){var a=new Ee(null==t?je:t,null==n?Se:n,NaN,NaN,NaN,NaN);return null==e?a:a.addAll(e)}function Ee(e,t,n,a,i,o){this._x=e,this._y=t,this._x0=n,this._y0=a,this._x1=i,this._y1=o,this._root=void 0}function Le(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}function Te(e){return e.x+e.vx}function m(e){return e.y+e.vy}function y(e){function t(){function e(e,t,n,a,i){var o=e.data,c=e.r,m=h+c;if(o){if(o.index>p.index){var _=u-o.x-o.vx,v=g-o.y-o.vy,k=_*_+v*v;k<m*m&&(0===_&&(_=ze(),k+=_*_),0===v&&(v=ze(),k+=v*v),k=(m-(k=wa(k)))/k*s,p.vx+=(_*=k)*(m=(c*=c)/(f+c)),p.vy+=(v*=k)*m,o.vx-=_*(m=1-m),o.vy-=v*m)}return}return t>u+m||a<u-m||n>g+m||i<g-m}for(var t,l,p,u,g,h,f,_=o.length,n=0;n<c;++n)for(l=Ce(o,Te,m).visitAfter(a),t=0;t<_;++t)p=o[t],h=r[p.index],f=h*h,u=p.x+p.vx,g=p.y+p.vy,l.visit(e)}function a(e){if(e.data)return e.r=r[e.data.index];for(var t=e.r=0;4>t;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function i(){if(o){var t,a,l=o.length;for(r=Array(l),t=0;t<l;++t)a=o[t],r[a.index]=+e(a,t,o)}}var o,r,s=1,c=1;return"function"!=typeof e&&(e=we(null==e?1:+e)),t.initialize=function(e){o=e,i()},t.iterations=function(e){return arguments.length?(c=+e,t):c},t.strength=function(e){return arguments.length?(s=+e,t):s},t.radius=function(n){return arguments.length?(e="function"==typeof n?n:we(+n),i(),t):e},t}function x(){}function Xe(e,t){var a=new x;// Copy constructor.
if(e instanceof x)e.each(function(e,t){a.set(t,e)});// Index array by numeric index or specified key function.
else if(Array.isArray(e)){var r,l=-1,s=e.length;if(null==t)for(;++l<s;)a.set(l,e[l]);else for(;++l<s;)a.set(t(r=e[l],l,e),r)}// Convert object to map.
else if(e)for(var n in e)a.set(n,e[n]);return a}function De(){}function Pe(e,t){var a=new De;// Copy constructor.
if(e instanceof De)e.each(function(e){a.add(e)});// Otherwise, assume it’s an array.
else if(e){var o=-1,r=e.length;if(null==t)for(;++o<r;)a.add(e[o]);else for(;++o<r;)a.add(t(e[o],o,e))}return a}function Re(e){return e.index}function Ye(e,t){var n=e.get(t);if(!n)throw new Error("missing: "+t);return n}function Oe(e){function t(e){return 1/za(u[e.source.index],u[e.target.index])}function n(t){for(var a=0,o=e.length;a<f;++a)for(var n,r,p,u,h,m,_,v=0;v<o;++v)n=e[v],r=n.source,p=n.target,u=p.x+p.vx-r.x-r.vx||ze(),h=p.y+p.vy-r.y-r.vy||ze(),m=wa(u*u+h*h),m=(m-c[v])/m*t*s[v],u*=m,h*=m,p.vx-=u*(_=g[v]),p.vy-=h*_,r.vx+=u*(_=1-_),r.vy+=h*_}function a(){if(p){var t,a,l=p.length,n=e.length,m=Xe(p,h);for(t=0,u=Array(l);t<n;++t)a=e[t],a.index=t,"object"!=typeof a.source&&(a.source=Ye(m,a.source)),"object"!=typeof a.target&&(a.target=Ye(m,a.target)),u[a.source.index]=(u[a.source.index]||0)+1,u[a.target.index]=(u[a.target.index]||0)+1;for(t=0,g=Array(n);t<n;++t)a=e[t],g[t]=u[a.source.index]/(u[a.source.index]+u[a.target.index]);s=Array(n),o(),c=Array(n),r()}}function o(){if(p)for(var t=0,a=e.length;t<a;++t)s[t]=+l(e[t],t,e)}function r(){if(p)for(var t=0,a=e.length;t<a;++t)c[t]=+m(e[t],t,e)}var s,c,p,u,g,h=Re,l=t,m=we(30),f=1;return null==e&&(e=[]),n.initialize=function(e){p=e,a()},n.links=function(t){return arguments.length?(e=t,a(),n):e},n.id=function(e){return arguments.length?(h=e,n):h},n.iterations=function(e){return arguments.length?(f=+e,n):f},n.strength=function(e){return arguments.length?(l="function"==typeof e?e:we(+e),o(),n):l},n.distance=function(e){return arguments.length?(m="function"==typeof e?e:we(+e),r(),n):m},n}function qe(){for(var e,a=0,o=arguments.length,n={};a<o;++a){if(!(e=arguments[a]+"")||e in n)throw new Error("illegal type: "+e);n[e]=[]}return new Ve(n)}function Ve(e){this._=e}function $e(e,n){return e.trim().split(/^|\s+/).map(function(e){var a="",o=e.indexOf(".");if(0<=o&&(a=e.slice(o+1),e=e.slice(0,o)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:a}})}function Be(e,t){for(var a,o=0,r=e.length;o<r;++o)if((a=e[o]).name===t)return a.value}function Ie(e,t,a){for(var o=0,r=e.length;o<r;++o)if(e[o].name===t){e[o]=Ta,e=e.slice(0,o).concat(e.slice(o+1));break}return null!=a&&e.push({name:t,value:a}),e}function Me(){return qa||(Ba(Ue),qa=$a.now()+Va)}function Ue(){qa=0}function Ge(){this._call=this._time=this._next=null}function He(e,n,a){var i=new Ge;return i.restart(e,n,a),i}function Fe(){Me(),++Pa;for(// Pretend we’ve set an alarm, if we haven’t already.
var n,a=Xa;a;)0<=(n=qa-a._time)&&a._call.call(null,n),a=a._next;--Pa}function Ze(){qa=(Oa=$a.now())+Va,Pa=Ra=0;try{Fe()}finally{Pa=0,Qe(),qa=0}}function We(){var e=$a.now(),t=e-Oa;t>1000&&(Va-=t,Oa=e)}function Qe(){for(var e,t,n=Xa,a=1/0;n;)n._call?(a>n._time&&(a=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Xa=t);Da=e,Ke(a)}function Ke(e){if(!Pa){Ra&&(Ra=clearTimeout(Ra));var t=e-qa;// Strictly less than if we recomputed clockNow.
24<t?(e<1/0&&(Ra=setTimeout(Ze,e-$a.now()-Va)),Ya&&(Ya=clearInterval(Ya))):(!Ya&&(Oa=$a.now(),Ya=setInterval(We,1000)),Pa=1,Ba(Ze))}// Soonest alarm already set, or will be.
}function Je(e,n,a){var i=new Ge;return n=null==n?0:+n,i.restart(function(t){i.stop(),e(t+n)},n,a),i}function et(e){return e.x}function tt(e){return e.y}function nt(e){function t(){n(),h.call("tick",o),r<l&&(g.stop(),h.call("end",o))}function n(t){var a,l,g=e.length;void 0===t&&(t=1);for(var n=0;n<t;++n)for(r+=(c-r)*s,u.each(function(e){e(r)}),a=0;a<g;++a)l=e[a],null==l.fx?l.x+=l.vx*=p:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=p:(l.y=l.fy,l.vy=0);return o}function a(){for(var t,a=0,o=e.length;a<o;++a){if(t=e[a],t.index=a,isNaN(t.fx)||(t.x=t.fx),isNaN(t.fy)||(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var n=10*wa(a),r=a*Ia;t.x=n*ba(r),t.y=n*ka(r)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function i(t){return t.initialize&&t.initialize(e),t}var o,r=1,l=.001,s=1-va(l,1/300),c=0,p=.6,u=Xe(),g=He(t),h=qe("tick","end");return null==e&&(e=[]),a(),o={tick:n,restart:function(){return g.restart(t),o},stop:function(){return g.stop(),o},nodes:function(t){return arguments.length?(e=t,a(),u.each(i),o):e},alpha:function(e){return arguments.length?(r=+e,o):r},alphaMin:function(e){return arguments.length?(l=+e,o):l},alphaDecay:function(e){return arguments.length?(s=+e,o):+s},alphaTarget:function(e){return arguments.length?(c=+e,o):c},velocityDecay:function(e){return arguments.length?(p=1-e,o):1-p},force:function(e,t){return 1<arguments.length?(null==t?u.remove(e):u.set(e,i(t)),o):u.get(e)},find:function(t,a,o){var r,l,s,c,p,u=0,g=e.length;for(null==o?o=1/0:o*=o,u=0;u<g;++u)c=e[u],r=t-c.x,l=a-c.y,s=r*r+l*l,s<o&&(p=c,o=s);return p},on:function(e,t){return 1<arguments.length?(h.on(e,t),o):h.on(e)}}}function at(){function e(e){var t,l=r.length,n=Ce(r,et,tt).visitAfter(a);for(c=e,t=0;t<l;++t)s=r[t],n.visit(o)}function t(){if(r){var e,t,a=r.length;for(p=Array(a),e=0;e<a;++e)t=r[e],p[t.index]=+u(t,e,r)}}function a(e){var n,a,o,r,l,t=Math.abs,s=0,u=0;// For internal nodes, accumulate forces from child quadrants.
if(e.length){for(o=r=l=0;4>l;++l)(n=e[l])&&(a=t(n.value))&&(s+=n.value,u+=a,o+=a*n.x,r+=a*n.y);e.x=o/u,e.y=r/u}// For leaf nodes, accumulate forces from coincident quadrants.
else{n=e,n.x=n.data.x,n.y=n.data.y;do s+=p[n.data.index];while(n=n.next)}e.value=s}function o(e,t,n,a){if(!e.value)return!0;var i=e.x-s.x,o=e.y-s.y,r=a-t,u=i*i+o*o;// Apply the Barnes-Hut approximation if possible.
// Limit forces for very close nodes; randomize direction if coincident.
if(r*r/m<u)return u<h&&(0===i&&(i=ze(),u+=i*i),0===o&&(o=ze(),u+=o*o),u<g&&(u=wa(g*u)),s.vx+=i*e.value*c/u,s.vy+=o*e.value*c/u),!0;// Otherwise, process points directly.
// Limit forces for very close nodes; randomize direction if coincident.
if(!(e.length||u>=h)){(e.data!==s||e.next)&&(0===i&&(i=ze(),u+=i*i),0===o&&(o=ze(),u+=o*o),u<g&&(u=wa(g*u)));do e.data!==s&&(r=p[e.data.index]*c/u,s.vx+=i*r,s.vy+=o*r);while(e=e.next)}}var r,s,c,p,u=we(-30),g=1,h=1/0,m=.81;return e.initialize=function(e){r=e,t()},e.strength=function(n){return arguments.length?(u="function"==typeof n?n:we(+n),t(),e):u},e.distanceMin=function(t){return arguments.length?(g=t*t,e):wa(g)},e.distanceMax=function(t){return arguments.length?(h=t*t,e):wa(h)},e.theta=function(t){return arguments.length?(m=t*t,e):wa(m)},e}function it(e){function t(e){for(var t,l=0,s=a.length;l<s;++l)t=a[l],t.vx+=(r[l]-t.x)*o[l]*e}function n(){if(a){var t,s=a.length;for(o=Array(s),r=Array(s),t=0;t<s;++t)o[t]=isNaN(r[t]=+e(a[t],t,a))?0:+l(a[t],t,a)}}var a,o,r,l=we(.1);return"function"!=typeof e&&(e=we(null==e?0:+e)),t.initialize=function(e){a=e,n()},t.strength=function(e){return arguments.length?(l="function"==typeof e?e:we(+e),n(),t):l},t.x=function(a){return arguments.length?(e="function"==typeof a?a:we(+a),n(),t):e},t}function ot(e){function t(e){for(var t,l=0,s=a.length;l<s;++l)t=a[l],t.vy+=(r[l]-t.y)*o[l]*e}function n(){if(a){var t,s=a.length;for(o=Array(s),r=Array(s),t=0;t<s;++t)o[t]=isNaN(r[t]=+e(a[t],t,a))?0:+l(a[t],t,a)}}var a,o,r,l=we(.1);return"function"!=typeof e&&(e=we(null==e?0:+e)),t.initialize=function(e){a=e,n()},t.strength=function(e){return arguments.length?(l="function"==typeof e?e:we(+e),n(),t):l},t.y=function(a){return arguments.length?(e="function"==typeof a?a:we(+a),n(),t):e},t}function rt(){ja.stopImmediatePropagation()}function dt(){ja.preventDefault(),ja.stopImmediatePropagation()}function lt(e){var t=e.document.documentElement,n=fe(e).on("dragstart.drag",dt,!0);"onselectstart"in t?n.on("selectstart.drag",dt,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function st(e,t){var n=e.document.documentElement,a=fe(e).on("dragstart.drag",null);t&&(a.on("click.drag",dt,!0),setTimeout(function(){a.on("click.drag",null)},0)),"onselectstart"in n?a.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function ct(e){return function(){return e}}function pt(e,t,n,a,i,o,r,l,s,c){this.target=e,this.type=t,this.subject=n,this.identifier=a,this.active=i,this.x=o,this.y=r,this.dx=l,this.dy=s,this._=c}// Ignore right-click, since that should open the context menu.
function ut(){return!ja.button}function gt(){return this.parentNode}function ht(e){return null==e?{x:ja.x,y:ja.y}:e}function mt(){return"ontouchstart"in this}function yt(){function e(e){e.on("mousedown.drag",t).filter(y).on("touchstart.drag",i).on("touchmove.drag",o).on("touchend.drag touchcancel.drag",r).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function t(){if(!u&&g.apply(this,arguments)){var e=l("mouse",h.apply(this,arguments),ve,this,arguments);e&&(fe(ja.view).on("mousemove.drag",n,!0).on("mouseup.drag",a,!0),lt(ja.view),rt(),p=!1,s=ja.clientX,c=ja.clientY,e("start"))}}function n(){if(dt(),!p){var e=ja.clientX-s,t=ja.clientY-c;p=e*e+t*t>v}f.mouse("drag")}function a(){fe(ja.view).on("mousemove.drag mouseup.drag",null),st(ja.view,p),dt(),f.mouse("end")}function i(){if(g.apply(this,arguments)){var e,t,a=ja.changedTouches,o=h.apply(this,arguments),r=a.length;for(e=0;e<r;++e)(t=l(a[e].identifier,o,ke,this,arguments))&&(rt(),t("start"))}}function o(){var e,t,a=ja.changedTouches,o=a.length;for(e=0;e<o;++e)(t=f[a[e].identifier])&&(dt(),t("drag"))}function r(){var e,t,a=ja.changedTouches,o=a.length;// Ghost clicks are delayed!
for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),e=0;e<o;++e)(t=f[a[e].identifier])&&(rt(),t("end"))}function l(t,n,a,i,o){var r,l,c,u=a(n,t),g=_.copy();return pe(new pt(e,"beforestart",r,t,x,u[0],u[1],0,0,g),function(){return null!=(ja.subject=r=m.apply(i,o))&&(l=r.x-u[0]||0,c=r.y-u[1]||0,!0)})?function s(p){var h,m=u;switch(p){case"start":f[t]=s,h=x++;break;case"end":delete f[t],--x;// nobreak
case"drag":u=a(n,t),h=x;}pe(new pt(e,p,r,t,h,u[0]+l,u[1]+c,u[0]-m[0],u[1]-m[1],g),g.apply,g,[p,i,o])}:void 0}var s,c,p,u,g=ut,h=gt,m=ht,y=mt,f={},_=qe("start","drag","end"),x=0,v=0;return e.filter=function(t){return arguments.length?(g="function"==typeof t?t:ct(!!t),e):g},e.container=function(t){return arguments.length?(h="function"==typeof t?t:ct(t),e):h},e.subject=function(t){return arguments.length?(m="function"==typeof t?t:ct(t),e):m},e.touchable=function(t){return arguments.length?(y="function"==typeof t?t:ct(!!t),e):y},e.on=function(){var t=_.on.apply(_,arguments);return t===_?e:t},e.clickDistance=function(t){return arguments.length?(v=(t=+t)*t,e):wa(v)},e}function ft(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function _t(e,t){var n=Object.create(e.prototype);for(var a in t)n[a]=t[a];return n}function xt(){}function vt(e){var t;return e=(e+"").trim().toLowerCase(),(t=Za.exec(e))?(t=parseInt(t[1],16),new At(15&t>>8|240&t>>4,15&t>>4|240&t,(15&t)<<4|15&t,1)// #f00
):(t=Wa.exec(e))?kt(parseInt(t[1],16))// #ff0000
:(t=Qa.exec(e))?new At(t[1],t[2],t[3],1)// rgb(255, 0, 0)
:(t=Ka.exec(e))?new At(255*t[1]/100,255*t[2]/100,255*t[3]/100,1)// rgb(100%, 0%, 0%)
:(t=Ja.exec(e))?bt(t[1],t[2],t[3],t[4])// rgba(255, 0, 0, 1)
:(t=ei.exec(e))?bt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4])// rgb(100%, 0%, 0%, 1)
:(t=ti.exec(e))?jt(t[1],t[2]/100,t[3]/100,1)// hsl(120, 50%, 50%)
:(t=ni.exec(e))?jt(t[1],t[2]/100,t[3]/100,t[4])// hsla(120, 50%, 50%, 1)
:ai.hasOwnProperty(e)?kt(ai[e]):"transparent"===e?new At(NaN,NaN,NaN,0):null}function kt(e){return new At(255&e>>16,255&e>>8,255&e,1)}function bt(e,t,n,i){return 0>=i&&(e=t=n=NaN),new At(e,t,n,i)}function wt(e){return(e instanceof xt||(e=vt(e)),!e)?new At:(e=e.rgb(),new At(e.r,e.g,e.b,e.opacity))}function zt(e,t,n,a){return 1===arguments.length?wt(e):new At(e,t,n,null==a?1:a)}function At(e,t,n,a){this.r=+e,this.g=+t,this.b=+n,this.opacity=+a}function Nt(e){return e=_a(0,za(255,xa(e)||0)),(16>e?"0":"")+e.toString(16)}function jt(e,t,n,i){return 0>=i?e=t=n=NaN:0>=n||1<=n?e=t=NaN:0>=t&&(e=NaN),new Ct(e,t,n,i)}function St(e){if(e instanceof Ct)return new Ct(e.h,e.s,e.l,e.opacity);if(e instanceof xt||(e=vt(e)),!e)return new Ct;if(e instanceof Ct)return e;e=e.rgb();var t=e.r/255,n=e.g/255,a=e.b/255,i=za(t,n,a),r=_a(t,n,a),c=NaN,p=r-i,u=(r+i)/2;return p?(c=t===r?(n-a)/p+6*(n<a):n===r?(a-t)/p+2:(t-n)/p+4,p/=.5>u?r+i:2-r-i,c*=60):p=0<u&&1>u?0:c,new Ct(c,p,u,e.opacity)}function Ct(e,t,n,a){this.h=+e,this.s=+t,this.l=+n,this.opacity=+a}/* From FvD 13.37, CSS Color Module Level 3 */function Et(e,t,n){return 255*(60>e?t+(n-t)*e/60:180>e?n:240>e?t+(n-t)*(240-e)/60:t)}function Lt(e){if(e instanceof Tt)return new Tt(e.l,e.a,e.b,e.opacity);if(e instanceof Ot){if(isNaN(e.h))return new Tt(e.l,0,0,e.opacity);var t=e.h*ii;return new Tt(e.l,ba(t)*e.c,ka(t)*e.c,e.opacity)}e instanceof At||(e=wt(e));var n,a,i=Rt(e.r),r=Rt(e.g),l=Rt(e.b),s=Xt((.2225045*i+.7168786*r+.0606169*l)/1);return i===r&&r===l?n=a=s:(n=Xt((.4360747*i+.3850649*r+.1430804*l)/K),a=Xt((.0139322*i+.0971045*r+.7141733*l)/Xn)),new Tt(116*s-16,500*(n-s),200*(s-a),e.opacity)}function Tt(e,t,n,a){this.l=+e,this.a=+t,this.b=+n,this.opacity=+a}function Xt(e){return e>si?va(e,1/3):e/li+Zn}function Dt(e){return e>di?e*e*e:li*(e-Zn)}function Pt(e){return 255*(.0031308>=e?12.92*e:1.055*va(e,1/2.4)-.055)}function Rt(e){return .04045>=(e/=255)?e/12.92:va((e+.055)/1.055,2.4)}function Yt(e){if(e instanceof Ot)return new Ot(e.h,e.c,e.l,e.opacity);if(e instanceof Tt||(e=Lt(e)),0===e.a&&0===e.b)return new Ot(NaN,0,e.l,e.opacity);var t=fa(e.b,e.a)*oi;return new Ot(0>t?t+360:t,wa(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Ot(e,t,n,a){this.h=+e,this.c=+t,this.l=+n,this.opacity=+a}function qt(e){if(e instanceof Vt)return new Vt(e.h,e.s,e.l,e.opacity);e instanceof At||(e=wt(e));var t=e.r/255,n=e.g/255,a=e.b/255,i=(ui*a+E*t-pi*n)/(ui+E-pi),r=a-i,l=(D*(n-i)-B*r)/C,c=wa(l*l+r*r)/(D*i*(1-i)),// NaN if l=0 or l=1
s=c?fa(l,r)*oi-120:NaN;return new Vt(0>s?s+360:s,c,i,e.opacity)}function Vt(e,t,n,a){this.h=+e,this.s=+t,this.l=+n,this.opacity=+a}function $t(e){return function(){return e}}function Bt(e,n){return function(a){return e+a*n}}function It(e,n,i){return e=va(e,i),n=va(n,i)-e,i=1/i,function(a){return va(e+a*n,i)}}function Mt(e){return 1==(e=+e)?Ut:function(t,n){return n-t?It(t,n,e):$t(isNaN(t)?n:t)}}function Ut(e,t){var n=t-e;return n?Bt(e,n):$t(isNaN(e)?t:e)}function Gt(e,n){return e=+e,n-=e,function(a){return e+n*a}}function Ht(e){return function(){return e}}function Ft(e){return function(n){return e(n)+""}}function Zt(e,n){var// scan index for next number in b
t,// current match in a
o,// current match in b
r,l=_i.lastIndex=xi.lastIndex=0,// string preceding current number in b, if any
c=-1,// index in s
p=[],// string constants and placeholders
s=[];// number interpolators
// Coerce inputs to strings.
// Interpolate pairs of numbers in a & b.
for(e+="",n+="";(t=_i.exec(e))&&(o=xi.exec(n));)(r=o.index)>l&&(r=n.slice(l,r),p[c]?p[c]+=r:// coalesce with previous string
p[++c]=r),(t=t[0])===(o=o[0])?p[c]?p[c]+=o:// coalesce with previous string
p[++c]=o:(p[++c]=null,s.push({i:c,x:Gt(t,o)})),l=xi.lastIndex;// Add remains of b.
// Special optimization for only a single match.
// Otherwise, interpolate each of the numbers and rejoin the string.
return l<n.length&&(r=n.slice(l),p[c]?p[c]+=r:// coalesce with previous string
p[++c]=r),2>p.length?s[0]?Ft(s[0].x):Ht(n):(n=s.length,function(e){for(var t,a=0;a<n;++a)p[(t=s[a]).i]=t.x(e);return p.join("")})}function Wt(t,n,i,o,r,e){var s,p,u,l=Math.atan;return(s=wa(t*t+n*n))&&(t/=s,n/=s),(u=t*i+n*o)&&(i-=t*u,o-=n*u),(p=wa(i*i+o*o))&&(i/=p,o/=p,u/=p),t*o<n*i&&(t=-t,n=-n,u=-u,s=-s),{translateX:r,translateY:e,rotate:fa(n,t)*vi,skewX:l(u)*vi,scaleX:s,scaleY:p}}function Qt(e){return"none"===e?ki:(gi||(gi=document.createElement("DIV"),hi=document.documentElement,mi=document.defaultView),gi.style.transform=e,e=mi.getComputedStyle(hi.appendChild(gi),null).getPropertyValue("transform"),hi.removeChild(gi),e=e.slice(7,-1).split(","),Wt(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function Kt(e){return null==e?ki:(yi||(yi=document.createElementNS("http://www.w3.org/2000/svg","g")),yi.setAttribute("transform",e),!(e=yi.transform.baseVal.consolidate()))?ki:(e=e.matrix,Wt(e.a,e.b,e.c,e.d,e.e,e.f))}function Jt(e,t,n,i){function o(e){return e.length?e.pop()+" ":""}function r(e,a,o,r,l,s){if(e!==o||a!==r){var c=l.push("translate(",null,t,null,n);s.push({i:c-4,x:Gt(e,o)},{i:c-2,x:Gt(a,r)})}else(o||r)&&l.push("translate("+o+t+r+n)}function l(e,t,n,r){e===t?t&&n.push(o(n)+"rotate("+t+i):(180<e-t?t+=360:180<t-e&&(e+=360),r.push({i:n.push(o(n)+"rotate(",null,i)-2,x:Gt(e,t)}))}function c(e,t,n,a){e===t?t&&n.push(o(n)+"skewX("+t+i):a.push({i:n.push(o(n)+"skewX(",null,i)-2,x:Gt(e,t)})}function p(e,t,n,a,r,l){if(e!==n||t!==a){var s=r.push(o(r)+"scale(",null,",",null,")");l.push({i:s-4,x:Gt(e,n)},{i:s-2,x:Gt(t,a)})}else(1!==n||1!==a)&&r.push(o(r)+"scale("+n+","+a+")")}return function(t,n){var u=[],// string constants and placeholders
s=[];// number interpolators
// gc
return t=e(t),n=e(n),r(t.translateX,t.translateY,n.translateX,n.translateY,u,s),l(t.rotate,n.rotate,u,s),c(t.skewX,n.skewX,u,s),p(t.scaleX,t.scaleY,n.scaleX,n.scaleY,u,s),t=n=null,function(e){for(var t,a=-1,r=s.length;++a<r;)u[(t=s[a]).i]=t.x(e);return u.join("")}}}function en(e){return((e=ya(e))+1/e)/2}function tn(e){return((e=ya(e))-1/e)/2}function nn(e){return((e=ya(2*e))-1)/(e+1)}// p0 = [ux0, uy0, w0]
// p1 = [ux1, uy1, w1]
function an(e,t){var a,o,n=Math.log,r=e[0],l=e[1],c=e[2],s=t[0],p=t[1],u=t[2],g=s-r,h=p-l,m=g*g+h*h;// Special case for u0 ≅ u1.
if(m<Ai)o=n(u/c)/zi,a=function(e){return[r+e*g,l+e*h,c*ya(zi*e*o)]};// General case.
else{var y=wa(m),f=(u*u-c*c+4*m)/(2*(2*c)*y),_=(u*u-c*c-4*m)/(2*(2*u)*y),x=n(wa(f*f+1)-f),v=n(wa(_*_+1)-_);o=(v-x)/zi,a=function(e){var t=e*o,n=en(x),a=c/(2*y)*(n*nn(zi*t+x)-tn(x));return[r+a*g,l+a*h,c*n/en(zi*t+x)]}}return a.duration=1e3*o,a}function on(e,t,n,a,i,o){var r=e.__transition;if(!r)e.__transition={};else if(n in r)return;sn(e,n,{name:t,index:a,// For context during callback.
group:i,// For context during callback.
on:Ni,tween:ji,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function rn(e,t){var n=ln(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function dn(e,t){var n=ln(e,t);if(n.state>2)throw new Error("too late; already started");return n}function ln(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function sn(e,t,a){function r(u){var g,h,m,y;// If the state is not SCHEDULED, then we previously errored on start.
if(1!==a.state)return s();for(g in p)if(y=p[g],y.name===a.name){// While this element already has a starting transition during this frame,
// defer starting an interrupting transition until that transition has a
// chance to tick (and possibly end); see d3/d3-transition#54!
if(3===y.state)return Je(r);// Interrupt the active transition, if any.
// Dispatch the interrupt event.
4===y.state?(y.state=6,y.timer.stop(),y.on.call("interrupt",e,e.__data__,y.index,y.group),delete p[g]):+g<t&&(y.state=6,y.timer.stop(),delete p[g])}// Defer the first tick to end of the current frame; see d3/d3#1576.
// Note the transition may be canceled after start and before the first tick!
// Note this must be scheduled before the start event; see d3/d3-transition#16!
// Assuming this is successful, subsequent callbacks go straight to tick.
if(Je(function(){3===a.state&&(a.state=4,a.timer.restart(l,a.delay,a.time),l(u))}),a.state=2,a.on.call("start",e,e.__data__,a.index,a.group),2===a.state){for(a.state=3,c=Array(m=a.tween.length),(g=0,h=-1);g<m;++g)(y=a.tween[g].value.call(e,e.__data__,a.index,a.group))&&(c[++h]=y);c.length=h+1}// interrupted
}function l(o){for(var r=o<a.duration?a.ease.call(null,o/a.duration):(a.timer.restart(s),a.state=5,1),t=-1,l=c.length;++t<l;)c[t].call(null,r);// Dispatch the end event.
a.state===5&&(a.on.call("end",e,e.__data__,a.index,a.group),s())}function s(){for(var n in a.state=6,a.timer.stop(),delete p[t],p)return;// eslint-disable-line no-unused-vars
delete e.__transition}var c,p=e.__transition;// Initialize the self timer when the transition is created.
// Note the actual delay is not known until the first callback!
p[t]=a,a.timer=He(function(e){a.state=1,a.timer.restart(r,a.delay,a.time),a.delay<=e&&r(e-a.delay)},0,a.time)}function cn(e,t){var n,a,o,r=e.__transition,l=!0;if(r){for(o in t=null==t?null:t+"",r){if((n=r[o]).name!==t){l=!1;continue}a=2<n.state&&5>n.state,n.state=6,n.timer.stop(),a&&n.on.call("interrupt",e,e.__data__,n.index,n.group),delete r[o]}l&&delete e.__transition}}function pn(e,t){var a,o;return function(){var r=dn(this,e),l=r.tween;// If this node shared tween with the previous node,
// just assign the updated shared tween and we’re done!
// Otherwise, copy-on-write.
if(l!==a){o=a=l;for(var s=0,c=o.length;s<c;++s)if(o[s].name===t){o=o.slice(),o.splice(s,1);break}}r.tween=o}}function un(e,a,o){var r,l;if("function"!=typeof o)throw new Error;return function(){var s=dn(this,e),c=s.tween;// If this node shared tween with the previous node,
// just assign the updated shared tween and we’re done!
// Otherwise, copy-on-write.
if(c!==r){l=(r=c).slice();for(var p={name:a,value:o},t=0,u=l.length;t<u;++t)if(l[t].name===a){l[t]=p;break}t===u&&l.push(p)}s.tween=l}}function gn(e,a){var o=this._id;if(e+="",2>arguments.length){for(var r,l=ln(this.node(),o).tween,s=0,c=l.length;s<c;++s)if((r=l[s]).name===e)return r.value;return null}return this.each((null==a?pn:un)(o,e,a))}function hn(e,t,n){var a=e._id;return e.each(function(){var e=dn(this,a);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return ln(e,a).value[t]}}function mn(e,t){var n;return("number"==typeof t?Gt:t instanceof vt?fi:(n=vt(t))?(t=n,fi):Zt)(e,t)}function yn(e){return function(){this.removeAttribute(e)}}function fn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function _n(e,t,n){var a,i;return function(){var o=this.getAttribute(e);return o===n?null:o===a?i:i=t(a=o,n)}}function xn(e,t,n){var a,i;return function(){var o=this.getAttributeNS(e.space,e.local);return o===n?null:o===a?i:i=t(a=o,n)}}function vn(e,t,n){var a,i,o;return function(){var r,l=n(this);return null==l?void this.removeAttribute(e):(r=this.getAttribute(e),r===l?null:r===a&&l===i?o:o=t(a=r,i=l))}}function kn(e,t,n){var a,i,o;return function(){var r,l=n(this);return null==l?void this.removeAttributeNS(e.space,e.local):(r=this.getAttributeNS(e.space,e.local),r===l?null:r===a&&l===i?o:o=t(a=r,i=l))}}function bn(e,t){function n(){var n=this,a=t.apply(n,arguments);return a&&function(i){n.setAttributeNS(e.space,e.local,a(i))}}return n._value=t,n}function wn(e,t){function n(){var n=this,a=t.apply(n,arguments);return a&&function(i){n.setAttribute(e,a(i))}}return n._value=t,n}function zn(e,t){return function(){rn(this,e).delay=+t.apply(this,arguments)}}function An(e,t){return t=+t,function(){rn(this,e).delay=t}}function Nn(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?zn:An)(t,e)):ln(this.node(),t).delay}function jn(e,t){return function(){dn(this,e).duration=+t.apply(this,arguments)}}function Sn(e,t){return t=+t,function(){dn(this,e).duration=t}}function Cn(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?jn:Sn)(t,e)):ln(this.node(),t).duration}function En(e,t){if("function"!=typeof t)throw new Error;return function(){dn(this,e).ease=t}}function Ln(e){var t=this._id;return arguments.length?this.each(En(t,e)):ln(this.node(),t).ease}function Tn(e){return(e+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return 0<=n&&(e=e.slice(0,n)),!e||"start"===e})}function Dn(e,t,n){var a,i,o=Tn(t)?rn:dn;return function(){var r=o(this,e),l=r.on;// If this node shared a dispatch with the previous node,
// just assign the updated shared dispatch and we’re done!
// Otherwise, copy-on-write.
l!==a&&(i=(a=l).copy()).on(t,n),r.on=i}}function Pn(e,t){var n=this._id;return 2>arguments.length?ln(this.node(),n).on.on(e):this.each(Dn(n,e,t))}function Rn(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Yn(e){var t=this._name,a=this._id;"function"!=typeof e&&(e=o(e));for(var r=this._groups,l=r.length,s=Array(l),c=0;c<l;++c)for(var p,u,g=r[c],h=g.length,n=s[c]=Array(h),m=0;m<h;++m)(p=g[m])&&(u=e.call(p,p.__data__,m,g))&&("__data__"in p&&(u.__data__=p.__data__),n[m]=u,on(n[m],t,a,m,n,ln(p,a)));return new Gn(s,this._parents,t,a)}function On(e){var t=this._name,a=this._id;"function"!=typeof e&&(e=s(e));for(var o=this._groups,r=o.length,c=[],p=[],u=0;u<r;++u)for(var g,h=o[u],m=h.length,n=0;n<m;++n)if(g=h[n]){for(var y,f=e.call(g,g.__data__,n,h),_=ln(g,a),x=0,v=f.length;x<v;++x)(y=f[x])&&on(y,t,a,x,f,_);c.push(f),p.push(g)}return new Gn(c,p,t,a)}function qn(e,t){var n,a,i;return function(){var o=X(this,e),r=(this.style.removeProperty(e),X(this,e));return o===r?null:o===n&&r===a?i:i=t(n=o,a=r)}}function Vn(e){return function(){this.style.removeProperty(e)}}function $n(e,t,n){var a,i;return function(){var o=X(this,e);return o===n?null:o===a?i:i=t(a=o,n)}}function Bn(e,t,n){var a,i,o;return function(){var r=X(this,e),l=n(this);return null==l&&(l=(this.style.removeProperty(e),X(this,e))),r===l?null:r===a&&l===i?o:o=t(a=r,i=l)}}function In(e,t,n){function a(){var a=this,o=t.apply(a,arguments);return o&&function(i){a.style.setProperty(e,o(i),n)}}return a._value=t,a}function Mn(e){return function(){this.textContent=e}}function Un(e){return function(){var t=e(this);this.textContent=null==t?"":t}}function Gn(e,t,n,a){this._groups=e,this._parents=t,this._name=n,this._id=a}function Hn(){return++Ci}function Fn(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))return Li.time=Me(),Li;return n}function Wn(e){var t,a;e instanceof Gn?(t=e._id,e=e._name):(t=Hn(),(a=Li).time=Me(),e=null==e?null:e+"");for(var o=this._groups,r=o.length,l=0;l<r;++l)for(var s,c=o[l],p=c.length,n=0;n<p;++n)(s=c[n])&&on(s,e,t,n,c,a||Fn(s,t));return new Gn(o,this._parents,e,t)}function Qn(e){return function(){return e}}function Kn(e,t,n){this.target=e,this.type=t,this.transform=n}function Jn(e,t,n){this.k=e,this.x=t,this.y=n}function ea(){ja.stopImmediatePropagation()}function ta(){ja.preventDefault(),ja.stopImmediatePropagation()}// Ignore right-click, since that should open the context menu.
function na(){return!ja.button}function aa(){var t,n,a=this;return a instanceof SVGElement?(a=a.ownerSVGElement||a,t=a.width.baseVal.value,n=a.height.baseVal.value):(t=a.clientWidth,n=a.clientHeight),[[0,0],[t,n]]}function ia(){return this.__zoom||Ti}function oa(){return-ja.deltaY*(ja.deltaMode?120:1)/500}function ra(){return"ontouchstart"in this}function da(e,t,n){var a=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],r=e.invertY(t[1][1])-n[1][1];return e.translate(i>a?(a+i)/2:za(0,a)||_a(0,i),r>o?(o+r)/2:za(0,o)||_a(0,r))}function la(){function e(e){e.property("__zoom",ia).on("wheel.zoom",p).on("mousedown.zoom",u).on("dblclick.zoom",g).filter(z).on("touchstart.zoom",h).on("touchmove.zoom",m).on("touchend.zoom touchcancel.zoom",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function n(e,t){return t=_a(A[0],za(A[1],t)),t===e.k?e:new Jn(t,e.x,e.y)}function a(e,t,n){var a=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return a===e.x&&i===e.y?e:new Jn(e.k,a,i)}function o(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function r(e,t,n){e.on("start.zoom",function(){s(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){s(this,arguments).end()}).tween("zoom",function(){var r=this,l=arguments,c=s(r,l),u=v.apply(r,l),e=n||o(u),p=_a(u[1][0]-u[0][0],u[1][1]-u[0][1]),g=r.__zoom,a="function"==typeof t?t.apply(r,l):t,h=S(g.invert(e).concat(p/g.k),a.invert(e).concat(p/a.k));return function(n){if(1===n)n=a;// Avoid rounding error on end.
else{var i=h(n),o=p/i[2];n=new Jn(o,e[0]-i[0]*o,e[1]-i[1]*o)}c.zoom(null,n)}})}function s(e,t){for(var a,o=0,r=C.length;o<r;++o)if((a=C[o]).that===e)return a;return new c(e,t)}function c(e,t){this.that=e,this.args=t,this.index=-1,this.active=0,this.extent=v.apply(e,t)}function p(){function e(){i.wheel=null,i.end()}if(x.apply(this,arguments)){var i=s(this,arguments),o=this.__zoom,t=_a(A[0],za(A[1],o.k*va(2,w.apply(this,arguments)))),r=ve(this);// If the mouse is in the same location as before, reuse it.
// If there were recent wheel events, reset the wheel idle timeout.
if(i.wheel)(i.mouse[0][0]!==r[0]||i.mouse[0][1]!==r[1])&&(i.mouse[1]=o.invert(i.mouse[0]=r)),clearTimeout(i.wheel);// If this wheel event won’t trigger a transform change, ignore it.
else{if(o.k===t)return;// Otherwise, capture the mouse point and location at the start.
i.mouse=[r,o.invert(r)],cn(this),i.start()}ta(),i.wheel=setTimeout(e,150),i.zoom("mouse",b(a(n(o,t),i.mouse[0],i.mouse[1]),i.extent,N))}}function u(){function e(){if(ta(),!n.moved){var e=ja.clientX-r,t=ja.clientY-l;n.moved=e*e+t*t>L}n.zoom("mouse",b(a(n.that.__zoom,n.mouse[0]=ve(n.that),n.mouse[1]),n.extent,N))}function t(){i.on("mousemove.zoom mouseup.zoom",null),st(ja.view,n.moved),ta(),n.end()}if(!_&&x.apply(this,arguments)){var n=s(this,arguments),i=fe(ja.view).on("mousemove.zoom",e,!0).on("mouseup.zoom",t,!0),o=ve(this),r=ja.clientX,l=ja.clientY;lt(ja.view),ea(),n.mouse=[o,this.__zoom.invert(o)],cn(this),n.start()}}function g(){if(x.apply(this,arguments)){var t=this.__zoom,i=ve(this),o=t.invert(i),l=t.k*(ja.shiftKey?.5:2),s=b(a(n(t,l),i,o),v.apply(this,arguments),N);ta(),0<j?fe(this).transition().duration(j).call(r,s,i):fe(this).call(e.transform,s)}}function h(){if(x.apply(this,arguments)){var e,a,o,r,l=s(this,arguments),c=ja.changedTouches,u=c.length;for(ea(),a=0;a<u;++a)o=c[a],r=ke(this,c,o.identifier),r=[r,this.__zoom.invert(r),o.identifier],l.touch0?!l.touch1&&(l.touch1=r):(l.touch0=r,e=!0);// If this is a dbltap, reroute to the (optional) dblclick.zoom handler.
return f&&(f=clearTimeout(f),!l.touch1)?(l.end(),r=fe(this).on("dblclick.zoom"),void(r&&r.apply(this,arguments))):void(e&&(f=setTimeout(function(){f=null},500),cn(this),l.start()))}}function m(){var e,o,r,c,u=s(this,arguments),g=ja.changedTouches,h=g.length;for(ta(),f&&(f=clearTimeout(f)),e=0;e<h;++e)o=g[e],r=ke(this,g,o.identifier),u.touch0&&u.touch0[2]===o.identifier?u.touch0[0]=r:u.touch1&&u.touch1[2]===o.identifier&&(u.touch1[0]=r);if(o=u.that.__zoom,u.touch1){var m=u.touch0[0],y=u.touch0[1],_=u.touch1[0],x=u.touch1[1],v=(v=_[0]-m[0])*v+(v=_[1]-m[1])*v,k=(k=x[0]-y[0])*k+(k=x[1]-y[1])*k;o=n(o,wa(v/k)),r=[(m[0]+_[0])/2,(m[1]+_[1])/2],c=[(y[0]+x[0])/2,(y[1]+x[1])/2]}else if(u.touch0)r=u.touch0[0],c=u.touch0[1];else return;u.zoom("touch",b(a(o,r,c),u.extent,N))}function y(){var e,a,o=s(this,arguments),r=ja.changedTouches,l=r.length;for(ea(),_&&clearTimeout(_),_=setTimeout(function(){_=null},500),e=0;e<l;++e)a=r[e],o.touch0&&o.touch0[2]===a.identifier?delete o.touch0:o.touch1&&o.touch1[2]===a.identifier&&delete o.touch1;o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0?o.touch0[1]=this.__zoom.invert(o.touch0[0]):o.end()}var f,_,x=na,v=aa,b=da,w=oa,z=ra,A=[0,1/0],N=[[-Infinity,-Infinity],[1/0,1/0]],j=250,S=an,C=[],E=qe("start","zoom","end"),L=0;return e.transform=function(e,t){var n=e.selection?e.selection():e;n.property("__zoom",ia),e===n?n.interrupt().each(function(){s(this,arguments).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()}):r(e,t)},e.scaleBy=function(t,n){e.scaleTo(t,function(){var e=this.__zoom.k,t="function"==typeof n?n.apply(this,arguments):n;return e*t})},e.scaleTo=function(t,i){e.transform(t,function(){var t=v.apply(this,arguments),e=this.__zoom,r=o(t),l=e.invert(r),s="function"==typeof i?i.apply(this,arguments):i;return b(a(n(e,s),r,l),t,N)})},e.translateBy=function(t,n,a){e.transform(t,function(){return b(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof a?a.apply(this,arguments):a),v.apply(this,arguments),N)})},e.translateTo=function(t,n,a){e.transform(t,function(){var i=v.apply(this,arguments),e=this.__zoom,t=o(i);return b(Ti.translate(t[0],t[1]).scale(e.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof a?-a.apply(this,arguments):-a),i,N)})},c.prototype={start:function(){return 1==++this.active&&(this.index=C.push(this)-1,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(C.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(t){pe(new Kn(e,t,this.that.__zoom),E.apply,E,[t,this.that,this.args])}},e.wheelDelta=function(t){return arguments.length?(w="function"==typeof t?t:Qn(+t),e):w},e.filter=function(t){return arguments.length?(x="function"==typeof t?t:Qn(!!t),e):x},e.touchable=function(t){return arguments.length?(z="function"==typeof t?t:Qn(!!t),e):z},e.extent=function(t){return arguments.length?(v="function"==typeof t?t:Qn([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),e):v},e.scaleExtent=function(t){return arguments.length?(A[0]=+t[0],A[1]=+t[1],e):[A[0],A[1]]},e.translateExtent=function(t){return arguments.length?(N[0][0]=+t[0][0],N[1][0]=+t[1][0],N[0][1]=+t[0][1],N[1][1]=+t[1][1],e):[[N[0][0],N[0][1]],[N[1][0],N[1][1]]]},e.constrain=function(t){return arguments.length?(b=t,e):b},e.duration=function(t){return arguments.length?(j=+t,e):j},e.interpolate=function(t){return arguments.length?(S=t,e):S},e.on=function(){var t=E.on.apply(E,arguments);return t===E?e:t},e.clickDistance=function(t){return arguments.length?(L=(t=+t)*t,e):wa(L)},e}function sa(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function ca(e,t){var n=sa(e);return function(a,o){return t(n(a),o,e)}}// Compute unique columns in order of discovery.
function pa(e){var t=Object.create(null),n=[];return e.forEach(function(e){for(var a in e)a in t||n.push(t[a]=a)}),n}function ua(e){function t(e,a){function i(){if(u)return Di;if(g)return g=!1,Xi;// Unescape quotes.
var t,n,a=p;if(34===e.charCodeAt(a)){for(;p++<s&&34!==e.charCodeAt(p)||34===e.charCodeAt(++p););return(t=p)>=s?u=!0:10===(n=e.charCodeAt(p++))?g=!0:13===n&&(g=!0,10===e.charCodeAt(p)&&++p),e.slice(a+1,t-1).replace(/""/g,"\"")}// Find next delimiter or newline.
for(;p<s;){if((n=e.charCodeAt(t=p++))===10)g=!0;else if(n===13)g=!0,10===e.charCodeAt(p)&&++p;else if(n!==o)continue;return e.slice(a,t)}// Return last token before EOF.
return u=!0,e.slice(a,s)}var// current line number
r,l=[],// output rows
s=e.length,p=0,// current character index
c=0,// current token
u=0>=s,// current token followed by EOF?
g=!1;// current token followed by EOL?
// Strip the trailing newline.
for(10===e.charCodeAt(s-1)&&--s,13===e.charCodeAt(s-1)&&--s;(r=i())!==Di;){for(var h=[];r!==Xi&&r!==Di;)h.push(r),r=i();a&&null==(h=a(h,c++))||l.push(h)}return l}function n(t){return t.map(a).join(e)}function a(e){return null==e?"":i.test(e+="")?"\""+e.replace(/"/g,"\"\"")+"\"":e}var i=new RegExp("[\""+e+"\n\r]"),o=e.charCodeAt(0);return{parse:function(e,n){var a,o,r=t(e,function(e,t){return a?a(e,t-1):void(o=e,a=n?ca(e,n):sa(e))});return r.columns=o||[],r},parseRows:t,format:function(t,n){return null==n&&(n=pa(t)),[n.map(a).join(e)].concat(t.map(function(t){return n.map(function(e){return a(t[e])}).join(e)})).join("\n")},formatRows:function(e){return e.map(n).join("\n")}}}function ga(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.json()}function ha(e,t){return fetch(e,t).then(ga)}/*global window*/var Aa={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};u.prototype={constructor:u,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};V.prototype={add:function(e){var t=this._names.indexOf(e);0>t&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);0<=t&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return 0<=this._names.indexOf(e)}};var Na={},ja=null;if("undefined"!=typeof document){var Sa=document.documentElement;"onmouseenter"in Sa||(Na={mouseenter:"mouseover",mouseleave:"mouseout"})}var Ca=[null];me.prototype=ye.prototype={constructor:me,select:r,selectAll:function(e){"function"!=typeof e&&(e=s(e));for(var t=this._groups,a=t.length,o=[],r=[],l=0;l<a;++l)for(var c,p=t[l],u=p.length,n=0;n<u;++n)(c=p[n])&&(o.push(e.call(c,c.__data__,n,p)),r.push(c));return new me(o,r)},filter:function(e){"function"!=typeof e&&(e=c(e));for(var t=this._groups,a=t.length,o=Array(a),r=0;r<a;++r)for(var l,s=t[r],p=s.length,n=o[r]=[],u=0;u<p;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&n.push(l);return new me(o,this._parents)},data:function(e,t){if(!e)return y=Array(this.size()),c=-1,this.each(function(e){y[++c]=e}),y;var n=t?f:h,a=this._parents,i=this._groups;"function"!=typeof e&&(e=g(e));for(var o=i.length,r=Array(o),l=Array(o),s=Array(o),c=0;c<o;++c){var p=a[c],u=i[c],m=u.length,y=e.call(p,p&&p.__data__,c,a),_=y.length,x=l[c]=Array(_),v=r[c]=Array(_),k=s[c]=Array(m);n(p,u,x,v,k,y,t);// Now connect the enter nodes to their following update node, such that
// appendChild can insert the materialized enter node before this node,
// rather than at the end of the parent node.
for(var b,w,z=0,A=0;z<_;++z)if(b=x[z]){for(z>=A&&(A=z+1);!(w=v[A])&&++A<_;);b._next=w||null}}return r=new me(r,a),r._enter=l,r._exit=s,r},enter:function(){return new me(this._enter||this._groups.map(p),this._parents)},exit:function(){return new me(this._exit||this._groups.map(p),this._parents)},join:function(e,t,n){var a=this.enter(),i=this,o=this.exit();return a="function"==typeof e?e(a):a.append(e+""),null!=t&&(i=t(i)),null==n?o.remove():n(o),a&&i?a.merge(i).order():i},merge:function(e){for(var t=this._groups,a=e._groups,o=t.length,r=a.length,l=za(o,r),s=Array(o),c=0;c<l;++c)for(var p,u=t[c],g=a[c],h=u.length,n=s[c]=Array(h),m=0;m<h;++m)(p=u[m]||g[m])&&(n[m]=p);for(;c<o;++c)s[c]=t[c];return new me(s,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var a,o=e[t],r=o.length-1,l=o[r];0<=--r;)(a=o[r])&&(l&&4^a.compareDocumentPosition(l)&&l.parentNode.insertBefore(a,l),l=a);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=_);for(var a=this._groups,o=a.length,r=Array(o),l=0;l<o;++l){for(var s,c=a[l],p=c.length,n=r[l]=Array(p),u=0;u<p;++u)(s=c[u])&&(n[u]=s);n.sort(t)}return new me(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e},node:function(){for(var e=this._groups,t=0,a=e.length;t<a;++t)for(var o,r=e[t],l=0,s=r.length;l<s;++l)if(o=r[l],o)return o;return null},size:function(){var e=0;return this.each(function(){++e}),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,a=0,o=t.length;a<o;++a)for(var r,l=t[a],s=0,c=l.length;s<c;++s)(r=l[s])&&e.call(r,r.__data__,s,l);return this},attr:function(t,n){var a=e(t);if(2>arguments.length){var i=this.node();return a.local?i.getAttributeNS(a.space,a.local):i.getAttribute(a)}return this.each((null==n?a.local?k:v:"function"==typeof n?a.local?N:z:a.local?w:b)(a,n))},style:function(e,t,n){return 1<arguments.length?this.each((null==t?S:"function"==typeof t?T:L)(e,t,null==n?"":n)):X(this.node(),e)},property:function(e,t){return 1<arguments.length?this.each((null==t?P:"function"==typeof t?Y:R)(e,t)):this.node()[e]},classed:function(e,t){var a=O(e+"");if(2>arguments.length){for(var o=q(this.node()),r=-1,l=a.length;++r<l;)if(!o.contains(a[r]))return!1;return!0}return this.each(("function"==typeof t?G:t?M:U)(a,t))},text:function(e){return arguments.length?this.each(null==e?H:("function"==typeof e?Z:F)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?W:("function"==typeof e?J:Q)(e)):this.node().innerHTML},raise:function(){return this.each(ee)},lower:function(){return this.each(te)},append:function(e){var t="function"==typeof e?e:a(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:a(e),i=null==t?ne:"function"==typeof t?t:o(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(ae)},clone:function(e){return this.select(e?oe:ie)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,a,r){var l,s,c=le(e+""),p=c.length;if(2>arguments.length){var n=this.node().__on;if(n)for(var u,g=0,h=n.length;g<h;++g)for(l=0,u=n[g];l<p;++l)if((s=c[l]).type===u.type&&s.name===u.name)return u.value;return}for(n=a?ce:se,null==r&&(r=!1),l=0;l<p;++l)this.each(n(c[l],a,r));return this},dispatch:function(e,t){return this.each(("function"==typeof t?he:ge)(e,t))}};var Ea=Ce.prototype=Ee.prototype;Ea.copy=function(){var e,t,n=new Ee(this._x,this._y,this._x0,this._y0,this._x1,this._y1),a=this._root;if(!a)return n;if(!a.length)return n._root=Le(a),n;for(e=[{source:a,target:n._root=[,,,,]}];a=e.pop();)for(var o=0;4>o;++o)(t=a.source[o])&&(t.length?e.push({source:t,target:a.target[o]=[,,,,]}):a.target[o]=Le(t));return n},Ea.add=function(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return Ae(this.cover(t,n),t,n,e)},Ea.addAll=function(e){var t,a,o,r,l=e.length,n=Array(l),s=Array(l),c=1/0,p=1/0,u=-Infinity,g=-Infinity;// Compute the points and their extent.
for(a=0;a<l;++a)isNaN(o=+this._x.call(null,t=e[a]))||isNaN(r=+this._y.call(null,t))||(n[a]=o,s[a]=r,o<c&&(c=o),o>u&&(u=o),r<p&&(p=r),r>g&&(g=r));// If there were no (valid) points, abort.
if(c>u||p>g)return this;// Expand the tree to cover the new points.
// Add the new points.
for(this.cover(c,p).cover(u,g),a=0;a<l;++a)Ae(this,n[a],s[a],e[a]);return this},Ea.cover=function(e,t){var n=Math.floor;if(isNaN(e=+e)||isNaN(t=+t))return this;// ignore invalid points
var a=this._x0,o=this._y0,r=this._x1,l=this._y1;// If the quadtree has no extent, initialize them.
// Integer extent are necessary so that if we later double the extent,
// the existing quadrant boundaries don’t change due to floating point error!
if(isNaN(a))r=(a=n(e))+1,l=(o=n(t))+1;// Otherwise, double repeatedly to cover.
else{for(var s,c,p=r-a,u=this._root;a>e||e>=r||o>t||t>=l;)c=(t<o)<<1|e<a,s=[,,,,],s[c]=u,u=s,p*=2,0===c?(r=a+p,l=o+p):1===c?(a=r-p,l=o+p):2===c?(r=a+p,o=l-p):3===c?(a=r-p,o=l-p):void 0;this._root&&this._root.length&&(this._root=u)}return this._x0=a,this._y0=o,this._x1=r,this._y1=l,this},Ea.data=function(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e},Ea.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Ea.find=function(e,t,n){var a,o,r,l,s,c,p,u=this._x0,g=this._y0,h=this._x1,m=this._y1,y=[],f=this._root;for(f&&y.push(new Ne(f,u,g,h,m)),null==n?n=1/0:(u=e-n,g=t-n,h=e+n,m=t+n,n*=n);c=y.pop();)// Stop searching if this quadrant can’t contain a closer node.
if(!(!(f=c.node)||(o=c.x0)>h||(r=c.y0)>m||(l=c.x1)<u||(s=c.y1)<g))// Bisect the current quadrant.
if(f.length){var _=(o+l)/2,x=(r+s)/2;y.push(new Ne(f[3],_,x,l,s),new Ne(f[2],o,x,_,s),new Ne(f[1],_,r,l,x),new Ne(f[0],o,r,_,x)),(p=(t>=x)<<1|e>=_)&&(c=y[y.length-1],y[y.length-1]=y[y.length-1-p],y[y.length-1-p]=c)}// Visit this point. (Visiting coincident points isn’t necessary!)
else{var v=e-+this._x.call(null,f.data),k=t-+this._y.call(null,f.data),b=v*v+k*k;if(b<n){var w=wa(n=b);u=e-w,g=t-w,h=e+w,m=t+w,a=f.data}}return a},Ea.remove=function(e){if(isNaN(r=+this._x.call(null,e))||isNaN(l=+this._y.call(null,e)))return this;// ignore invalid points
var t,n,a,o,r,l,s,c,p,u,g,h,m=this._root,f=this._x0,_=this._y0,v=this._x1,k=this._y1;// If the tree is empty, initialize the root as a leaf.
if(!m)return this;// Find the leaf node for the point.
// While descending, also retain the deepest parent with a non-removed sibling.
if(m.length)for(;;){if((p=r>=(s=(f+v)/2))?f=s:v=s,(u=l>=(c=(_+k)/2))?_=c:k=c,(t=m,!(m=m[g=u<<1|p])))return this;if(!m.length)break;(t[3&g+1]||t[3&g+2]||t[3&g+3])&&(n=t,h=g)}// Find the point to remove.
for(;m.data!==e;)if(a=m,!(m=m.next))return this;// If there are multiple coincident points, remove just the point.
return((o=m.next)&&delete m.next,a)?(o?a.next=o:delete a.next,this):t?(o?t[g]=o:delete t[g],(m=t[0]||t[1]||t[2]||t[3])&&m===(t[3]||t[2]||t[1]||t[0])&&!m.length&&(n?n[h]=m:this._root=m),this):(this._root=o,this);// If this is the root point, remove it.
// Remove this leaf.
},Ea.removeAll=function(e){for(var t=0,a=e.length;t<a;++t)this.remove(e[t]);return this},Ea.root=function(){return this._root},Ea.size=function(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e},Ea.visit=function(e){var t,n,a,i,o,r,l=[],s=this._root;for(s&&l.push(new Ne(s,this._x0,this._y0,this._x1,this._y1));t=l.pop();)if(!e(s=t.node,a=t.x0,i=t.y0,o=t.x1,r=t.y1)&&s.length){var c=(a+o)/2,p=(i+r)/2;(n=s[3])&&l.push(new Ne(n,c,p,o,r)),(n=s[2])&&l.push(new Ne(n,a,p,c,r)),(n=s[1])&&l.push(new Ne(n,c,i,o,p)),(n=s[0])&&l.push(new Ne(n,a,i,c,p))}return this},Ea.visitAfter=function(e){var t,n=[],a=[];for(this._root&&n.push(new Ne(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var o,r=t.x0,l=t.y0,s=t.x1,c=t.y1,p=(r+s)/2,u=(l+c)/2;(o=i[0])&&n.push(new Ne(o,r,l,p,u)),(o=i[1])&&n.push(new Ne(o,p,l,s,u)),(o=i[2])&&n.push(new Ne(o,r,u,p,c)),(o=i[3])&&n.push(new Ne(o,p,u,s,c))}a.push(t)}for(;t=a.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},Ea.x=function(e){return arguments.length?(this._x=e,this):this._x},Ea.y=function(e){return arguments.length?(this._y=e,this):this._y};x.prototype=Xe.prototype={constructor:x,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if(e[0]==="$")return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var La=Xe.prototype;De.prototype=Pe.prototype={constructor:De,has:La.has,add:function(e){return e+="",this["$"+e]=e,this},remove:La.remove,clear:La.clear,values:La.keys,size:La.size,empty:La.empty,each:La.each};var Ta={value:function(){}};Ve.prototype=qe.prototype={constructor:Ve,on:function(e,a){var o,r=this._,l=$e(e+"",r),s=-1,c=l.length;// If no callback was specified, return the callback of the given type and name.
if(2>arguments.length){for(;++s<c;)if((o=(e=l[s]).type)&&(o=Be(r[o],e.name)))return o;return}// If a type was specified, set the callback for the given type and name.
// Otherwise, if a null callback was specified, remove callbacks of the given name.
if(null!=a&&"function"!=typeof a)throw new Error("invalid callback: "+a);for(;++s<c;)if(o=(e=l[s]).type)r[o]=Ie(r[o],e.name,a);else if(null==a)for(o in r)r[o]=Ie(r[o],e.name,null);return this},copy:function(){var e={},n=this._;for(var a in n)e[a]=n[a].slice();return new Ve(e)},call:function(e,a){if(0<(o=arguments.length-2))for(var o,r,l=Array(o),s=0;s<o;++s)l[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=this._[e],s=0,o=r.length;s<o;++s)r[s].value.apply(a,l)},apply:function(e,a,o){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],t=0,l=r.length;t<l;++t)r[t].value.apply(a,o)}};var// how frequently we check for clock skew
Xa,Da,Pa=0,// is an animation frame pending?
Ra=0,// is a timeout pending?
Ya=0,Oa=0,qa=0,Va=0,$a="object"==typeof performance&&performance.now?performance:Date,Ba="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};Ge.prototype=He.prototype={constructor:Ge,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Me():+n)+(null==t?0:+t),this._next||Da===this||(Da?Da._next=this:Xa=this,Da=this),this._call=e,this._time=n,Ke()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ke())}};var Ia=ma*(3-wa(5));pt.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var Ma=.7,Ua=1/Ma,Ga="\\s*([+-]?\\d+)\\s*",Ha="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Fa="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Za=/^#([0-9a-f]{3})$/,Wa=/^#([0-9a-f]{6})$/,Qa=new RegExp("^rgb\\("+[Ga,Ga,Ga]+"\\)$"),Ka=new RegExp("^rgb\\("+[Fa,Fa,Fa]+"\\)$"),Ja=new RegExp("^rgba\\("+[Ga,Ga,Ga,Ha]+"\\)$"),ei=new RegExp("^rgba\\("+[Fa,Fa,Fa,Ha]+"\\)$"),ti=new RegExp("^hsl\\("+[Ha,Fa,Fa]+"\\)$"),ni=new RegExp("^hsla\\("+[Ha,Fa,Fa,Ha]+"\\)$"),ai={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ft(xt,vt,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}}),ft(At,zt,_t(xt,{brighter:function(e){return e=null==e?Ua:va(Ua,e),new At(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Ma:va(Ma,e),new At(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&255>=this.r&&0<=this.g&&255>=this.g&&0<=this.b&&255>=this.b&&0<=this.opacity&&1>=this.opacity},hex:function(){return"#"+Nt(this.r)+Nt(this.g)+Nt(this.b)},toString:function(){var e=this.opacity;return e=isNaN(e)?1:_a(0,za(1,e)),(1===e?"rgb(":"rgba(")+_a(0,za(255,xa(this.r)||0))+", "+_a(0,za(255,xa(this.g)||0))+", "+_a(0,za(255,xa(this.b)||0))+(1===e?")":", "+e+")")}})),ft(Ct,function(e,t,n,a){return 1===arguments.length?St(e):new Ct(e,t,n,null==a?1:a)},_t(xt,{brighter:function(e){return e=null==e?Ua:va(Ua,e),new Ct(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Ma:va(Ma,e),new Ct(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(0>this.h),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,a=n+(.5>n?n:1-n)*t,i=2*n-a;return new At(Et(240<=e?e-240:e+120,i,a),Et(e,i,a),Et(120>e?e+240:e-120,i,a),this.opacity)},displayable:function(){return(0<=this.s&&1>=this.s||isNaN(this.s))&&0<=this.l&&1>=this.l&&0<=this.opacity&&1>=this.opacity}}));var ii=ma/180,oi=180/ma,ri=18,K=.96422,Xn=.82521,Zn=4/29,di=6/29,li=3*di*di,si=di*di*di;ft(Tt,function(e,t,n,a){return 1===arguments.length?Lt(e):new Tt(e,t,n,null==a?1:a)},_t(xt,{brighter:function(e){return new Tt(this.l+ri*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Tt(this.l-ri*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=K*Dt(t),e=1*Dt(e),n=Xn*Dt(n),new At(Pt(3.1338561*t-1.6168667*e-.4906146*n),Pt(-.9787684*t+1.9161415*e+.033454*n),Pt(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),ft(Ot,function(e,t,n,a){return 1===arguments.length?Yt(e):new Ot(e,t,n,null==a?1:a)},_t(xt,{brighter:function(e){return new Ot(this.h,this.c,this.l+ri*(null==e?1:e),this.opacity)},darker:function(e){return new Ot(this.h,this.c,this.l-ri*(null==e?1:e),this.opacity)},rgb:function(){return Lt(this).rgb()}}));var ci=-.14861,A=+1.78277,B=-.29227,C=-.90649,D=+1.97294,E=D*C,pi=D*A,ui=A*B-C*ci;ft(Vt,function(e,t,n,a){return 1===arguments.length?qt(e):new Vt(e,t,n,null==a?1:a)},_t(xt,{brighter:function(e){return e=null==e?Ua:va(Ua,e),new Vt(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Ma:va(Ma,e),new Vt(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*ii,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),a=ba(e),i=ka(e);return new At(255*(t+n*(ci*a+A*i)),255*(t+n*(B*a+C*i)),255*(t+n*(D*a)),this.opacity)}}));var gi,hi,mi,yi,fi=function e(t){function n(e,t){var n=a((e=zt(e)).r,(t=zt(t)).r),i=a(e.g,t.g),o=a(e.b,t.b),r=Ut(e.opacity,t.opacity);return function(a){return e.r=n(a),e.g=i(a),e.b=o(a),e.opacity=r(a),e+""}}var a=Mt(t);return n.gamma=e,n}(1),_i=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,xi=new RegExp(_i.source,"g"),vi=180/ma,ki={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},bi=Jt(Qt,"px, ","px)","deg)"),wi=Jt(Kt,", ",")",")"),zi=Math.SQRT2,Ai=1e-12,Ni=qe("start","end","interrupt"),ji=[],Si=ye.prototype.constructor,Ci=0,Ei=ye.prototype;Gn.prototype=function(e){return ye().transition(e)}.prototype={constructor:Gn,select:Yn,selectAll:On,filter:function(e){"function"!=typeof e&&(e=c(e));for(var t=this._groups,a=t.length,o=Array(a),r=0;r<a;++r)for(var l,s=t[r],p=s.length,n=o[r]=[],u=0;u<p;++u)(l=s[u])&&e.call(l,l.__data__,u,s)&&n.push(l);return new Gn(o,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,a=e._groups,o=t.length,r=a.length,l=za(o,r),s=Array(o),c=0;c<l;++c)for(var p,u=t[c],g=a[c],h=u.length,n=s[c]=Array(h),m=0;m<h;++m)(p=u[m]||g[m])&&(n[m]=p);for(;c<o;++c)s[c]=t[c];return new Gn(s,this._parents,this._name,this._id)},selection:function(){return new Si(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,a=Hn(),o=this._groups,r=o.length,l=0;l<r;++l)for(var s,c=o[l],p=c.length,n=0;n<p;++n)if(s=c[n]){var u=ln(s,t);on(s,e,a,n,c,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Gn(o,this._parents,e,a)},call:Ei.call,nodes:Ei.nodes,node:Ei.node,size:Ei.size,empty:Ei.empty,each:Ei.each,on:Pn,attr:function(t,n){var a=e(t),o="transform"===a?wi:mn;return this.attrTween(t,"function"==typeof n?(a.local?kn:vn)(a,o,hn(this,"attr."+t,n)):null==n?(a.local?fn:yn)(a):(a.local?xn:_n)(a,o,n+""))},attrTween:function(t,n){var a="attr."+t;if(2>arguments.length)return(a=this.tween(a))&&a._value;if(null==n)return this.tween(a,null);if("function"!=typeof n)throw new Error;var i=e(t);return this.tween(a,(i.local?bn:wn)(i,n))},style:function(e,t,n){var a="transform"==(e+="")?bi:mn;return null==t?this.styleTween(e,qn(e,a)).on("end.style."+e,Vn(e)):this.styleTween(e,"function"==typeof t?Bn(e,a,hn(this,"style."+e,t)):$n(e,a,t+""),n)},styleTween:function(e,t,n){var a="style."+(e+="");if(2>arguments.length)return(a=this.tween(a))&&a._value;if(null==t)return this.tween(a,null);if("function"!=typeof t)throw new Error;return this.tween(a,In(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?Un(hn(this,"text",e)):Mn(null==e?"":e+""))},remove:function(){return this.on("end.remove",Rn(this._id))},tween:gn,delay:Nn,duration:Cn,ease:Ln};var Li={time:null,// Set on use.
delay:0,duration:250,ease:function(e){return(1>=(e*=2)?e*e*e:(e-=2)*e*e+2)/2}};ye.prototype.interrupt=function(e){return this.each(function(){cn(this,e)})},ye.prototype.transition=Wn,Jn.prototype={constructor:Jn,scale:function(e){return 1===e?this:new Jn(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Jn(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ti=new Jn(1,0,0),Xi={},Di={},Pi=ua(","),Ri=Pi.parse,Yi=Pi.parseRows,Oi=Pi.format,qi=Pi.formatRows,Vi=ua("\t"),$i=Vi.parse,Bi=Vi.parseRows,Ii=Vi.format,Mi=Vi.formatRows;class Ui{constructor(e,t={}){function n(){const e=`translate(${ja.transform.x||0}, ${ja.transform.y||0}) scale(${ja.transform.k||1})`;this.svgGroup.attr("transform",e),this.currentZoom=ja.transform.k,this.handlers.zoom&&this.handlers.zoom(e)}function a(e,t){ja.active||t.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function i(e){e.fx=ja.x,e.fy=ja.y}function o(e,t){ja.active||t.alphaTarget(0),e.fx=void 0,e.fy=void 0}this.options=t,this.links=[],this.nodes=[],this.handlers={},this.svg=fe(e),this.setCenter(),window.addEventListener("resize",()=>this.setCenter()),this.options.nodeRenderer.setup(this.svg),this.svgGroup=this.svg.append("g").attr("id","svgGroup");const r=at(),l=this.options.charge&&this.options.charge(r)||r.strength(-100).distanceMin(1e3),s=y(),c=this.options.collide&&this.options.collide(s)||s.radius(d.radius||d.width/2||50).iterations(2),p=it(this.center.x),u=this.options.forceX&&this.options.forceX(p)||p.strength(.1),g=ot(this.center.y),h=this.options.forceY&&this.options.forceY(g)||g.strength(.1);this.simulation=nt().velocityDecay(this.options.velocityDecay||.55).force("link",Oe().distance(e=>e.distance||100).id(e=>e.id)).force("charge",l).force("collide",c).force("center",be(this.center.x,this.center.y)).force("x",u).force("y",h),this.drag=yt().on("start",e=>a(e,this.simulation)).on("drag",e=>i(e)).on("end",e=>o(e,this.simulation)),this.zoom=la().on("zoom",n.bind(this)),this.svg.call(this.zoom).call(this.drag),this.linkContainer=this.svgGroup.append("g").attr("class","links"),this.nodeContainer=this.svgGroup.append("g").attr("class","nodes"),this.update()}setCenter(){this.center={x:this.svg.node().width.baseVal.value/2,y:this.svg.node().height.baseVal.value/2}}addHandler(e,t){this.handlers[e]=t}update(){function e(){n.attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y).attr("class",e=>"level-"+_a(e.source.level,e.target.level)).attr("stroke-width",e=>e.width||1),i.attr("transform",e=>t.getTransformation.call(t,e)).attr("class",e=>t.getClass.call(t,e))}const t=this.options.nodeRenderer;let n=this.linkContainer.selectAll("line").data(this.links,e=>e.id);const a=n.enter().append("line");n.exit().remove(),n=a.merge(n),this.simulation.force("link").links(this.links);let i=this.nodeContainer.selectAll(".node").data(this.nodes,e=>e.id);const o=i.enter().append("g").attr("id",e=>"node-"+e.id).attr("class",t.getClass.bind(t)).call(this.drag).call(function(e){Object.keys(this.handlers).forEach(t=>e.on(t,this.handlers[t]))}.bind(this));i.exit().remove(),o.call(t.render.bind(t)),i=o.merge(i),this.simulation.nodes(this.nodes).on("tick",()=>e.bind(this)()),this.simulation.alpha(.3),this.simulation.restart()}getLinkedNodes(e){return this.links.filter(t=>t.source.id===e.id).map(e=>e.target).concat(this.links.filter(t=>t.target.id===e.id).map(e=>e.source))}nodesConnected(e,t){return this.getLinkedNodes(e).some(e=>e.id===t.id)}static isConnected(e,t){return e.source.id===t.id||e.target.id===t.id}add(e,t){e&&e.forEach(e=>!this.nodes.some(t=>t.id===e.id)&&this.nodes.push(e)),t&&t.forEach(e=>!this.nodesConnected(e.source,e.target)&&this.links.push(e))}static equalLinks(e,t){return t.source.id===e.source.id&&t.target.id===e.target.id||t.source.id===e.target.id&&t.target.id===e.source.id}remove(e,t){e.forEach(e=>{this.links=this.links.filter(t=>!Ui.isConnected(t,e)),this.nodes=this.nodes.filter(t=>t.id!==e.id)}),this.links=this.links.filter(e=>!t.some(t=>Ui.equalLinks(e,t)))}getConnections(e){return this.links.filter(t=>t.source.id===e.id||t.target.id===e.id)}updateNode(e){e=Object.assign(this.nodes.splice(this.nodes.findIndex(t=>t.id===e.id),1)[0],e),this.update(),this.nodes.push(e)}static fixNode(e){e.fx=e.x,e.fy=e.y}static releaseNode(e){e.fx=void 0,e.fy=void 0}scaleToNode(e,t,n=0,a=0){return new Promise(i=>{Ui.fixNode(e);const o=this.center.x+n,r=this.center.y+a;this.svg.transition().duration(1e3).call(this.zoom.transform,Ti.translate(o,r).scale(t).translate(-e.x,-e.y)).on("end",()=>{Ui.releaseNode(e),i({x:o,y:r})})})}scale(e){return new Promise(t=>{const n=this.svgGroup.node().getAttribute("transform"),a=n&&n.match(/[\d.]+/g).map(e=>+e)||[0,0,1];this.svg.transition().duration(1e3).call(this.zoom.transform,Ti.translate(e*a[0]-(e-1)*this.center.x,e*a[1]-(e-1)*this.center.y).scale(e*this.currentZoom)).on("end",()=>t(!0))})}hide(){this.svg.attr("style","opacity: 0; position: absolute; transition: opacity 0.5s")}show(){this.svg.attr("style","opacity: 1; transition: opacity 0.5s")}static getDomElement(e){return document.getElementById("node-"+e.id)}}class Gi{constructor(e={imageSuppressionLevel:-1,levelSteps:0}){this.options=e}setup(e){this.defs=e.append("defs")}render(e){this.renderCircle(e.filter(e=>"circle"===e.shape)),this.renderRect(e.filter(e=>"rect"===e.shape)),this.renderTitle(e),this.options.showRefLinks&&this.renderRefLinks(e)}renderCircle(e){e.append("circle").attr("r",e=>e.radius||50).attr("fill",this.getBackground.bind(this))}renderRect(e){e.append("rect").attr("x",e=>(e.width||100)/-2).attr("y",e=>(e.width||70)/-2).attr("width",e=>e.width||100).attr("height",e=>e.height||70).attr("fill",this.getBackground.bind(this))}renderTitle(e){e.append("g").classed("title",!0).append("text").text(e=>e.name).call(e=>this.wrap(e,90))}renderRefLinks(e){e.append("g").attr("class","reflinks").selectAll(null).data(e=>{const t=Object.keys(e.links||{}),n=ma/8;return t.map((e,a)=>({type:e,x:70*ba((a-t.length/2)*n),y:70*ka((a-t.length/2)*n)}))}).enter().append("g").attr("transform",e=>`translate(${e.x}, ${e.y})`).attr("data-ref",e=>e.type).append("text").call(this.renderRefLinksContent.bind(this))}renderRefLinksContent(e){e.text(e=>this.options.texts&&this.options.texts[e.type]||e.type).call(e=>this.makeTextBackground(e,15,8))}getBackground(e){const t=0<=this.options.imageSuppressionLevel&&e.level>=this.options.imageSuppressionLevel;return!e.image||t?"#eef":(this.defs.select("#bg-"+e.id).remove(),this.defs.append("pattern").attr("id",()=>"bg-"+e.id).attr("height",1).attr("width",1).append("image").attr("xlink:href",e.image.replace(/ /g,"%20")).attr("height","100px").attr("width","100px").attr("preserveAspectRatio","xMidYMid slice"),"url(#bg-"+e.id+")")}getTransformation(e){const t=this.options.levelSteps?` scale(${1-(e.level||1)*this.options.levelSteps})`:"";return`translate(${[e.x||0,e.y||0]})${t}`}getClass(e){return["node",e.className,e.open&&"open",e.image&&"withBg","level-"+e.level].filter(e=>e).join(" ")}wrap(e,t){const n=this;e.each(function(e){e.fontSize=e.fontSize||1;const a=fe(this),i=(e.name||"").split(/[\s-]+/).reverse();let o,r=[],l=a.text(null).append("tspan").attr("style","font-size: "+14*e.fontSize+"px"),s=0;for(;o=i.pop();)r.push(o),l.text(r.join(" ")),l.node().getComputedTextLength()>t&&(r.pop(),l.text(r.join(" ")),s++,r=[o],l=a.append("tspan").attr("x",0).attr("dy",1.1+"em").text(o).attr("style","font-size: "+14*e.fontSize+"px"));a.attr("y",.3*-s+"em"),n.makeTextBackground(a)})}makeTextBackground(e,t=10,n=5){e.each(function(){const e=document.createElementNS("http://www.w3.org/2000/svg","rect"),a=this.getBBox();e.setAttribute("class","text-bg"),e.setAttribute("x",a.x-5),e.setAttribute("y",a.y-3),e.setAttribute("width",a.width+t),e.setAttribute("height",a.height+n),this.parentNode.insertBefore(e,this)})}}let Hi=1;const Fi=e=>e.reduce((e,t)=>_a(e,t.id),0)+1,Zi={maxLevel:99999,handlers:{error:()=>{}},logger:console};class Wi{constructor(e,t,n={}){"string"==typeof e&&(Zi.logger.warn("Deprecation notice: Using separate parameters for Network constructor is deprecated, use options structure instead."),e={dataUrl:e,domSelector:t,handlers:n}),this.options=Object.assign({},Zi,e),this.options.nodeRenderer=this.options.nodeRenderer||new Gi,ha(this.options.dataUrl,e.fetchOptions).then(e=>this.options.handlers.prepare?this.options.handlers.prepare(e):e).then(e=>{const t=document.querySelector(this.options.domSelector);this.diagram=new Ui(t,this.options),this.options.handlers.showDetails&&(this.details=document.createElement("div"),this.details.setAttribute("class","details"),document.body.append(this.details)),this.options.handlers.clickOnNode=this.options.handlers.clickOnNode||this.showDetails.bind(this),this.options.handlers.clickOnRefLink=this.options.handlers.clickOnRefLink||this.toggleNodes.bind(this),this.nodes=e.nodes,this.links=this.computeLinks(this.nodes);this.links.filter(e=>e.source.open||e.target.open).map(e=>e.source.visible=e.target.visible=!0);const n=this.links.filter(e=>e.source.visible&&e.target.visible),a=this.nodes.filter(e=>e.visible);this.setDistancesToNode(a[0]||this.nodes[0]),this.diagram.add(a,n),this.diagram.update(),setTimeout(()=>{document.body.classList.add("initialized"),this.options.handlers.initialized&&this.options.handlers.initialized()},0)}).catch(e=>this.options.logger.error(e));const a=this;document.addEventListener("click",function(e){if(!1===a.handleClicks(e))return e.stopImmediatePropagation(),e.preventDefault(),!1})}handleClicks(e){const t=e.path||e.composedPath&&e.composedPath()||[],n={reflinks:e=>this.options.handlers.clickOnRefLink(t[e+1].__data__,t[e-1].dataset.ref),node:e=>this.options.handlers.clickOnNode(t[e].__data__)};return!!Object.keys(n).findIndex(e=>{const a=t.findIndex(n=>n.classList&&n.classList.contains(e));return 0<=a&&n[e](a),0<=a})}computeLinks(e){const t=this.options.handlers.prepareLink||(e=>e);return e.forEach(e=>{e.links=e.links||{},e.linkedNodes={}}),e.map(e=>Object.keys(e.links).map(n=>e.links[n]=e.links[n].map(n=>(n=this.getNode(n.target&&n.target.id||n),e.linkedNodes[n.id]=n,n.linkedNodes[e.id]=e,t({id:Hi++,source:e,target:n})))).reduce((e,t)=>e.concat(t),[])).reduce((e,t)=>e.concat(t),[])}setLevel(e,t){e.level>t&&(e.level=t,t<this.options.maxLevel&&Object.values(e.linkedNodes).forEach(e=>this.setLevel(e,t+1)))}setDistancesToNode(e){this.nodes.forEach(e=>e.level=this.options.maxLevel),this.setLevel(e,0)}showDetails(e){Ui.fixNode(e);const t=Ui.getDomElement(e),n=document.createElement("div"),a=document.createElement("div");a.setAttribute("class","detailForm"),n.appendChild(a),this.details.appendChild(n);const i=this.options.detailsDialogOffsetX||-175,o=this.options.detailsDialogOffsetY||-30;this.diagram.scaleToNode(e,1.2,i,o).then(({y:a})=>{document.body.classList.add("dialogOpen"),t.classList.add("menuActive"),this.setDistancesToNode(e),n.setAttribute("style","padding-top: "+(a-123)+"px")}).then(()=>e.details?ha(e.details):e).then(t=>this.options.handlers.showDetails(t,a,e)).catch(this.options.logger.error).then(n=>{e=n||e,document.body.classList.remove("dialogOpen"),t.classList.remove("menuActive"),this.details.innerHTML="",this.diagram.updateNode(e),this.diagram.update()})}toggleNodes(e,t){const n=e.links[t];if(n&&n.length){const t=n.filter(t=>this.diagram.nodesConnected(t.target,e)),a=t.length===n.length;if(a){this.diagram.remove([],n);const e=n.map(e=>e.target).filter(e=>!this.diagram.getConnections(e).length);this.diagram.remove(e,[])}else n.forEach(e=>e.target.visible=!0),this.diagram.add(n.map(e=>e.target),n);this.diagram.update()}}showNodes(e,t){const n=(e.links[t]||[]).filter(e=>!e.target.visible).map(e=>e.target).filter(e=>e.visible=!0);n.length&&(this.diagram.add(n,e.links[t]),this.diagram.update())}getNumberOfVisibleConnections(e){return Object.keys(e.links).reduce((t,n)=>t+e.links[n].filter(e=>e.target.visible).length,0)}hideNodes(e,t){const n=(e.links[t]||[]).map(e=>e.target).filter(e=>e.visible&&1===this.getNumberOfVisibleConnections(e)).filter(e=>!(e.visible=!1));(n.length||e.links[t].length)&&(this.diagram.remove(n,e.links[t]),this.diagram.update())}toggle(e){return e.open?this.closeNode(e):this.openNode(e)}closeNode(e){e.open=!1,this.links.filter(t=>t.source.id===e.id||t.target.id===e.id).forEach(t=>{const n=t.source.id===e.id?t.target:t.source;1===this.diagram.getLinkedNodes(n).length?(n.visible=n.keepVisible,!n.visible&&this.diagram.remove([n],[])):this.diagram.remove([],[t])}),this.diagram.scaleToNode(e,1),this.diagram.update()}openNode(e){e.open=!0,this.links.filter(t=>t.source.id===e.id||t.target.id===e.id).forEach(t=>{const n=t.source.id===e.id?t.target:t.source;n.visible=!0,n.x=e.x,n.y=e.y,this.diagram.add([n],[t])}),this.diagram.scaleToNode(e,1),this.diagram.update()}addNode(e){const t=this.computeLinks([e]);this.nodes.push(e),t.forEach(e=>this.links.push(e)),this.diagram.add([e],t)}removeNode(e){this.nodes=this.nodes.filter(t=>t.id!==e.id),this.links=this.links.filter(t=>t.source.id!==e.id&&t.target.id!==e.id),this.diagram.remove([e],[]),this.diagram.update(),this.options.handlers.nodeRemoved&&this.options.handlers.nodeRemoved(e)}getNode(e){return this.nodes.find(t=>t.id===e)}updateNode(e){this.computeLinks([e]),this.diagram.updateNode(e),this.diagram.update()}scaleToNode(e){this.diagram.scaleToNode(e,1)}addLinks(e){this.diagram.add([],e.map(e=>({id:Hi++,source:this.getNode(e.source.id),target:this.getNode(e.target.id)})).map(e=>(this.links.push(e),e)))}removeLinks(e){const t=(e,t)=>e.source.id===t.source.id&&e.target.id===t.target.id;this.links=this.links.filter(n=>!e.some(e=>t(n,e))),this.diagram.remove([],e)}newConnection(e){this.options.handlers.nameRequired().then(e=>e?e:Promise.reject("no name given")).then(t=>{let n=this.nodes.find(e=>e.name.toLowerCase()===t.toLowerCase());if(n||(n=this.options.handlers.newNode?this.options.handlers.newNode(t):{name:t},n.id=n.id||Fi(this.nodes),this.nodes.push(n),this.diagram.add([n],[])),!this.diagram.nodesConnected(e,n)){const t={id:Hi++,source:e,target:n};this.options.handlers.newLink&&this.options.handlers.newLink(t),this.links.push(t),this.diagram.add([],[t])}this.diagram.update()}).catch(this.options.handlers.error)}update(){this.diagram.update()}scale(e){return this.diagram.scale(e)}}window.ForceDiagram=Ui,window.Network=Wi,window.NodeRenderer=Gi;return{Network:Wi,ForceDiagram:Ui,NodeRenderer:Gi}}();
//# sourceMappingURL=bundle.js.map
