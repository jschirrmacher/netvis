var NetVis=function(){'use strict';var ha=Math.PI,ma=Math.exp,ya=Math.atan2,fa=Math.max,_a=Math.round,xa=Math.pow,va=Math.sin,ka=Math.cos,ba=Math.sqrt,wa=Math.min;function e(e){var t=e+="",n=t.indexOf(":");return 0<=n&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),za.hasOwnProperty(t)?{space:za[t],local:e}:e}function t(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n==="http://www.w3.org/1999/xhtml"&&t.documentElement.namespaceURI==="http://www.w3.org/1999/xhtml"?t.createElement(e):t.createElementNS(n,e)}}function n(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function a(a){var i=e(a);return(i.local?n:t)(i)}function i(){}function o(e){return null==e?i:function(){return this.querySelector(e)}}function r(e){"function"!=typeof e&&(e=o(e));for(var t=this._groups,a=t.length,r=Array(a),d=0;d<a;++d)for(var l,s,c=t[d],p=c.length,n=r[d]=Array(p),u=0;u<p;++u)(l=c[u])&&(s=e.call(l,l.__data__,u,c))&&("__data__"in l&&(s.__data__=l.__data__),n[u]=s);return new me(r,this._parents)}function d(){return[]}function s(e){return null==e?d:function(){return this.querySelectorAll(e)}}function c(e){return function(){return this.matches(e)}}function p(e){return Array(e.length)}function u(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function g(e){return function(){return e}}// Protect against keys like “__proto__”.
function h(e,t,n,a,o,r){// Put any non-null nodes that fit into update.
// Put any null nodes into enter.
// Put any remaining data into enter.
for(var d,l=0,s=t.length,c=r.length;l<c;++l)(d=t[l])?(d.__data__=r[l],a[l]=d):n[l]=new u(e,r[l]);// Put any non-null nodes that don’t fit into exit.
for(;l<s;++l)(d=t[l])&&(o[l]=d)}function f(e,t,n,a,o,r,d){var l,s,c,p={},g=t.length,h=r.length,m=Array(g);// Compute the key for each node.
// If multiple nodes have the same key, the duplicates are added to exit.
for(l=0;l<g;++l)(s=t[l])&&(m[l]=c="$"+d.call(s,s.__data__,l,t),c in p?o[l]=s:p[c]=s);// Compute the key for each datum.
// If there a node associated with this key, join and add it to update.
// If there is not (or the key is a duplicate), add it to enter.
for(l=0;l<h;++l)c="$"+d.call(e,r[l],l,r),(s=p[c])?(a[l]=s,s.__data__=r[l],p[c]=null):n[l]=new u(e,r[l]);// Add any remaining nodes that were not bound to data to exit.
for(l=0;l<g;++l)(s=t[l])&&p[m[l]]===s&&(o[l]=s)}function _(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function v(e){return function(){this.removeAttribute(e)}}function k(e){return function(){this.removeAttributeNS(e.space,e.local)}}function b(e,t){return function(){this.setAttribute(e,t)}}function w(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function z(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function N(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function j(e){return e.ownerDocument&&e.ownerDocument.defaultView||// node is a Node
e.document&&e// node is a Window
||e.defaultView;// node is a Document
}function S(e){return function(){this.style.removeProperty(e)}}function L(e,t,n){return function(){this.style.setProperty(e,t,n)}}function T(e,t,n){return function(){var a=t.apply(this,arguments);null==a?this.style.removeProperty(e):this.style.setProperty(e,a,n)}}function X(e,t){return e.style.getPropertyValue(t)||j(e).getComputedStyle(e,null).getPropertyValue(t)}function P(e){return function(){delete this[e]}}function R(e,t){return function(){this[e]=t}}function O(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Y(e){return e.trim().split(/^|\s+/)}function q(e){return e.classList||new V(e)}function V(e){this._node=e,this._names=Y(e.getAttribute("class")||"")}function $(e,t){for(var a=q(e),o=-1,r=t.length;++o<r;)a.add(t[o])}function I(e,t){for(var a=q(e),o=-1,r=t.length;++o<r;)a.remove(t[o])}function M(e){return function(){$(this,e)}}function U(e){return function(){I(this,e)}}function G(e,t){return function(){(t.apply(this,arguments)?$:I)(this,e)}}function H(){this.textContent=""}function F(e){return function(){this.textContent=e}}function Z(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function W(){this.innerHTML=""}function Q(e){return function(){this.innerHTML=e}}function J(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function ee(){this.nextSibling&&this.parentNode.appendChild(this)}function te(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ne(){return null}function ae(){var e=this.parentNode;e&&e.removeChild(this)}function ie(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function oe(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}function re(e,t,n){return e=de(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function de(e,t,n){return function(a){var i=Aa;// Events can be reentrant (e.g., focus).
Aa=a;try{e.call(this,this.__data__,t,n)}finally{Aa=i}}}function le(e){return e.trim().split(/^|\s+/).map(function(e){var n="",a=e.indexOf(".");return 0<=a&&(n=e.slice(a+1),e=e.slice(0,a)),{type:e,name:n}})}function se(e){return function(){var t=this.__on;if(t){for(var n,a=0,r=-1,d=t.length;a<d;++a)(n=t[a],(!e.type||n.type===e.type)&&n.name===e.name)?this.removeEventListener(n.type,n.listener,n.capture):t[++r]=n;++r?t.length=r:delete this.__on}}}function ce(e,t,n){var a=Na.hasOwnProperty(e.type)?re:de;return function(r,d,i){var l,s=this.__on,c=a(t,d,i);if(s)for(var p=0,u=s.length;p<u;++p)if((l=s[p]).type===e.type&&l.name===e.name)return this.removeEventListener(l.type,l.listener,l.capture),this.addEventListener(l.type,l.listener=c,l.capture=n),void(l.value=t);this.addEventListener(e.type,c,n),l={type:e.type,name:e.name,value:t,listener:c,capture:n},s?s.push(l):this.__on=[l]}}function pe(e,t,n,a){var i=Aa;e.sourceEvent=Aa,Aa=e;try{return t.apply(n,a)}finally{Aa=i}}function ue(e,t,n){var a=j(e),i=a.CustomEvent;"function"==typeof i?i=new i(t,n):(i=a.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function ge(e,t){return function(){return ue(this,e,t)}}function he(e,t){return function(){return ue(this,e,t.apply(this,arguments))}}function me(e,t){this._groups=e,this._parents=t}function ye(){return new me([[document.documentElement]],Sa)}function fe(e){return"string"==typeof e?new me([[document.querySelector(e)]],[document.documentElement]):new me([[e]],Sa)}function _e(){for(var e,t=Aa;e=t.sourceEvent;)t=e;return t}function xe(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var a=n.createSVGPoint();return a.x=t.clientX,a.y=t.clientY,a=a.matrixTransform(e.getScreenCTM().inverse()),[a.x,a.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function ve(e){var t=_e();return t.changedTouches&&(t=t.changedTouches[0]),xe(e,t)}function ke(e,t,a){3>arguments.length&&(a=t,t=_e().changedTouches);for(var o,r=0,d=t?t.length:0;r<d;++r)if((o=t[r]).identifier===a)return xe(e,o);return null}function be(e,t){function n(){var o,r,d=a.length,n=0,l=0;for(o=0;o<d;++o)r=a[o],n+=r.x,l+=r.y;for(n=n/d-e,l=l/d-t,o=0;o<d;++o)r=a[o],r.x-=n,r.y-=l}var a;return null==e&&(e=0),null==t&&(t=0),n.initialize=function(e){a=e},n.x=function(t){return arguments.length?(e=+t,n):e},n.y=function(e){return arguments.length?(t=+e,n):t},n}function we(e){return function(){return e}}function ze(){return 1e-6*(Math.random()-.5)}function Ne(e,t,n,a){if(isNaN(t)||isNaN(n))return e;// ignore invalid points
var o,r,d,l,s,c,p,u,g,h=e._root,m={data:a},y=e._x0,f=e._y0,_=e._x1,x=e._y1;// If the tree is empty, initialize the root as a leaf.
if(!h)return e._root=m,e;// Find the existing leaf for the new point, or add it.
for(;h.length;)if((c=t>=(r=(y+_)/2))?y=r:_=r,(p=n>=(d=(f+x)/2))?f=d:x=d,(o=h,!(h=h[u=p<<1|c])))return o[u]=m,e;// Is the new point is exactly coincident with the existing point?
if(l=+e._x.call(null,h.data),s=+e._y.call(null,h.data),t===l&&n===s)return m.next=h,o?o[u]=m:e._root=m,e;// Otherwise, split the leaf node until the old and new point are separated.
do o=o?o[u]=[,,,,]:e._root=[,,,,],(c=t>=(r=(y+_)/2))?y=r:_=r,(p=n>=(d=(f+x)/2))?f=d:x=d;while((u=p<<1|c)==(g=(s>=d)<<1|l>=r));return o[g]=h,o[u]=m,e}function Ae(e,t,n,a,i){this.node=e,this.x0=t,this.y0=n,this.x1=a,this.y1=i}function je(e){return e[0]}function Se(e){return e[1]}function Ce(e,t,n){var a=new Ee(null==t?je:t,null==n?Se:n,NaN,NaN,NaN,NaN);return null==e?a:a.addAll(e)}function Ee(e,t,n,a,i,o){this._x=e,this._y=t,this._x0=n,this._y0=a,this._x1=i,this._y1=o,this._root=void 0}function Le(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}function Te(e){return e.x+e.vx}function l(e){return e.y+e.vy}function m(e){function t(){function e(e,t,n,a,i){var o=e.data,s=e.r,c=h+s;if(o){if(o.index>p.index){var f=u-o.x-o.vx,_=g-o.y-o.vy,v=f*f+_*_;v<c*c&&(0===f&&(f=ze(),v+=f*f),0===_&&(_=ze(),v+=_*_),v=(c-(v=ba(v)))/v*d,p.vx+=(f*=v)*(c=(s*=s)/(m+s)),p.vy+=(_*=v)*c,o.vx-=f*(c=1-c),o.vy-=_*c)}return}return t>u+c||a<u-c||n>g+c||i<g-c}for(var t,c,p,u,g,h,m,y=o.length,n=0;n<s;++n)for(c=Ce(o,Te,l).visitAfter(a),t=0;t<y;++t)p=o[t],h=r[p.index],m=h*h,u=p.x+p.vx,g=p.y+p.vy,c.visit(e)}function a(e){if(e.data)return e.r=r[e.data.index];for(var t=e.r=0;4>t;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function i(){if(o){var t,a,d=o.length;for(r=Array(d),t=0;t<d;++t)a=o[t],r[a.index]=+e(a,t,o)}}var o,r,d=1,s=1;return"function"!=typeof e&&(e=we(null==e?1:+e)),t.initialize=function(e){o=e,i()},t.iterations=function(e){return arguments.length?(s=+e,t):s},t.strength=function(e){return arguments.length?(d=+e,t):d},t.radius=function(n){return arguments.length?(e="function"==typeof n?n:we(+n),i(),t):e},t}function y(){}function x(e,t){var a=new y;// Copy constructor.
if(e instanceof y)e.each(function(e,t){a.set(t,e)});// Index array by numeric index or specified key function.
else if(Array.isArray(e)){var r,d=-1,l=e.length;if(null==t)for(;++d<l;)a.set(d,e[d]);else for(;++d<l;)a.set(t(r=e[d],d,e),r)}// Convert object to map.
else if(e)for(var n in e)a.set(n,e[n]);return a}function De(){}function Xe(e,t){var a=new De;// Copy constructor.
if(e instanceof De)e.each(function(e){a.add(e)});// Otherwise, assume it’s an array.
else if(e){var o=-1,r=e.length;if(null==t)for(;++o<r;)a.add(e[o]);else for(;++o<r;)a.add(t(e[o],o,e))}return a}function Pe(e){return e.index}function Re(e,t){var n=e.get(t);if(!n)throw new Error("missing: "+t);return n}function Oe(e){function t(e){return 1/wa(p[e.source.index],p[e.target.index])}function n(t){for(var a=0,o=e.length;a<m;++a)for(var n,r,c,p,g,h,f,_=0;_<o;++_)n=e[_],r=n.source,c=n.target,p=c.x+c.vx-r.x-r.vx||ze(),g=c.y+c.vy-r.y-r.vy||ze(),h=ba(p*p+g*g),h=(h-s[_])/h*t*d[_],p*=h,g*=h,c.vx-=p*(f=u[_]),c.vy-=g*f,r.vx+=p*(f=1-f),r.vy+=g*f}function a(){if(c){var t,a,l=c.length,n=e.length,h=x(c,g);for(t=0,p=Array(l);t<n;++t)a=e[t],a.index=t,"object"!=typeof a.source&&(a.source=Re(h,a.source)),"object"!=typeof a.target&&(a.target=Re(h,a.target)),p[a.source.index]=(p[a.source.index]||0)+1,p[a.target.index]=(p[a.target.index]||0)+1;for(t=0,u=Array(n);t<n;++t)a=e[t],u[t]=p[a.source.index]/(p[a.source.index]+p[a.target.index]);d=Array(n),o(),s=Array(n),r()}}function o(){if(c)for(var t=0,a=e.length;t<a;++t)d[t]=+l(e[t],t,e)}function r(){if(c)for(var t=0,a=e.length;t<a;++t)s[t]=+h(e[t],t,e)}var d,s,c,p,u,g=Pe,l=t,h=we(30),m=1;return null==e&&(e=[]),n.initialize=function(e){c=e,a()},n.links=function(t){return arguments.length?(e=t,a(),n):e},n.id=function(e){return arguments.length?(g=e,n):g},n.iterations=function(e){return arguments.length?(m=+e,n):m},n.strength=function(e){return arguments.length?(l="function"==typeof e?e:we(+e),o(),n):l},n.distance=function(e){return arguments.length?(h="function"==typeof e?e:we(+e),r(),n):h},n}function Ye(){for(var e,a=0,o=arguments.length,n={};a<o;++a){if(!(e=arguments[a]+"")||e in n)throw new Error("illegal type: "+e);n[e]=[]}return new qe(n)}function qe(e){this._=e}function Ve(e,n){return e.trim().split(/^|\s+/).map(function(e){var a="",o=e.indexOf(".");if(0<=o&&(a=e.slice(o+1),e=e.slice(0,o)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:a}})}function $e(e,t){for(var a,o=0,r=e.length;o<r;++o)if((a=e[o]).name===t)return a.value}function Be(e,t,a){for(var o=0,r=e.length;o<r;++o)if(e[o].name===t){e[o]=La,e=e.slice(0,o).concat(e.slice(o+1));break}return null!=a&&e.push({name:t,value:a}),e}function Ie(){return Ya||($a(Me),Ya=Va.now()+qa)}function Me(){Ya=0}function Ue(){this._call=this._time=this._next=null}function Ge(e,n,a){var i=new Ue;return i.restart(e,n,a),i}function He(){Ie(),++Xa;for(// Pretend we’ve set an alarm, if we haven’t already.
var n,a=Ta;a;)0<=(n=Ya-a._time)&&a._call.call(null,n),a=a._next;--Xa}function Fe(){Ya=(Oa=Va.now())+qa,Xa=Pa=0;try{He()}finally{Xa=0,We(),Ya=0}}function Ze(){var e=Va.now(),t=e-Oa;t>1000&&(qa-=t,Oa=e)}function We(){for(var e,t,n=Ta,a=1/0;n;)n._call?(a>n._time&&(a=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Ta=t);Da=e,Qe(a)}function Qe(e){if(!Xa){Pa&&(Pa=clearTimeout(Pa));var t=e-Ya;// Strictly less than if we recomputed clockNow.
24<t?(e<1/0&&(Pa=setTimeout(Fe,e-Va.now()-qa)),Ra&&(Ra=clearInterval(Ra))):(!Ra&&(Oa=Va.now(),Ra=setInterval(Ze,1000)),Xa=1,$a(Fe))}// Soonest alarm already set, or will be.
}function Ke(e,n,a){var i=new Ue;return n=null==n?0:+n,i.restart(function(t){i.stop(),e(t+n)},n,a),i}function Je(e){return e.x}function et(e){return e.y}function tt(e){function t(){n(),g.call("tick",o),r<d&&(u.stop(),g.call("end",o))}function n(t){var a,d,u=e.length;void 0===t&&(t=1);for(var n=0;n<t;++n)for(r+=(s-r)*l,p.each(function(e){e(r)}),a=0;a<u;++a)d=e[a],null==d.fx?d.x+=d.vx*=c:(d.x=d.fx,d.vx=0),null==d.fy?d.y+=d.vy*=c:(d.y=d.fy,d.vy=0);return o}function a(){for(var t,a=0,o=e.length;a<o;++a){if(t=e[a],t.index=a,isNaN(t.fx)||(t.x=t.fx),isNaN(t.fy)||(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var n=10*ba(a),r=a*Ba;t.x=n*ka(r),t.y=n*va(r)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function i(t){return t.initialize&&t.initialize(e),t}var o,r=1,d=.001,l=1-xa(d,1/300),s=0,c=.6,p=x(),u=Ge(t),g=Ye("tick","end");return null==e&&(e=[]),a(),o={tick:n,restart:function(){return u.restart(t),o},stop:function(){return u.stop(),o},nodes:function(t){return arguments.length?(e=t,a(),p.each(i),o):e},alpha:function(e){return arguments.length?(r=+e,o):r},alphaMin:function(e){return arguments.length?(d=+e,o):d},alphaDecay:function(e){return arguments.length?(l=+e,o):+l},alphaTarget:function(e){return arguments.length?(s=+e,o):s},velocityDecay:function(e){return arguments.length?(c=1-e,o):1-c},force:function(e,t){return 1<arguments.length?(null==t?p.remove(e):p.set(e,i(t)),o):p.get(e)},find:function(t,a,o){var r,d,l,s,c,p=0,u=e.length;for(null==o?o=1/0:o*=o,p=0;p<u;++p)s=e[p],r=t-s.x,d=a-s.y,l=r*r+d*d,l<o&&(c=s,o=l);return c},on:function(e,t){return 1<arguments.length?(g.on(e,t),o):g.on(e)}}}function nt(){function e(e){var t,l=r.length,n=Ce(r,Je,et).visitAfter(a);for(s=e,t=0;t<l;++t)d=r[t],n.visit(o)}function t(){if(r){var e,t,a=r.length;for(c=Array(a),e=0;e<a;++e)t=r[e],c[t.index]=+p(t,e,r)}}function a(e){var n,a,o,r,d,t=Math.abs,l=0,s=0;// For internal nodes, accumulate forces from child quadrants.
if(e.length){for(o=r=d=0;4>d;++d)(n=e[d])&&(a=t(n.value))&&(l+=n.value,s+=a,o+=a*n.x,r+=a*n.y);e.x=o/s,e.y=r/s}// For leaf nodes, accumulate forces from coincident quadrants.
else{n=e,n.x=n.data.x,n.y=n.data.y;do l+=c[n.data.index];while(n=n.next)}e.value=l}function o(e,t,n,a){if(!e.value)return!0;var i=e.x-d.x,o=e.y-d.y,r=a-t,p=i*i+o*o;// Apply the Barnes-Hut approximation if possible.
// Limit forces for very close nodes; randomize direction if coincident.
if(r*r/h<p)return p<g&&(0===i&&(i=ze(),p+=i*i),0===o&&(o=ze(),p+=o*o),p<u&&(p=ba(u*p)),d.vx+=i*e.value*s/p,d.vy+=o*e.value*s/p),!0;// Otherwise, process points directly.
// Limit forces for very close nodes; randomize direction if coincident.
if(!(e.length||p>=g)){(e.data!==d||e.next)&&(0===i&&(i=ze(),p+=i*i),0===o&&(o=ze(),p+=o*o),p<u&&(p=ba(u*p)));do e.data!==d&&(r=c[e.data.index]*s/p,d.vx+=i*r,d.vy+=o*r);while(e=e.next)}}var r,d,s,c,p=we(-30),u=1,g=1/0,h=.81;return e.initialize=function(e){r=e,t()},e.strength=function(n){return arguments.length?(p="function"==typeof n?n:we(+n),t(),e):p},e.distanceMin=function(t){return arguments.length?(u=t*t,e):ba(u)},e.distanceMax=function(t){return arguments.length?(g=t*t,e):ba(g)},e.theta=function(t){return arguments.length?(h=t*t,e):ba(h)},e}function at(e){function t(e){for(var t,d=0,l=a.length;d<l;++d)t=a[d],t.vx+=(r[d]-t.x)*o[d]*e}function n(){if(a){var t,l=a.length;for(o=Array(l),r=Array(l),t=0;t<l;++t)o[t]=isNaN(r[t]=+e(a[t],t,a))?0:+d(a[t],t,a)}}var a,o,r,d=we(.1);return"function"!=typeof e&&(e=we(null==e?0:+e)),t.initialize=function(e){a=e,n()},t.strength=function(e){return arguments.length?(d="function"==typeof e?e:we(+e),n(),t):d},t.x=function(a){return arguments.length?(e="function"==typeof a?a:we(+a),n(),t):e},t}function it(e){function t(e){for(var t,d=0,l=a.length;d<l;++d)t=a[d],t.vy+=(r[d]-t.y)*o[d]*e}function n(){if(a){var t,l=a.length;for(o=Array(l),r=Array(l),t=0;t<l;++t)o[t]=isNaN(r[t]=+e(a[t],t,a))?0:+d(a[t],t,a)}}var a,o,r,d=we(.1);return"function"!=typeof e&&(e=we(null==e?0:+e)),t.initialize=function(e){a=e,n()},t.strength=function(e){return arguments.length?(d="function"==typeof e?e:we(+e),n(),t):d},t.y=function(a){return arguments.length?(e="function"==typeof a?a:we(+a),n(),t):e},t}function ot(){Aa.stopImmediatePropagation()}function rt(){Aa.preventDefault(),Aa.stopImmediatePropagation()}function dt(e){var t=e.document.documentElement,n=fe(e).on("dragstart.drag",rt,!0);"onselectstart"in t?n.on("selectstart.drag",rt,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function lt(e,t){var n=e.document.documentElement,a=fe(e).on("dragstart.drag",null);t&&(a.on("click.drag",rt,!0),setTimeout(function(){a.on("click.drag",null)},0)),"onselectstart"in n?a.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function st(e){return function(){return e}}function ct(e,t,n,a,i,o,r,d,l,s){this.target=e,this.type=t,this.subject=n,this.identifier=a,this.active=i,this.x=o,this.y=r,this.dx=d,this.dy=l,this._=s}// Ignore right-click, since that should open the context menu.
function pt(){return!Aa.button}function ut(){return this.parentNode}function gt(e){return null==e?{x:Aa.x,y:Aa.y}:e}function ht(){return"ontouchstart"in this}function mt(){function e(e){e.on("mousedown.drag",t).filter(m).on("touchstart.drag",i).on("touchmove.drag",o).on("touchend.drag touchcancel.drag",r).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function t(){if(!p&&u.apply(this,arguments)){var e=d("mouse",g.apply(this,arguments),ve,this,arguments);e&&(fe(Aa.view).on("mousemove.drag",n,!0).on("mouseup.drag",a,!0),dt(Aa.view),ot(),c=!1,l=Aa.clientX,s=Aa.clientY,e("start"))}}function n(){if(rt(),!c){var e=Aa.clientX-l,t=Aa.clientY-s;c=e*e+t*t>x}y.mouse("drag")}function a(){fe(Aa.view).on("mousemove.drag mouseup.drag",null),lt(Aa.view,c),rt(),y.mouse("end")}function i(){if(u.apply(this,arguments)){var e,t,a=Aa.changedTouches,o=g.apply(this,arguments),r=a.length;for(e=0;e<r;++e)(t=d(a[e].identifier,o,ke,this,arguments))&&(ot(),t("start"))}}function o(){var e,t,a=Aa.changedTouches,o=a.length;for(e=0;e<o;++e)(t=y[a[e].identifier])&&(rt(),t("drag"))}function r(){var e,t,a=Aa.changedTouches,o=a.length;// Ghost clicks are delayed!
for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),e=0;e<o;++e)(t=y[a[e].identifier])&&(ot(),t("end"))}function d(t,n,a,i,o){var r,d,l,c=a(n,t),u=f.copy();return pe(new ct(e,"beforestart",r,t,_,c[0],c[1],0,0,u),function(){return null!=(Aa.subject=r=h.apply(i,o))&&(d=r.x-c[0]||0,l=r.y-c[1]||0,!0)})?function s(p){var g,h=c;switch(p){case"start":y[t]=s,g=_++;break;case"end":delete y[t],--_;// nobreak
case"drag":c=a(n,t),g=_;}pe(new ct(e,p,r,t,g,c[0]+d,c[1]+l,c[0]-h[0],c[1]-h[1],u),u.apply,u,[p,i,o])}:void 0}var l,s,c,p,u=pt,g=ut,h=gt,m=ht,y={},f=Ye("start","drag","end"),_=0,x=0;return e.filter=function(t){return arguments.length?(u="function"==typeof t?t:st(!!t),e):u},e.container=function(t){return arguments.length?(g="function"==typeof t?t:st(t),e):g},e.subject=function(t){return arguments.length?(h="function"==typeof t?t:st(t),e):h},e.touchable=function(t){return arguments.length?(m="function"==typeof t?t:st(!!t),e):m},e.on=function(){var t=f.on.apply(f,arguments);return t===f?e:t},e.clickDistance=function(t){return arguments.length?(x=(t=+t)*t,e):ba(x)},e}function yt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function ft(e,t){var n=Object.create(e.prototype);for(var a in t)n[a]=t[a];return n}function _t(){}function xt(e){var t;return e=(e+"").trim().toLowerCase(),(t=Fa.exec(e))?(t=parseInt(t[1],16),new zt(15&t>>8|240&t>>4,15&t>>4|240&t,(15&t)<<4|15&t,1)// #f00
):(t=Za.exec(e))?vt(parseInt(t[1],16))// #ff0000
:(t=Wa.exec(e))?new zt(t[1],t[2],t[3],1)// rgb(255, 0, 0)
:(t=Qa.exec(e))?new zt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1)// rgb(100%, 0%, 0%)
:(t=Ka.exec(e))?kt(t[1],t[2],t[3],t[4])// rgba(255, 0, 0, 1)
:(t=Ja.exec(e))?kt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4])// rgb(100%, 0%, 0%, 1)
:(t=ei.exec(e))?At(t[1],t[2]/100,t[3]/100,1)// hsl(120, 50%, 50%)
:(t=ti.exec(e))?At(t[1],t[2]/100,t[3]/100,t[4])// hsla(120, 50%, 50%, 1)
:ni.hasOwnProperty(e)?vt(ni[e]):"transparent"===e?new zt(NaN,NaN,NaN,0):null}function vt(e){return new zt(255&e>>16,255&e>>8,255&e,1)}function kt(e,t,n,i){return 0>=i&&(e=t=n=NaN),new zt(e,t,n,i)}function bt(e){return(e instanceof _t||(e=xt(e)),!e)?new zt:(e=e.rgb(),new zt(e.r,e.g,e.b,e.opacity))}function wt(e,t,n,a){return 1===arguments.length?bt(e):new zt(e,t,n,null==a?1:a)}function zt(e,t,n,a){this.r=+e,this.g=+t,this.b=+n,this.opacity=+a}function Nt(e){return e=fa(0,wa(255,_a(e)||0)),(16>e?"0":"")+e.toString(16)}function At(e,t,n,i){return 0>=i?e=t=n=NaN:0>=n||1<=n?e=t=NaN:0>=t&&(e=NaN),new St(e,t,n,i)}function jt(e){if(e instanceof St)return new St(e.h,e.s,e.l,e.opacity);if(e instanceof _t||(e=xt(e)),!e)return new St;if(e instanceof St)return e;e=e.rgb();var t=e.r/255,n=e.g/255,a=e.b/255,i=wa(t,n,a),r=fa(t,n,a),d=NaN,c=r-i,p=(r+i)/2;return c?(d=t===r?(n-a)/c+6*(n<a):n===r?(a-t)/c+2:(t-n)/c+4,c/=.5>p?r+i:2-r-i,d*=60):c=0<p&&1>p?0:d,new St(d,c,p,e.opacity)}function St(e,t,n,a){this.h=+e,this.s=+t,this.l=+n,this.opacity=+a}/* From FvD 13.37, CSS Color Module Level 3 */function Ct(e,t,n){return 255*(60>e?t+(n-t)*e/60:180>e?n:240>e?t+(n-t)*(240-e)/60:t)}function Et(e){if(e instanceof Lt)return new Lt(e.l,e.a,e.b,e.opacity);if(e instanceof Ot){if(isNaN(e.h))return new Lt(e.l,0,0,e.opacity);var t=e.h*ai;return new Lt(e.l,ka(t)*e.c,va(t)*e.c,e.opacity)}e instanceof zt||(e=bt(e));var n,a,i=Pt(e.r),r=Pt(e.g),d=Pt(e.b),l=Tt((.2225045*i+.7168786*r+.0606169*d)/1);return i===r&&r===d?n=a=l:(n=Tt((.4360747*i+.3850649*r+.1430804*d)/K),a=Tt((.0139322*i+.0971045*r+.7141733*d)/Xn)),new Lt(116*l-16,500*(n-l),200*(l-a),e.opacity)}function Lt(e,t,n,a){this.l=+e,this.a=+t,this.b=+n,this.opacity=+a}function Tt(e){return e>li?xa(e,1/3):e/di+Zn}function Dt(e){return e>ri?e*e*e:di*(e-Zn)}function Xt(e){return 255*(.0031308>=e?12.92*e:1.055*xa(e,1/2.4)-.055)}function Pt(e){return .04045>=(e/=255)?e/12.92:xa((e+.055)/1.055,2.4)}function Rt(e){if(e instanceof Ot)return new Ot(e.h,e.c,e.l,e.opacity);if(e instanceof Lt||(e=Et(e)),0===e.a&&0===e.b)return new Ot(NaN,0,e.l,e.opacity);var t=ya(e.b,e.a)*ii;return new Ot(0>t?t+360:t,ba(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Ot(e,t,n,a){this.h=+e,this.c=+t,this.l=+n,this.opacity=+a}function Yt(e){if(e instanceof qt)return new qt(e.h,e.s,e.l,e.opacity);e instanceof zt||(e=bt(e));var t=e.r/255,n=e.g/255,a=e.b/255,i=(pi*a+E*t-ci*n)/(pi+E-ci),r=a-i,d=(D*(n-i)-B*r)/C,l=ba(d*d+r*r)/(D*i*(1-i)),// NaN if l=0 or l=1
s=l?ya(d,r)*ii-120:NaN;return new qt(0>s?s+360:s,l,i,e.opacity)}function qt(e,t,n,a){this.h=+e,this.s=+t,this.l=+n,this.opacity=+a}function Vt(e){return function(){return e}}function $t(e,n){return function(a){return e+a*n}}function Bt(e,n,i){return e=xa(e,i),n=xa(n,i)-e,i=1/i,function(a){return xa(e+a*n,i)}}function It(e){return 1==(e=+e)?Mt:function(t,n){return n-t?Bt(t,n,e):Vt(isNaN(t)?n:t)}}function Mt(e,t){var n=t-e;return n?$t(e,n):Vt(isNaN(e)?t:e)}function Ut(e,n){return e=+e,n-=e,function(a){return e+n*a}}function Gt(e){return function(){return e}}function Ht(e){return function(n){return e(n)+""}}function Ft(e,n){var// scan index for next number in b
t,// current match in a
o,// current match in b
r,d=fi.lastIndex=_i.lastIndex=0,// string preceding current number in b, if any
l=-1,// index in s
c=[],// string constants and placeholders
s=[];// number interpolators
// Coerce inputs to strings.
// Interpolate pairs of numbers in a & b.
for(e+="",n+="";(t=fi.exec(e))&&(o=_i.exec(n));)(r=o.index)>d&&(r=n.slice(d,r),c[l]?c[l]+=r:// coalesce with previous string
c[++l]=r),(t=t[0])===(o=o[0])?c[l]?c[l]+=o:// coalesce with previous string
c[++l]=o:(c[++l]=null,s.push({i:l,x:Ut(t,o)})),d=_i.lastIndex;// Add remains of b.
// Special optimization for only a single match.
// Otherwise, interpolate each of the numbers and rejoin the string.
return d<n.length&&(r=n.slice(d),c[l]?c[l]+=r:// coalesce with previous string
c[++l]=r),2>c.length?s[0]?Ht(s[0].x):Gt(n):(n=s.length,function(e){for(var t,a=0;a<n;++a)c[(t=s[a]).i]=t.x(e);return c.join("")})}function Zt(t,n,i,o,r,e){var s,p,u,l=Math.atan;return(s=ba(t*t+n*n))&&(t/=s,n/=s),(u=t*i+n*o)&&(i-=t*u,o-=n*u),(p=ba(i*i+o*o))&&(i/=p,o/=p,u/=p),t*o<n*i&&(t=-t,n=-n,u=-u,s=-s),{translateX:r,translateY:e,rotate:ya(n,t)*xi,skewX:l(u)*xi,scaleX:s,scaleY:p}}function Wt(e){return"none"===e?vi:(ui||(ui=document.createElement("DIV"),gi=document.documentElement,hi=document.defaultView),ui.style.transform=e,e=hi.getComputedStyle(gi.appendChild(ui),null).getPropertyValue("transform"),gi.removeChild(ui),e=e.slice(7,-1).split(","),Zt(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function Qt(e){return null==e?vi:(mi||(mi=document.createElementNS("http://www.w3.org/2000/svg","g")),mi.setAttribute("transform",e),!(e=mi.transform.baseVal.consolidate()))?vi:(e=e.matrix,Zt(e.a,e.b,e.c,e.d,e.e,e.f))}function Kt(e,t,n,i){function o(e){return e.length?e.pop()+" ":""}function r(e,a,o,r,d,l){if(e!==o||a!==r){var s=d.push("translate(",null,t,null,n);l.push({i:s-4,x:Ut(e,o)},{i:s-2,x:Ut(a,r)})}else(o||r)&&d.push("translate("+o+t+r+n)}function d(e,t,n,r){e===t?t&&n.push(o(n)+"rotate("+t+i):(180<e-t?t+=360:180<t-e&&(e+=360),r.push({i:n.push(o(n)+"rotate(",null,i)-2,x:Ut(e,t)}))}function l(e,t,n,a){e===t?t&&n.push(o(n)+"skewX("+t+i):a.push({i:n.push(o(n)+"skewX(",null,i)-2,x:Ut(e,t)})}function c(e,t,n,a,r,d){if(e!==n||t!==a){var l=r.push(o(r)+"scale(",null,",",null,")");d.push({i:l-4,x:Ut(e,n)},{i:l-2,x:Ut(t,a)})}else(1!==n||1!==a)&&r.push(o(r)+"scale("+n+","+a+")")}return function(t,n){var p=[],// string constants and placeholders
s=[];// number interpolators
// gc
return t=e(t),n=e(n),r(t.translateX,t.translateY,n.translateX,n.translateY,p,s),d(t.rotate,n.rotate,p,s),l(t.skewX,n.skewX,p,s),c(t.scaleX,t.scaleY,n.scaleX,n.scaleY,p,s),t=n=null,function(e){for(var t,a=-1,r=s.length;++a<r;)p[(t=s[a]).i]=t.x(e);return p.join("")}}}function Jt(e){return((e=ma(e))+1/e)/2}function en(e){return((e=ma(e))-1/e)/2}function tn(e){return((e=ma(2*e))-1)/(e+1)}// p0 = [ux0, uy0, w0]
// p1 = [ux1, uy1, w1]
function nn(e,t){var a,o,n=Math.log,r=e[0],d=e[1],l=e[2],s=t[0],c=t[1],p=t[2],g=s-r,h=c-d,u=g*g+h*h;// Special case for u0 ≅ u1.
if(u<zi)o=n(p/l)/wi,a=function(e){return[r+e*g,d+e*h,l*ma(wi*e*o)]};// General case.
else{var m=ba(u),y=(p*p-l*l+4*u)/(2*(2*l)*m),f=(p*p-l*l-4*u)/(2*(2*p)*m),_=n(ba(y*y+1)-y),x=n(ba(f*f+1)-f);o=(x-_)/wi,a=function(e){var t=e*o,n=Jt(_),a=l/(2*m)*(n*tn(wi*t+_)-en(_));return[r+a*g,d+a*h,l*n/Jt(wi*t+_)]}}return a.duration=1e3*o,a}function an(e,t,n,a,i,o){var r=e.__transition;if(!r)e.__transition={};else if(n in r)return;ln(e,n,{name:t,index:a,// For context during callback.
group:i,// For context during callback.
on:Ni,tween:Ai,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function on(e,t){var n=dn(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function rn(e,t){var n=dn(e,t);if(n.state>2)throw new Error("too late; already started");return n}function dn(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function ln(e,t,a){function r(p){var u,g,h,m;// If the state is not SCHEDULED, then we previously errored on start.
if(1!==a.state)return l();for(u in c)if(m=c[u],m.name===a.name){// While this element already has a starting transition during this frame,
// defer starting an interrupting transition until that transition has a
// chance to tick (and possibly end); see d3/d3-transition#54!
if(3===m.state)return Ke(r);// Interrupt the active transition, if any.
// Dispatch the interrupt event.
4===m.state?(m.state=6,m.timer.stop(),m.on.call("interrupt",e,e.__data__,m.index,m.group),delete c[u]):+u<t&&(m.state=6,m.timer.stop(),delete c[u])}// Defer the first tick to end of the current frame; see d3/d3#1576.
// Note the transition may be canceled after start and before the first tick!
// Note this must be scheduled before the start event; see d3/d3-transition#16!
// Assuming this is successful, subsequent callbacks go straight to tick.
if(Ke(function(){3===a.state&&(a.state=4,a.timer.restart(d,a.delay,a.time),d(p))}),a.state=2,a.on.call("start",e,e.__data__,a.index,a.group),2===a.state){for(a.state=3,s=Array(h=a.tween.length),(u=0,g=-1);u<h;++u)(m=a.tween[u].value.call(e,e.__data__,a.index,a.group))&&(s[++g]=m);s.length=g+1}// interrupted
}function d(o){for(var r=o<a.duration?a.ease.call(null,o/a.duration):(a.timer.restart(l),a.state=5,1),t=-1,d=s.length;++t<d;)s[t].call(null,r);// Dispatch the end event.
a.state===5&&(a.on.call("end",e,e.__data__,a.index,a.group),l())}function l(){for(var n in a.state=6,a.timer.stop(),delete c[t],c)return;// eslint-disable-line no-unused-vars
delete e.__transition}var s,c=e.__transition;// Initialize the self timer when the transition is created.
// Note the actual delay is not known until the first callback!
c[t]=a,a.timer=Ge(function(e){a.state=1,a.timer.restart(r,a.delay,a.time),a.delay<=e&&r(e-a.delay)},0,a.time)}function sn(e,t){var n,a,o,r=e.__transition,d=!0;if(r){for(o in t=null==t?null:t+"",r){if((n=r[o]).name!==t){d=!1;continue}a=2<n.state&&5>n.state,n.state=6,n.timer.stop(),a&&n.on.call("interrupt",e,e.__data__,n.index,n.group),delete r[o]}d&&delete e.__transition}}function cn(e,t){var a,o;return function(){var r=rn(this,e),d=r.tween;// If this node shared tween with the previous node,
// just assign the updated shared tween and we’re done!
// Otherwise, copy-on-write.
if(d!==a){o=a=d;for(var l=0,s=o.length;l<s;++l)if(o[l].name===t){o=o.slice(),o.splice(l,1);break}}r.tween=o}}function pn(e,a,o){var r,d;if("function"!=typeof o)throw new Error;return function(){var l=rn(this,e),s=l.tween;// If this node shared tween with the previous node,
// just assign the updated shared tween and we’re done!
// Otherwise, copy-on-write.
if(s!==r){d=(r=s).slice();for(var c={name:a,value:o},t=0,p=d.length;t<p;++t)if(d[t].name===a){d[t]=c;break}t===p&&d.push(c)}l.tween=d}}function un(e,a){var o=this._id;if(e+="",2>arguments.length){for(var r,d=dn(this.node(),o).tween,l=0,s=d.length;l<s;++l)if((r=d[l]).name===e)return r.value;return null}return this.each((null==a?cn:pn)(o,e,a))}function gn(e,t,n){var a=e._id;return e.each(function(){var e=rn(this,a);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return dn(e,a).value[t]}}function hn(e,t){var n;return("number"==typeof t?Ut:t instanceof xt?yi:(n=xt(t))?(t=n,yi):Ft)(e,t)}function mn(e){return function(){this.removeAttribute(e)}}function yn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function fn(e,t,n){var a,i;return function(){var o=this.getAttribute(e);return o===n?null:o===a?i:i=t(a=o,n)}}function _n(e,t,n){var a,i;return function(){var o=this.getAttributeNS(e.space,e.local);return o===n?null:o===a?i:i=t(a=o,n)}}function xn(e,t,n){var a,i,o;return function(){var r,d=n(this);return null==d?void this.removeAttribute(e):(r=this.getAttribute(e),r===d?null:r===a&&d===i?o:o=t(a=r,i=d))}}function vn(e,t,n){var a,i,o;return function(){var r,d=n(this);return null==d?void this.removeAttributeNS(e.space,e.local):(r=this.getAttributeNS(e.space,e.local),r===d?null:r===a&&d===i?o:o=t(a=r,i=d))}}function kn(e,t){function n(){var n=this,a=t.apply(n,arguments);return a&&function(i){n.setAttributeNS(e.space,e.local,a(i))}}return n._value=t,n}function bn(e,t){function n(){var n=this,a=t.apply(n,arguments);return a&&function(i){n.setAttribute(e,a(i))}}return n._value=t,n}function wn(e,t){return function(){on(this,e).delay=+t.apply(this,arguments)}}function zn(e,t){return t=+t,function(){on(this,e).delay=t}}function Nn(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?wn:zn)(t,e)):dn(this.node(),t).delay}function An(e,t){return function(){rn(this,e).duration=+t.apply(this,arguments)}}function jn(e,t){return t=+t,function(){rn(this,e).duration=t}}function Sn(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?An:jn)(t,e)):dn(this.node(),t).duration}function Cn(e,t){if("function"!=typeof t)throw new Error;return function(){rn(this,e).ease=t}}function En(e){var t=this._id;return arguments.length?this.each(Cn(t,e)):dn(this.node(),t).ease}function Ln(e){return(e+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return 0<=n&&(e=e.slice(0,n)),!e||"start"===e})}function Tn(e,t,n){var a,i,o=Ln(t)?on:rn;return function(){var r=o(this,e),d=r.on;// If this node shared a dispatch with the previous node,
// just assign the updated shared dispatch and we’re done!
// Otherwise, copy-on-write.
d!==a&&(i=(a=d).copy()).on(t,n),r.on=i}}function Dn(e,t){var n=this._id;return 2>arguments.length?dn(this.node(),n).on.on(e):this.each(Tn(n,e,t))}function Pn(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Rn(e){var t=this._name,a=this._id;"function"!=typeof e&&(e=o(e));for(var r=this._groups,d=r.length,l=Array(d),s=0;s<d;++s)for(var c,p,u=r[s],g=u.length,n=l[s]=Array(g),h=0;h<g;++h)(c=u[h])&&(p=e.call(c,c.__data__,h,u))&&("__data__"in c&&(p.__data__=c.__data__),n[h]=p,an(n[h],t,a,h,n,dn(c,a)));return new Un(l,this._parents,t,a)}function On(e){var t=this._name,a=this._id;"function"!=typeof e&&(e=s(e));for(var o=this._groups,r=o.length,d=[],c=[],p=0;p<r;++p)for(var u,g=o[p],h=g.length,n=0;n<h;++n)if(u=g[n]){for(var m,y=e.call(u,u.__data__,n,g),f=dn(u,a),_=0,x=y.length;_<x;++_)(m=y[_])&&an(m,t,a,_,y,f);d.push(y),c.push(u)}return new Un(d,c,t,a)}function Yn(e,t){var n,a,i;return function(){var o=X(this,e),r=(this.style.removeProperty(e),X(this,e));return o===r?null:o===n&&r===a?i:i=t(n=o,a=r)}}function qn(e){return function(){this.style.removeProperty(e)}}function Vn(e,t,n){var a,i;return function(){var o=X(this,e);return o===n?null:o===a?i:i=t(a=o,n)}}function $n(e,t,n){var a,i,o;return function(){var r=X(this,e),d=n(this);return null==d&&(d=(this.style.removeProperty(e),X(this,e))),r===d?null:r===a&&d===i?o:o=t(a=r,i=d)}}function Bn(e,t,n){function a(){var a=this,o=t.apply(a,arguments);return o&&function(i){a.style.setProperty(e,o(i),n)}}return a._value=t,a}function In(e){return function(){this.textContent=e}}function Mn(e){return function(){var t=e(this);this.textContent=null==t?"":t}}function Un(e,t,n,a){this._groups=e,this._parents=t,this._name=n,this._id=a}function Gn(){return++Si}function Hn(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))return Ei.time=Ie(),Ei;return n}function Fn(e){var t,a;e instanceof Un?(t=e._id,e=e._name):(t=Gn(),(a=Ei).time=Ie(),e=null==e?null:e+"");for(var o=this._groups,r=o.length,d=0;d<r;++d)for(var l,s=o[d],c=s.length,n=0;n<c;++n)(l=s[n])&&an(l,e,t,n,s,a||Hn(l,t));return new Un(o,this._parents,e,t)}function Wn(e){return function(){return e}}function Qn(e,t,n){this.target=e,this.type=t,this.transform=n}function Kn(e,t,n){this.k=e,this.x=t,this.y=n}function Jn(){Aa.stopImmediatePropagation()}function ea(){Aa.preventDefault(),Aa.stopImmediatePropagation()}// Ignore right-click, since that should open the context menu.
function ta(){return!Aa.button}function na(){var t,n,a=this;return a instanceof SVGElement?(a=a.ownerSVGElement||a,t=a.width.baseVal.value,n=a.height.baseVal.value):(t=a.clientWidth,n=a.clientHeight),[[0,0],[t,n]]}function aa(){return this.__zoom||Li}function ia(){return-Aa.deltaY*(Aa.deltaMode?120:1)/500}function oa(){return"ontouchstart"in this}function ra(e,t,n){var a=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],r=e.invertY(t[1][1])-n[1][1];return e.translate(i>a?(a+i)/2:wa(0,a)||fa(0,i),r>o?(o+r)/2:wa(0,o)||fa(0,r))}function da(){function e(e){e.property("__zoom",aa).on("wheel.zoom",s).on("mousedown.zoom",c).on("dblclick.zoom",p).filter(z).on("touchstart.zoom",u).on("touchmove.zoom",g).on("touchend.zoom touchcancel.zoom",h).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function n(e,t){return t=fa(N[0],wa(N[1],t)),t===e.k?e:new Kn(t,e.x,e.y)}function a(e,t,n){var a=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return a===e.x&&i===e.y?e:new Kn(e.k,a,i)}function o(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function r(e,t,n){e.on("start.zoom",function(){d(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){d(this,arguments).end()}).tween("zoom",function(){var r=this,l=arguments,s=d(r,l),c=v.apply(r,l),e=n||o(c),p=fa(c[1][0]-c[0][0],c[1][1]-c[0][1]),u=r.__zoom,a="function"==typeof t?t.apply(r,l):t,g=S(u.invert(e).concat(p/u.k),a.invert(e).concat(p/a.k));return function(n){if(1===n)n=a;// Avoid rounding error on end.
else{var i=g(n),o=p/i[2];n=new Kn(o,e[0]-i[0]*o,e[1]-i[1]*o)}s.zoom(null,n)}})}function d(e,t){for(var a,o=0,r=C.length;o<r;++o)if((a=C[o]).that===e)return a;return new l(e,t)}function l(e,t){this.that=e,this.args=t,this.index=-1,this.active=0,this.extent=v.apply(e,t)}function s(){function e(){i.wheel=null,i.end()}if(f.apply(this,arguments)){var i=d(this,arguments),o=this.__zoom,t=fa(N[0],wa(N[1],o.k*xa(2,w.apply(this,arguments)))),r=ve(this);// If the mouse is in the same location as before, reuse it.
// If there were recent wheel events, reset the wheel idle timeout.
if(i.wheel)(i.mouse[0][0]!==r[0]||i.mouse[0][1]!==r[1])&&(i.mouse[1]=o.invert(i.mouse[0]=r)),clearTimeout(i.wheel);// If this wheel event won’t trigger a transform change, ignore it.
else{if(o.k===t)return;// Otherwise, capture the mouse point and location at the start.
i.mouse=[r,o.invert(r)],sn(this),i.start()}ea(),i.wheel=setTimeout(e,150),i.zoom("mouse",b(a(n(o,t),i.mouse[0],i.mouse[1]),i.extent,A))}}function c(){function e(){if(ea(),!n.moved){var e=Aa.clientX-r,t=Aa.clientY-l;n.moved=e*e+t*t>L}n.zoom("mouse",b(a(n.that.__zoom,n.mouse[0]=ve(n.that),n.mouse[1]),n.extent,A))}function t(){i.on("mousemove.zoom mouseup.zoom",null),lt(Aa.view,n.moved),ea(),n.end()}if(!y&&f.apply(this,arguments)){var n=d(this,arguments),i=fe(Aa.view).on("mousemove.zoom",e,!0).on("mouseup.zoom",t,!0),o=ve(this),r=Aa.clientX,l=Aa.clientY;dt(Aa.view),Jn(),n.mouse=[o,this.__zoom.invert(o)],sn(this),n.start()}}function p(){if(f.apply(this,arguments)){var t=this.__zoom,i=ve(this),o=t.invert(i),d=t.k*(Aa.shiftKey?.5:2),l=b(a(n(t,d),i,o),v.apply(this,arguments),A);ea(),0<j?fe(this).transition().duration(j).call(r,l,i):fe(this).call(e.transform,l)}}function u(){if(f.apply(this,arguments)){var e,a,o,r,l=d(this,arguments),s=Aa.changedTouches,c=s.length;for(Jn(),a=0;a<c;++a)o=s[a],r=ke(this,s,o.identifier),r=[r,this.__zoom.invert(r),o.identifier],l.touch0?!l.touch1&&(l.touch1=r):(l.touch0=r,e=!0);// If this is a dbltap, reroute to the (optional) dblclick.zoom handler.
return m&&(m=clearTimeout(m),!l.touch1)?(l.end(),r=fe(this).on("dblclick.zoom"),void(r&&r.apply(this,arguments))):void(e&&(m=setTimeout(function(){m=null},500),sn(this),l.start()))}}function g(){var e,o,r,s,c=d(this,arguments),u=Aa.changedTouches,g=u.length;for(ea(),m&&(m=clearTimeout(m)),e=0;e<g;++e)o=u[e],r=ke(this,u,o.identifier),c.touch0&&c.touch0[2]===o.identifier?c.touch0[0]=r:c.touch1&&c.touch1[2]===o.identifier&&(c.touch1[0]=r);if(o=c.that.__zoom,c.touch1){var h=c.touch0[0],y=c.touch0[1],f=c.touch1[0],_=c.touch1[1],x=(x=f[0]-h[0])*x+(x=f[1]-h[1])*x,v=(v=_[0]-y[0])*v+(v=_[1]-y[1])*v;o=n(o,ba(x/v)),r=[(h[0]+f[0])/2,(h[1]+f[1])/2],s=[(y[0]+_[0])/2,(y[1]+_[1])/2]}else if(c.touch0)r=c.touch0[0],s=c.touch0[1];else return;c.zoom("touch",b(a(o,r,s),c.extent,A))}function h(){var e,a,o=d(this,arguments),r=Aa.changedTouches,l=r.length;for(Jn(),y&&clearTimeout(y),y=setTimeout(function(){y=null},500),e=0;e<l;++e)a=r[e],o.touch0&&o.touch0[2]===a.identifier?delete o.touch0:o.touch1&&o.touch1[2]===a.identifier&&delete o.touch1;o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0?o.touch0[1]=this.__zoom.invert(o.touch0[0]):o.end()}var m,y,f=ta,v=na,b=ra,w=ia,z=oa,N=[0,1/0],A=[[-Infinity,-Infinity],[1/0,1/0]],j=250,S=nn,C=[],E=Ye("start","zoom","end"),L=0;return e.transform=function(e,t){var n=e.selection?e.selection():e;n.property("__zoom",aa),e===n?n.interrupt().each(function(){d(this,arguments).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()}):r(e,t)},e.scaleBy=function(t,n){e.scaleTo(t,function(){var e=this.__zoom.k,t="function"==typeof n?n.apply(this,arguments):n;return e*t})},e.scaleTo=function(t,i){e.transform(t,function(){var t=v.apply(this,arguments),e=this.__zoom,r=o(t),d=e.invert(r),l="function"==typeof i?i.apply(this,arguments):i;return b(a(n(e,l),r,d),t,A)})},e.translateBy=function(t,n,a){e.transform(t,function(){return b(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof a?a.apply(this,arguments):a),v.apply(this,arguments),A)})},e.translateTo=function(t,n,a){e.transform(t,function(){var i=v.apply(this,arguments),e=this.__zoom,t=o(i);return b(Li.translate(t[0],t[1]).scale(e.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof a?-a.apply(this,arguments):-a),i,A)})},l.prototype={start:function(){return 1==++this.active&&(this.index=C.push(this)-1,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(C.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(t){pe(new Qn(e,t,this.that.__zoom),E.apply,E,[t,this.that,this.args])}},e.wheelDelta=function(t){return arguments.length?(w="function"==typeof t?t:Wn(+t),e):w},e.filter=function(t){return arguments.length?(f="function"==typeof t?t:Wn(!!t),e):f},e.touchable=function(t){return arguments.length?(z="function"==typeof t?t:Wn(!!t),e):z},e.extent=function(t){return arguments.length?(v="function"==typeof t?t:Wn([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),e):v},e.scaleExtent=function(t){return arguments.length?(N[0]=+t[0],N[1]=+t[1],e):[N[0],N[1]]},e.translateExtent=function(t){return arguments.length?(A[0][0]=+t[0][0],A[1][0]=+t[1][0],A[0][1]=+t[0][1],A[1][1]=+t[1][1],e):[[A[0][0],A[0][1]],[A[1][0],A[1][1]]]},e.constrain=function(t){return arguments.length?(b=t,e):b},e.duration=function(t){return arguments.length?(j=+t,e):j},e.interpolate=function(t){return arguments.length?(S=t,e):S},e.on=function(){var t=E.on.apply(E,arguments);return t===E?e:t},e.clickDistance=function(t){return arguments.length?(L=(t=+t)*t,e):ba(L)},e}function la(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function sa(e,t){var n=la(e);return function(a,o){return t(n(a),o,e)}}// Compute unique columns in order of discovery.
function ca(e){var t=Object.create(null),n=[];return e.forEach(function(e){for(var a in e)a in t||n.push(t[a]=a)}),n}function pa(e){function t(e,a){function i(){if(p)return Di;if(u)return u=!1,Ti;// Unescape quotes.
var t,n,a=s;if(34===e.charCodeAt(a)){for(;s++<l&&34!==e.charCodeAt(s)||34===e.charCodeAt(++s););return(t=s)>=l?p=!0:10===(n=e.charCodeAt(s++))?u=!0:13===n&&(u=!0,10===e.charCodeAt(s)&&++s),e.slice(a+1,t-1).replace(/""/g,"\"")}// Find next delimiter or newline.
for(;s<l;){if((n=e.charCodeAt(t=s++))===10)u=!0;else if(n===13)u=!0,10===e.charCodeAt(s)&&++s;else if(n!==o)continue;return e.slice(a,t)}// Return last token before EOF.
return p=!0,e.slice(a,l)}var// current line number
r,d=[],// output rows
l=e.length,s=0,// current character index
c=0,// current token
p=0>=l,// current token followed by EOF?
u=!1;// current token followed by EOL?
// Strip the trailing newline.
for(10===e.charCodeAt(l-1)&&--l,13===e.charCodeAt(l-1)&&--l;(r=i())!==Di;){for(var g=[];r!==Ti&&r!==Di;)g.push(r),r=i();a&&null==(g=a(g,c++))||d.push(g)}return d}function n(t){return t.map(a).join(e)}function a(e){return null==e?"":i.test(e+="")?"\""+e.replace(/"/g,"\"\"")+"\"":e}var i=new RegExp("[\""+e+"\n\r]"),o=e.charCodeAt(0);return{parse:function(e,n){var a,o,r=t(e,function(e,t){return a?a(e,t-1):void(o=e,a=n?sa(e,n):la(e))});return r.columns=o||[],r},parseRows:t,format:function(t,n){return null==n&&(n=ca(t)),[n.map(a).join(e)].concat(t.map(function(t){return n.map(function(e){return a(t[e])}).join(e)})).join("\n")},formatRows:function(e){return e.map(n).join("\n")}}}function ua(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.json()}function ga(e,t){return fetch(e,t).then(ua)}/*global window*/var za={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};u.prototype={constructor:u,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};V.prototype={add:function(e){var t=this._names.indexOf(e);0>t&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);0<=t&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return 0<=this._names.indexOf(e)}};var Na={},Aa=null;if("undefined"!=typeof document){var ja=document.documentElement;"onmouseenter"in ja||(Na={mouseenter:"mouseover",mouseleave:"mouseout"})}var Sa=[null];me.prototype=ye.prototype={constructor:me,select:r,selectAll:function(e){"function"!=typeof e&&(e=s(e));for(var t=this._groups,a=t.length,o=[],r=[],d=0;d<a;++d)for(var l,c=t[d],p=c.length,n=0;n<p;++n)(l=c[n])&&(o.push(e.call(l,l.__data__,n,c)),r.push(l));return new me(o,r)},filter:function(e){"function"!=typeof e&&(e=c(e));for(var t=this._groups,a=t.length,o=Array(a),r=0;r<a;++r)for(var d,l=t[r],s=l.length,n=o[r]=[],p=0;p<s;++p)(d=l[p])&&e.call(d,d.__data__,p,l)&&n.push(d);return new me(o,this._parents)},data:function(e,t){if(!e)return m=Array(this.size()),s=-1,this.each(function(e){m[++s]=e}),m;var n=t?f:h,a=this._parents,i=this._groups;"function"!=typeof e&&(e=g(e));for(var o=i.length,r=Array(o),d=Array(o),l=Array(o),s=0;s<o;++s){var c=a[s],p=i[s],u=p.length,m=e.call(c,c&&c.__data__,s,a),y=m.length,_=d[s]=Array(y),x=r[s]=Array(y),v=l[s]=Array(u);n(c,p,_,x,v,m,t);// Now connect the enter nodes to their following update node, such that
// appendChild can insert the materialized enter node before this node,
// rather than at the end of the parent node.
for(var k,b,w=0,z=0;w<y;++w)if(k=_[w]){for(w>=z&&(z=w+1);!(b=x[z])&&++z<y;);k._next=b||null}}return r=new me(r,a),r._enter=d,r._exit=l,r},enter:function(){return new me(this._enter||this._groups.map(p),this._parents)},exit:function(){return new me(this._exit||this._groups.map(p),this._parents)},join:function(e,t,n){var a=this.enter(),i=this,o=this.exit();return a="function"==typeof e?e(a):a.append(e+""),null!=t&&(i=t(i)),null==n?o.remove():n(o),a&&i?a.merge(i).order():i},merge:function(e){for(var t=this._groups,a=e._groups,o=t.length,r=a.length,d=wa(o,r),l=Array(o),s=0;s<d;++s)for(var c,p=t[s],u=a[s],g=p.length,n=l[s]=Array(g),h=0;h<g;++h)(c=p[h]||u[h])&&(n[h]=c);for(;s<o;++s)l[s]=t[s];return new me(l,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var a,o=e[t],r=o.length-1,d=o[r];0<=--r;)(a=o[r])&&(d&&4^a.compareDocumentPosition(d)&&d.parentNode.insertBefore(a,d),d=a);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=_);for(var a=this._groups,o=a.length,r=Array(o),d=0;d<o;++d){for(var l,s=a[d],c=s.length,n=r[d]=Array(c),p=0;p<c;++p)(l=s[p])&&(n[p]=l);n.sort(t)}return new me(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e},node:function(){for(var e=this._groups,t=0,a=e.length;t<a;++t)for(var o,r=e[t],d=0,l=r.length;d<l;++d)if(o=r[d],o)return o;return null},size:function(){var e=0;return this.each(function(){++e}),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,a=0,o=t.length;a<o;++a)for(var r,d=t[a],l=0,s=d.length;l<s;++l)(r=d[l])&&e.call(r,r.__data__,l,d);return this},attr:function(t,n){var a=e(t);if(2>arguments.length){var i=this.node();return a.local?i.getAttributeNS(a.space,a.local):i.getAttribute(a)}return this.each((null==n?a.local?k:v:"function"==typeof n?a.local?N:z:a.local?w:b)(a,n))},style:function(e,t,n){return 1<arguments.length?this.each((null==t?S:"function"==typeof t?T:L)(e,t,null==n?"":n)):X(this.node(),e)},property:function(e,t){return 1<arguments.length?this.each((null==t?P:"function"==typeof t?O:R)(e,t)):this.node()[e]},classed:function(e,t){var a=Y(e+"");if(2>arguments.length){for(var o=q(this.node()),r=-1,d=a.length;++r<d;)if(!o.contains(a[r]))return!1;return!0}return this.each(("function"==typeof t?G:t?M:U)(a,t))},text:function(e){return arguments.length?this.each(null==e?H:("function"==typeof e?Z:F)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?W:("function"==typeof e?J:Q)(e)):this.node().innerHTML},raise:function(){return this.each(ee)},lower:function(){return this.each(te)},append:function(e){var t="function"==typeof e?e:a(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:a(e),i=null==t?ne:"function"==typeof t?t:o(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(ae)},clone:function(e){return this.select(e?oe:ie)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,a,r){var d,l,s=le(e+""),c=s.length;if(2>arguments.length){var n=this.node().__on;if(n)for(var p,u=0,g=n.length;u<g;++u)for(d=0,p=n[u];d<c;++d)if((l=s[d]).type===p.type&&l.name===p.name)return p.value;return}for(n=a?ce:se,null==r&&(r=!1),d=0;d<c;++d)this.each(n(s[d],a,r));return this},dispatch:function(e,t){return this.each(("function"==typeof t?he:ge)(e,t))}};var Ca=Ce.prototype=Ee.prototype;Ca.copy=function(){var e,t,n=new Ee(this._x,this._y,this._x0,this._y0,this._x1,this._y1),a=this._root;if(!a)return n;if(!a.length)return n._root=Le(a),n;for(e=[{source:a,target:n._root=[,,,,]}];a=e.pop();)for(var o=0;4>o;++o)(t=a.source[o])&&(t.length?e.push({source:t,target:a.target[o]=[,,,,]}):a.target[o]=Le(t));return n},Ca.add=function(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return Ne(this.cover(t,n),t,n,e)},Ca.addAll=function(e){var t,a,o,r,l=e.length,n=Array(l),s=Array(l),c=1/0,p=1/0,u=-Infinity,g=-Infinity;// Compute the points and their extent.
for(a=0;a<l;++a)isNaN(o=+this._x.call(null,t=e[a]))||isNaN(r=+this._y.call(null,t))||(n[a]=o,s[a]=r,o<c&&(c=o),o>u&&(u=o),r<p&&(p=r),r>g&&(g=r));// If there were no (valid) points, abort.
if(c>u||p>g)return this;// Expand the tree to cover the new points.
// Add the new points.
for(this.cover(c,p).cover(u,g),a=0;a<l;++a)Ne(this,n[a],s[a],e[a]);return this},Ca.cover=function(e,t){var n=Math.floor;if(isNaN(e=+e)||isNaN(t=+t))return this;// ignore invalid points
var a=this._x0,o=this._y0,r=this._x1,d=this._y1;// If the quadtree has no extent, initialize them.
// Integer extent are necessary so that if we later double the extent,
// the existing quadrant boundaries don’t change due to floating point error!
if(isNaN(a))r=(a=n(e))+1,d=(o=n(t))+1;// Otherwise, double repeatedly to cover.
else{for(var l,s,c=r-a,p=this._root;a>e||e>=r||o>t||t>=d;)s=(t<o)<<1|e<a,l=[,,,,],l[s]=p,p=l,c*=2,0===s?(r=a+c,d=o+c):1===s?(a=r-c,d=o+c):2===s?(r=a+c,o=d-c):3===s?(a=r-c,o=d-c):void 0;this._root&&this._root.length&&(this._root=p)}return this._x0=a,this._y0=o,this._x1=r,this._y1=d,this},Ca.data=function(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e},Ca.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Ca.find=function(e,t,n){var a,o,r,l,s,c,p,u=this._x0,g=this._y0,h=this._x1,m=this._y1,y=[],f=this._root;for(f&&y.push(new Ae(f,u,g,h,m)),null==n?n=1/0:(u=e-n,g=t-n,h=e+n,m=t+n,n*=n);c=y.pop();)// Stop searching if this quadrant can’t contain a closer node.
if(!(!(f=c.node)||(o=c.x0)>h||(r=c.y0)>m||(l=c.x1)<u||(s=c.y1)<g))// Bisect the current quadrant.
if(f.length){var _=(o+l)/2,x=(r+s)/2;y.push(new Ae(f[3],_,x,l,s),new Ae(f[2],o,x,_,s),new Ae(f[1],_,r,l,x),new Ae(f[0],o,r,_,x)),(p=(t>=x)<<1|e>=_)&&(c=y[y.length-1],y[y.length-1]=y[y.length-1-p],y[y.length-1-p]=c)}// Visit this point. (Visiting coincident points isn’t necessary!)
else{var v=e-+this._x.call(null,f.data),k=t-+this._y.call(null,f.data),b=v*v+k*k;if(b<n){var w=ba(n=b);u=e-w,g=t-w,h=e+w,m=t+w,a=f.data}}return a},Ca.remove=function(e){if(isNaN(r=+this._x.call(null,e))||isNaN(d=+this._y.call(null,e)))return this;// ignore invalid points
var t,n,a,o,r,d,l,s,c,p,u,g,h=this._root,m=this._x0,f=this._y0,_=this._x1,v=this._y1;// If the tree is empty, initialize the root as a leaf.
if(!h)return this;// Find the leaf node for the point.
// While descending, also retain the deepest parent with a non-removed sibling.
if(h.length)for(;;){if((c=r>=(l=(m+_)/2))?m=l:_=l,(p=d>=(s=(f+v)/2))?f=s:v=s,(t=h,!(h=h[u=p<<1|c])))return this;if(!h.length)break;(t[3&u+1]||t[3&u+2]||t[3&u+3])&&(n=t,g=u)}// Find the point to remove.
for(;h.data!==e;)if(a=h,!(h=h.next))return this;// If there are multiple coincident points, remove just the point.
return((o=h.next)&&delete h.next,a)?(o?a.next=o:delete a.next,this):t?(o?t[u]=o:delete t[u],(h=t[0]||t[1]||t[2]||t[3])&&h===(t[3]||t[2]||t[1]||t[0])&&!h.length&&(n?n[g]=h:this._root=h),this):(this._root=o,this);// If this is the root point, remove it.
// Remove this leaf.
},Ca.removeAll=function(e){for(var t=0,a=e.length;t<a;++t)this.remove(e[t]);return this},Ca.root=function(){return this._root},Ca.size=function(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e},Ca.visit=function(e){var t,n,a,i,o,r,d=[],l=this._root;for(l&&d.push(new Ae(l,this._x0,this._y0,this._x1,this._y1));t=d.pop();)if(!e(l=t.node,a=t.x0,i=t.y0,o=t.x1,r=t.y1)&&l.length){var s=(a+o)/2,c=(i+r)/2;(n=l[3])&&d.push(new Ae(n,s,c,o,r)),(n=l[2])&&d.push(new Ae(n,a,c,s,r)),(n=l[1])&&d.push(new Ae(n,s,i,o,c)),(n=l[0])&&d.push(new Ae(n,a,i,s,c))}return this},Ca.visitAfter=function(e){var t,n=[],a=[];for(this._root&&n.push(new Ae(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var o,r=t.x0,d=t.y0,l=t.x1,s=t.y1,c=(r+l)/2,p=(d+s)/2;(o=i[0])&&n.push(new Ae(o,r,d,c,p)),(o=i[1])&&n.push(new Ae(o,c,d,l,p)),(o=i[2])&&n.push(new Ae(o,r,p,c,s)),(o=i[3])&&n.push(new Ae(o,c,p,l,s))}a.push(t)}for(;t=a.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},Ca.x=function(e){return arguments.length?(this._x=e,this):this._x},Ca.y=function(e){return arguments.length?(this._y=e,this):this._y};y.prototype=x.prototype={constructor:y,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if(e[0]==="$")return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var Ea=x.prototype;De.prototype=Xe.prototype={constructor:De,has:Ea.has,add:function(e){return e+="",this["$"+e]=e,this},remove:Ea.remove,clear:Ea.clear,values:Ea.keys,size:Ea.size,empty:Ea.empty,each:Ea.each};var La={value:function(){}};qe.prototype=Ye.prototype={constructor:qe,on:function(e,a){var o,r=this._,d=Ve(e+"",r),l=-1,s=d.length;// If no callback was specified, return the callback of the given type and name.
if(2>arguments.length){for(;++l<s;)if((o=(e=d[l]).type)&&(o=$e(r[o],e.name)))return o;return}// If a type was specified, set the callback for the given type and name.
// Otherwise, if a null callback was specified, remove callbacks of the given name.
if(null!=a&&"function"!=typeof a)throw new Error("invalid callback: "+a);for(;++l<s;)if(o=(e=d[l]).type)r[o]=Be(r[o],e.name,a);else if(null==a)for(o in r)r[o]=Be(r[o],e.name,null);return this},copy:function(){var e={},n=this._;for(var a in n)e[a]=n[a].slice();return new qe(e)},call:function(e,a){if(0<(o=arguments.length-2))for(var o,r,d=Array(o),l=0;l<o;++l)d[l]=arguments[l+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=this._[e],l=0,o=r.length;l<o;++l)r[l].value.apply(a,d)},apply:function(e,a,o){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],t=0,d=r.length;t<d;++t)r[t].value.apply(a,o)}};var// how frequently we check for clock skew
Ta,Da,Xa=0,// is an animation frame pending?
Pa=0,// is a timeout pending?
Ra=0,Oa=0,Ya=0,qa=0,Va="object"==typeof performance&&performance.now?performance:Date,$a="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};Ue.prototype=Ge.prototype={constructor:Ue,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Ie():+n)+(null==t?0:+t),this._next||Da===this||(Da?Da._next=this:Ta=this,Da=this),this._call=e,this._time=n,Qe()},stop:function(){this._call&&(this._call=null,this._time=1/0,Qe())}};var Ba=ha*(3-ba(5));ct.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var Ia=.7,Ma=1/Ia,Ua="\\s*([+-]?\\d+)\\s*",Ga="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ha="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Fa=/^#([0-9a-f]{3})$/,Za=/^#([0-9a-f]{6})$/,Wa=new RegExp("^rgb\\("+[Ua,Ua,Ua]+"\\)$"),Qa=new RegExp("^rgb\\("+[Ha,Ha,Ha]+"\\)$"),Ka=new RegExp("^rgba\\("+[Ua,Ua,Ua,Ga]+"\\)$"),Ja=new RegExp("^rgba\\("+[Ha,Ha,Ha,Ga]+"\\)$"),ei=new RegExp("^hsl\\("+[Ga,Ha,Ha]+"\\)$"),ti=new RegExp("^hsla\\("+[Ga,Ha,Ha,Ga]+"\\)$"),ni={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};yt(_t,xt,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}}),yt(zt,wt,ft(_t,{brighter:function(e){return e=null==e?Ma:xa(Ma,e),new zt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Ia:xa(Ia,e),new zt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&255>=this.r&&0<=this.g&&255>=this.g&&0<=this.b&&255>=this.b&&0<=this.opacity&&1>=this.opacity},hex:function(){return"#"+Nt(this.r)+Nt(this.g)+Nt(this.b)},toString:function(){var e=this.opacity;return e=isNaN(e)?1:fa(0,wa(1,e)),(1===e?"rgb(":"rgba(")+fa(0,wa(255,_a(this.r)||0))+", "+fa(0,wa(255,_a(this.g)||0))+", "+fa(0,wa(255,_a(this.b)||0))+(1===e?")":", "+e+")")}})),yt(St,function(e,t,n,a){return 1===arguments.length?jt(e):new St(e,t,n,null==a?1:a)},ft(_t,{brighter:function(e){return e=null==e?Ma:xa(Ma,e),new St(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Ia:xa(Ia,e),new St(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(0>this.h),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,a=n+(.5>n?n:1-n)*t,i=2*n-a;return new zt(Ct(240<=e?e-240:e+120,i,a),Ct(e,i,a),Ct(120>e?e+240:e-120,i,a),this.opacity)},displayable:function(){return(0<=this.s&&1>=this.s||isNaN(this.s))&&0<=this.l&&1>=this.l&&0<=this.opacity&&1>=this.opacity}}));var ai=ha/180,ii=180/ha,oi=18,K=.96422,Xn=.82521,Zn=4/29,ri=6/29,di=3*ri*ri,li=ri*ri*ri;yt(Lt,function(e,t,n,a){return 1===arguments.length?Et(e):new Lt(e,t,n,null==a?1:a)},ft(_t,{brighter:function(e){return new Lt(this.l+oi*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Lt(this.l-oi*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=K*Dt(t),e=1*Dt(e),n=Xn*Dt(n),new zt(Xt(3.1338561*t-1.6168667*e-.4906146*n),Xt(-.9787684*t+1.9161415*e+.033454*n),Xt(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),yt(Ot,function(e,t,n,a){return 1===arguments.length?Rt(e):new Ot(e,t,n,null==a?1:a)},ft(_t,{brighter:function(e){return new Ot(this.h,this.c,this.l+oi*(null==e?1:e),this.opacity)},darker:function(e){return new Ot(this.h,this.c,this.l-oi*(null==e?1:e),this.opacity)},rgb:function(){return Et(this).rgb()}}));var si=-.14861,A=+1.78277,B=-.29227,C=-.90649,D=+1.97294,E=D*C,ci=D*A,pi=A*B-C*si;yt(qt,function(e,t,n,a){return 1===arguments.length?Yt(e):new qt(e,t,n,null==a?1:a)},ft(_t,{brighter:function(e){return e=null==e?Ma:xa(Ma,e),new qt(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Ia:xa(Ia,e),new qt(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*ai,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),a=ka(e),i=va(e);return new zt(255*(t+n*(si*a+A*i)),255*(t+n*(B*a+C*i)),255*(t+n*(D*a)),this.opacity)}}));var ui,gi,hi,mi,yi=function e(t){function n(e,t){var n=a((e=wt(e)).r,(t=wt(t)).r),i=a(e.g,t.g),o=a(e.b,t.b),r=Mt(e.opacity,t.opacity);return function(a){return e.r=n(a),e.g=i(a),e.b=o(a),e.opacity=r(a),e+""}}var a=It(t);return n.gamma=e,n}(1),fi=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_i=new RegExp(fi.source,"g"),xi=180/ha,vi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},ki=Kt(Wt,"px, ","px)","deg)"),bi=Kt(Qt,", ",")",")"),wi=Math.SQRT2,zi=1e-12,Ni=Ye("start","end","interrupt"),Ai=[],ji=ye.prototype.constructor,Si=0,Ci=ye.prototype;Un.prototype=function(e){return ye().transition(e)}.prototype={constructor:Un,select:Rn,selectAll:On,filter:function(e){"function"!=typeof e&&(e=c(e));for(var t=this._groups,a=t.length,o=Array(a),r=0;r<a;++r)for(var d,l=t[r],s=l.length,n=o[r]=[],p=0;p<s;++p)(d=l[p])&&e.call(d,d.__data__,p,l)&&n.push(d);return new Un(o,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,a=e._groups,o=t.length,r=a.length,d=wa(o,r),l=Array(o),s=0;s<d;++s)for(var c,p=t[s],u=a[s],g=p.length,n=l[s]=Array(g),h=0;h<g;++h)(c=p[h]||u[h])&&(n[h]=c);for(;s<o;++s)l[s]=t[s];return new Un(l,this._parents,this._name,this._id)},selection:function(){return new ji(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,a=Gn(),o=this._groups,r=o.length,d=0;d<r;++d)for(var l,s=o[d],c=s.length,n=0;n<c;++n)if(l=s[n]){var p=dn(l,t);an(l,e,a,n,s,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new Un(o,this._parents,e,a)},call:Ci.call,nodes:Ci.nodes,node:Ci.node,size:Ci.size,empty:Ci.empty,each:Ci.each,on:Dn,attr:function(t,n){var a=e(t),o="transform"===a?bi:hn;return this.attrTween(t,"function"==typeof n?(a.local?vn:xn)(a,o,gn(this,"attr."+t,n)):null==n?(a.local?yn:mn)(a):(a.local?_n:fn)(a,o,n+""))},attrTween:function(t,n){var a="attr."+t;if(2>arguments.length)return(a=this.tween(a))&&a._value;if(null==n)return this.tween(a,null);if("function"!=typeof n)throw new Error;var i=e(t);return this.tween(a,(i.local?kn:bn)(i,n))},style:function(e,t,n){var a="transform"==(e+="")?ki:hn;return null==t?this.styleTween(e,Yn(e,a)).on("end.style."+e,qn(e)):this.styleTween(e,"function"==typeof t?$n(e,a,gn(this,"style."+e,t)):Vn(e,a,t+""),n)},styleTween:function(e,t,n){var a="style."+(e+="");if(2>arguments.length)return(a=this.tween(a))&&a._value;if(null==t)return this.tween(a,null);if("function"!=typeof t)throw new Error;return this.tween(a,Bn(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?Mn(gn(this,"text",e)):In(null==e?"":e+""))},remove:function(){return this.on("end.remove",Pn(this._id))},tween:un,delay:Nn,duration:Sn,ease:En};var Ei={time:null,// Set on use.
delay:0,duration:250,ease:function(e){return(1>=(e*=2)?e*e*e:(e-=2)*e*e+2)/2}};ye.prototype.interrupt=function(e){return this.each(function(){sn(this,e)})},ye.prototype.transition=Fn,Kn.prototype={constructor:Kn,scale:function(e){return 1===e?this:new Kn(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Kn(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Li=new Kn(1,0,0),Ti={},Di={},Xi=pa(","),Pi=Xi.parse,Ri=Xi.parseRows,Oi=Xi.format,Yi=Xi.formatRows,qi=pa("\t"),Vi=qi.parse,$i=qi.parseRows,Bi=qi.format,Ii=qi.formatRows;class Mi{constructor(e,t={}){function n(){const e=`translate(${Aa.transform.x||0}, ${Aa.transform.y||0}) scale(${Aa.transform.k||1})`;this.svgGroup.attr("transform",e),this.currentZoom=Aa.transform.k,this.handlers.zoom&&this.handlers.zoom(e)}function a(e,t){Aa.active||t.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function i(e){e.fx=Aa.x,e.fy=Aa.y}function o(e,t){Aa.active||t.alphaTarget(0),e.fx=void 0,e.fy=void 0}this.options=t,this.links=[],this.nodes=[],this.handlers={},this.svg=fe(e),this.setCenter(),window.addEventListener("resize",()=>this.setCenter()),this.options.nodeRenderer.setup(this.svg),this.svgGroup=this.svg.append("g").attr("id","svgGroup");const r=nt(),d=this.options.charge&&this.options.charge(r)||r.strength(-100).distanceMin(1e3),l=m(),s=this.options.collide&&this.options.collide(l)||l.radius(e=>e.radius||e.width/2||50).iterations(2),c=at(this.center.x),p=this.options.forceX&&this.options.forceX(c)||c.strength(.1),u=it(this.center.y),g=this.options.forceY&&this.options.forceY(u)||u.strength(.1);this.simulation=tt().velocityDecay(this.options.velocityDecay||.55).force("link",Oe().distance(e=>e.distance||100).id(e=>e.id)).force("charge",d).force("collide",s).force("center",be(this.center.x,this.center.y)).force("x",p).force("y",g),this.drag=mt().on("start",e=>a(e,this.simulation)).on("drag",e=>i(e)).on("end",e=>o(e,this.simulation)),this.zoom=da().on("zoom",n.bind(this)),this.svg.call(this.zoom).call(this.drag),this.linkContainer=this.svgGroup.append("g").attr("class","links"),this.nodeContainer=this.svgGroup.append("g").attr("class","nodes"),this.update()}setCenter(){this.center={x:this.svg.node().width.baseVal.value/2,y:this.svg.node().height.baseVal.value/2}}addHandler(e,t){this.handlers[e]=t}update(){function e(e){return ba(xa(e.target.y-e.source.y,2)+xa(e.target.x-e.source.x,2))}function t(e){return e.radius||(e.width+e.height)/4||50}function n(n){const a=e(n),i=n.target.x-n.source.x;return n.source.x+i*(1-(a-t(n.source))/a)}function a(n){const a=e(n),i=n.target.x-n.source.x;return n.target.x-i*(1-(a-t(n.target))/a)}function i(n){const a=e(n),i=n.target.y-n.source.y;return n.source.y+i*(1-(a-t(n.source))/a)}function o(n){const a=e(n),i=n.target.y-n.source.y;return n.target.y-i*(1-(a-t(n.target))/a)}function r(){s.attr("x1",n).attr("y1",i).attr("x2",a).attr("y2",o).attr("class",e=>"level-"+fa(e.source.level,e.target.level)).attr("stroke-width",e=>e.width||1),p.attr("transform",e=>l.getTransformation.call(l,e)).attr("class",e=>l.getClass.call(l,e))}const l=this.options.nodeRenderer;let s=this.linkContainer.selectAll("line").data(this.links,e=>e.id);const c=s.enter().append("line");this.options.useMarkers&&c.attr("marker-start","url(#marker-start)").attr("marker-end","url(#marker-end)"),s.exit().remove(),s=c.merge(s),this.simulation.force("link").links(this.links);let p=this.nodeContainer.selectAll(".node").data(this.nodes,e=>e.id);const u=p.enter().append("g").attr("id",e=>"node-"+e.id).attr("class",l.getClass.bind(l)).call(this.drag).call(function(e){Object.keys(this.handlers).forEach(t=>e.on(t,this.handlers[t]))}.bind(this));p.exit().remove(),u.call(l.render.bind(l)),p=u.merge(p),this.simulation.nodes(this.nodes).on("tick",()=>r.bind(this)()),this.simulation.alpha(.3),this.simulation.restart()}getLinkedNodes(e){return this.links.filter(t=>t.source.id===e.id).map(e=>e.target).concat(this.links.filter(t=>t.target.id===e.id).map(e=>e.source))}nodesConnected(e,t){return this.getLinkedNodes(e).some(e=>e.id===t.id)}static isConnected(e,t){return e.source.id===t.id||e.target.id===t.id}add(e,t){e&&e.forEach(e=>!this.nodes.some(t=>t.id===e.id)&&this.nodes.push(e)),t&&t.forEach(e=>!this.nodesConnected(e.source,e.target)&&this.links.push(e))}static equalLinks(e,t){return t.source.id===e.source.id&&t.target.id===e.target.id||t.source.id===e.target.id&&t.target.id===e.source.id}remove(e,t){e.forEach(e=>{this.links=this.links.filter(t=>!Mi.isConnected(t,e)),this.nodes=this.nodes.filter(t=>t.id!==e.id)}),this.links=this.links.filter(e=>!t.some(t=>Mi.equalLinks(e,t)))}getConnections(e){return this.links.filter(t=>t.source.id===e.id||t.target.id===e.id)}updateNode(e){e=Object.assign(this.nodes.splice(this.nodes.findIndex(t=>t.id===e.id),1)[0],e),this.update(),this.nodes.push(e)}static fixNode(e){e.fx=e.x,e.fy=e.y}static releaseNode(e){e.fx=void 0,e.fy=void 0}scaleToNode(e,t,n=0,a=0){return new Promise(i=>{Mi.fixNode(e);const o=this.center.x+n,r=this.center.y+a;this.svg.transition().duration(1e3).call(this.zoom.transform,Li.translate(o,r).scale(t).translate(-e.x,-e.y)).on("end",()=>{Mi.releaseNode(e),i({x:o,y:r})})})}scale(e){return new Promise(t=>{const n=this.svgGroup.node().getAttribute("transform"),a=n&&n.match(/[\d.]+/g).map(e=>+e)||[0,0,1];this.svg.transition().duration(1e3).call(this.zoom.transform,Li.translate(e*a[0]-(e-1)*this.center.x,e*a[1]-(e-1)*this.center.y).scale(e*this.currentZoom)).on("end",()=>t(!0))})}hide(){this.svg.attr("style","opacity: 0; position: absolute; transition: opacity 0.5s")}show(){this.svg.attr("style","opacity: 1; transition: opacity 0.5s")}static getDomElement(e){return document.getElementById("node-"+e.id)}}class Ui{constructor(e={imageSuppressionLevel:-1,levelSteps:0}){this.options=e}setup(e){this.defs=e.append("defs")}render(e){this.renderCircle(e.filter(e=>"circle"===e.shape)),this.renderRect(e.filter(e=>"rect"===e.shape)),this.renderTitle(e),this.options.showRefLinks&&this.renderRefLinks(e)}renderCircle(e){e.append("circle").attr("r",e=>e.radius||50).attr("fill",this.getBackground.bind(this))}renderRect(e){e.append("rect").attr("x",e=>(e.width||100)/-2).attr("y",e=>(e.width||70)/-2).attr("width",e=>e.width||100).attr("height",e=>e.height||70).attr("fill",this.getBackground.bind(this))}renderTitle(e){e.append("g").classed("title",!0).append("text").text(e=>e.name).call(e=>this.wrap(e,(e.width||2*e.radius||100)-10))}calculateRefLinkPosition(e){const t=Object.keys(e.links||{}),n=ha/8,a=e.radius||70;return t.map((o,r)=>({type:o,fontSize:e.fontSize,x:a*ka((r-t.length/2)*n),y:a*va((r-t.length/2)*n)}))}renderRefLinks(e){e.append("g").attr("class","reflinks").selectAll(null).data(this.calculateRefLinkPosition.bind(this)).enter().append("g").attr("transform",e=>`translate(${e.x}, ${e.y})`).attr("data-ref",e=>e.type).append("text").call(this.renderRefLinksContent.bind(this))}renderRefLinksContent(e){e.text(e=>this.options.texts&&this.options.texts[e.type]||e.type).call(e=>this.makeTextBackground(e,!1,15,8))}getBackground(e){const t=0<=this.options.imageSuppressionLevel&&e.level>=this.options.imageSuppressionLevel;return!e.image||t?"#eef":(this.defs.select("#bg-"+e.id).remove(),this.defs.append("pattern").attr("id",()=>"bg-"+e.id).attr("height",1).attr("width",1).append("image").attr("xlink:href",e.image.replace(/ /g,"%20")).attr("height","100px").attr("width","100px").attr("preserveAspectRatio","xMidYMid slice"),"url(#bg-"+e.id+")")}getTransformation(e){const t=this.options.levelSteps?` scale(${1-(e.level||1)*this.options.levelSteps})`:"";return`translate(${[e.x||0,e.y||0]})${t}`}getClass(e){return["node",e.className,e.open&&"open",e.image&&"withBg","level-"+e.level].filter(e=>e).join(" ")}wrap(e,t,n=!1){const a=this;e.each(function(e){e.fontSize=e.fontSize||1;const i=fe(this).attr("style","font-size: "+14*e.fontSize+"px"),o=(e.name||"").split(/[\s-]+/).reverse();let r,d=[],l=i.text(null).append("tspan"),s=0;for(;r=o.pop();)d.push(r),l.text(d.join(" ")),1<d.length&&l.node().getComputedTextLength()>t&&(d.pop(),l.text(d.join(" ")),s++,d=[r],l=i.append("tspan").attr("x",0).attr("dy",1.1+"em").text(r));i.attr("y",.3*-s+"em"),e.bbox=a.makeTextBackground(i,n&&t)})}makeTextBackground(e,t,n=5,a=3){let i;return e.each(function(){const e=document.createElementNS("http://www.w3.org/2000/svg","rect");i=this.getBBox(),e.setAttribute("class","text-bg"),e.setAttribute("x",i.x-n),e.setAttribute("y",i.y-a),e.setAttribute("width",(t||i.width)+2*n),e.setAttribute("height",i.height+2*a),this.parentNode.insertBefore(e,this)}),i}}let Gi=1;const Hi=e=>e.reduce((e,t)=>fa(e,t.id),0)+1,Fi={maxLevel:99999,handlers:{error:()=>{}},logger:console};class Zi{constructor(e,t,n={}){"string"==typeof e&&(Fi.logger.warn("Deprecation notice: Using separate parameters for Network constructor is deprecated, use options structure instead."),e={dataUrl:e,domSelector:t,handlers:n}),this.options=Object.assign({},Fi,e),this.options.nodeRenderer=this.options.nodeRenderer||new Ui,ga(this.options.dataUrl,e.fetchOptions).then(e=>this.options.handlers.prepare?this.options.handlers.prepare(e):e).then(e=>{const t=document.querySelector(this.options.domSelector);this.diagram=new Mi(t,this.options),this.options.handlers.showDetails&&(this.details=document.createElement("div"),this.details.setAttribute("class","details"),document.body.append(this.details)),this.options.handlers.clickOnNode=this.options.handlers.clickOnNode||this.showDetails.bind(this),this.options.handlers.clickOnRefLink=this.options.handlers.clickOnRefLink||this.toggleNodes.bind(this),this.nodes=e.nodes,this.links=this.computeLinks(this.nodes);this.links.filter(e=>e.source.open||e.target.open).map(e=>e.source.visible=e.target.visible=!0);const n=this.links.filter(e=>e.source.visible&&e.target.visible),a=this.nodes.filter(e=>e.visible);this.setDistancesToNode(a[0]||this.nodes[0]),this.diagram.add(a,n),this.diagram.update(),setTimeout(()=>{document.body.classList.add("initialized"),this.options.handlers.initialized&&this.options.handlers.initialized()},0)}).catch(e=>this.options.logger.error(e));const a=this;document.addEventListener("click",function(e){if(!1===a.handleClicks(e))return e.stopImmediatePropagation(),e.preventDefault(),!1})}handleClicks(e){const t=e.path||e.composedPath&&e.composedPath()||[],n={reflinks:e=>this.options.handlers.clickOnRefLink(t[e+1].__data__,t[e-1].dataset.ref),node:e=>this.options.handlers.clickOnNode(t[e].__data__)};return!!Object.keys(n).findIndex(e=>{const a=t.findIndex(n=>n.classList&&n.classList.contains(e));return 0<=a&&n[e](a),0<=a})}computeLinks(e){const t=this.options.handlers.prepareLink||(e=>e);return e.forEach(e=>{e.links=e.links||{},e.linkedNodes={}}),e.map(e=>Object.keys(e.links).map(n=>e.links[n]=e.links[n].map(n=>(n=this.getNode(n.target&&n.target.id||n),e.linkedNodes[n.id]=n,n.linkedNodes[e.id]=e,t({id:Gi++,source:e,target:n})))).reduce((e,t)=>e.concat(t),[])).reduce((e,t)=>e.concat(t),[])}setLevel(e,t){e.level>t&&(e.level=t,t<this.options.maxLevel&&Object.values(e.linkedNodes).forEach(e=>this.setLevel(e,t+1)))}setDistancesToNode(e){this.nodes.forEach(e=>e.level=this.options.maxLevel),this.setLevel(e,0)}showDetails(e){Mi.fixNode(e);const t=Mi.getDomElement(e),n=document.createElement("div"),a=document.createElement("div");a.setAttribute("class","detailForm"),n.appendChild(a),this.details.appendChild(n);const i=this.options.detailsDialogOffsetX||-175,o=this.options.detailsDialogOffsetY||-30;this.diagram.scaleToNode(e,1.2,i,o).then(({y:a})=>{document.body.classList.add("dialogOpen"),t.classList.add("menuActive"),this.setDistancesToNode(e),n.setAttribute("style","padding-top: "+(a-123)+"px")}).then(()=>e.details?ga(e.details):e).then(t=>this.options.handlers.showDetails(t,a,e)).catch(this.options.logger.error).then(n=>{e=n||e,document.body.classList.remove("dialogOpen"),t.classList.remove("menuActive"),this.details.innerHTML="",this.diagram.updateNode(e),this.diagram.update()})}getNumClosedLinks(e){return Object.keys(e.linkedNodes).length-this.getNumOpenLinks(e)}getNumOpenLinks(e){return this.diagram.links.filter(t=>t.source.id===e.id||t.target.id===e.id).length}toggleNodes(e,t){const n=e.links[t];if(n&&n.length){const t=n.filter(t=>this.diagram.nodesConnected(t.target,e)),a=t.length===n.length;if(a){this.diagram.remove([],n);const e=n.map(e=>e.target).filter(e=>!this.diagram.getConnections(e).length);this.diagram.remove(e,[])}else n.forEach(e=>e.target.visible=!0),this.diagram.add(n.map(e=>e.target),n);this.diagram.update()}}showNodes(e,t){const n=(e.links[t]||[]).filter(e=>!e.target.visible).map(e=>e.target).filter(e=>e.visible=!0);n.length&&(this.diagram.add(n,e.links[t]),this.diagram.update())}getNumberOfVisibleConnections(e){return Object.keys(e.links).reduce((t,n)=>t+e.links[n].filter(e=>e.target.visible).length,0)}hideNodes(e,t){const n=(e.links[t]||[]).map(e=>e.target).filter(e=>e.visible&&1===this.getNumberOfVisibleConnections(e)).filter(e=>!(e.visible=!1));(n.length||e.links[t].length)&&(this.diagram.remove(n,e.links[t]),this.diagram.update())}toggle(e){return e.open?this.closeNode(e):this.openNode(e)}closeNode(e){e.open=!1,this.links.filter(t=>t.source.id===e.id||t.target.id===e.id).forEach(t=>{const n=t.source.id===e.id?t.target:t.source;1===this.diagram.getLinkedNodes(n).length?(n.visible=n.keepVisible,!n.visible&&this.diagram.remove([n],[])):this.diagram.remove([],[t])}),this.diagram.scaleToNode(e,1),this.diagram.update()}openNode(e){e.open=!0,this.links.filter(t=>t.source.id===e.id||t.target.id===e.id).forEach(t=>{const n=t.source.id===e.id?t.target:t.source;n.visible=!0,n.x=e.x,n.y=e.y,this.diagram.add([n],[t])}),this.diagram.scaleToNode(e,1),this.diagram.update()}addNode(e){const t=this.computeLinks([e]);this.nodes.push(e),t.forEach(e=>this.links.push(e)),this.diagram.add([e],t)}removeNode(e){this.nodes=this.nodes.filter(t=>t.id!==e.id),this.links=this.links.filter(t=>t.source.id!==e.id&&t.target.id!==e.id),this.diagram.remove([e],[]),this.diagram.update(),this.options.handlers.nodeRemoved&&this.options.handlers.nodeRemoved(e)}getNode(e){return this.nodes.find(t=>t.id===e)}updateNode(e){this.updateNodes([e])}updateNodes(e){this.computeLinks(e),e.forEach(e=>this.diagram.updateNode(e)),this.diagram.update()}scaleToNode(e){this.diagram.scaleToNode(e,1)}addLinks(e){this.diagram.add([],e.map(e=>({id:Gi++,source:this.getNode(e.source.id),target:this.getNode(e.target.id)})).map(e=>(this.links.push(e),e)))}removeLinks(e){const t=(e,t)=>e.source.id===t.source.id&&e.target.id===t.target.id;this.links=this.links.filter(n=>!e.some(e=>t(n,e))),this.diagram.remove([],e)}newConnection(e){this.options.handlers.nameRequired().then(e=>e?e:Promise.reject("no name given")).then(t=>{let n=this.nodes.find(e=>e.name.toLowerCase()===t.toLowerCase());if(n||(n=this.options.handlers.newNode?this.options.handlers.newNode(t):{name:t},n.id=n.id||Hi(this.nodes),this.nodes.push(n),this.diagram.add([n],[])),!this.diagram.nodesConnected(e,n)){const t={id:Gi++,source:e,target:n};this.options.handlers.newLink&&this.options.handlers.newLink(t),this.links.push(t),this.diagram.add([],[t])}this.diagram.update()}).catch(this.options.handlers.error)}update(){this.diagram.update()}scale(e){return this.diagram.scale(e)}}window.ForceDiagram=Mi,window.Network=Zi,window.NodeRenderer=Ui;return{Network:Zi,ForceDiagram:Mi,NodeRenderer:Ui}}();
//# sourceMappingURL=bundle.js.map
