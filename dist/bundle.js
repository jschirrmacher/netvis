var NetVis=function(){'use strict';var gi=Math.PI,mi=Math.exp,yi=Math.atan2,fi=Math.max,_i=Math.round,xi=Math.pow,vi=Math.sin,bi=Math.cos,ki=Math.sqrt,wi=Math.min;function e(e){var t=e+="",n=t.indexOf(":");return 0<=n&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),zi.hasOwnProperty(t)?{space:zi[t],local:e}:e}function t(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n==="http://www.w3.org/1999/xhtml"&&t.documentElement.namespaceURI==="http://www.w3.org/1999/xhtml"?t.createElement(e):t.createElementNS(n,e)}}function n(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function i(i){var a=e(i);return(a.local?n:t)(a)}function a(){}function o(e){return null==e?a:function(){return this.querySelector(e)}}function r(e){"function"!=typeof e&&(e=o(e));for(var t=this._groups,a=t.length,r=Array(a),l=0;l<a;++l)for(var d,s,c=t[l],p=c.length,n=r[l]=Array(p),u=0;u<p;++u)(d=c[u])&&(s=e.call(d,d.__data__,u,c))&&("__data__"in d&&(s.__data__=d.__data__),n[u]=s);return new ge(r,this._parents)}function l(){return[]}function d(e){return null==e?l:function(){return this.querySelectorAll(e)}}function s(e){return function(){return this.matches(e)}}function c(e){return Array(e.length)}function p(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function u(e){return function(){return e}}// Protect against keys like “__proto__”.
function h(e,t,n,a,o,r){// Put any non-null nodes that fit into update.
// Put any null nodes into enter.
// Put any remaining data into enter.
for(var l,d=0,s=t.length,c=r.length;d<c;++d)(l=t[d])?(l.__data__=r[d],a[d]=l):n[d]=new p(e,r[d]);// Put any non-null nodes that don’t fit into exit.
for(;d<s;++d)(l=t[d])&&(o[d]=l)}function g(e,t,n,a,o,r,l){var d,s,c,u={},h=t.length,g=r.length,m=Array(h);// Compute the key for each node.
// If multiple nodes have the same key, the duplicates are added to exit.
for(d=0;d<h;++d)(s=t[d])&&(m[d]=c="$"+l.call(s,s.__data__,d,t),c in u?o[d]=s:u[c]=s);// Compute the key for each datum.
// If there a node associated with this key, join and add it to update.
// If there is not (or the key is a duplicate), add it to enter.
for(d=0;d<g;++d)c="$"+l.call(e,r[d],d,r),(s=u[c])?(a[d]=s,s.__data__=r[d],u[c]=null):n[d]=new p(e,r[d]);// Add any remaining nodes that were not bound to data to exit.
for(d=0;d<h;++d)(s=t[d])&&u[m[d]]===s&&(o[d]=s)}function f(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function _(e){return function(){this.removeAttribute(e)}}function v(e){return function(){this.removeAttributeNS(e.space,e.local)}}function b(e,t){return function(){this.setAttribute(e,t)}}function k(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function w(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function z(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function N(e){return e.ownerDocument&&e.ownerDocument.defaultView||// node is a Node
e.document&&e// node is a Window
||e.defaultView;// node is a Document
}function j(e){return function(){this.style.removeProperty(e)}}function S(e,t,n){return function(){this.style.setProperty(e,t,n)}}function L(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function T(e,t){return e.style.getPropertyValue(t)||N(e).getComputedStyle(e,null).getPropertyValue(t)}function X(e){return function(){delete this[e]}}function P(e,t){return function(){this[e]=t}}function R(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function O(e){return e.trim().split(/^|\s+/)}function Y(e){return e.classList||new q(e)}function q(e){this._node=e,this._names=O(e.getAttribute("class")||"")}function V(e,t){for(var a=Y(e),o=-1,r=t.length;++o<r;)a.add(t[o])}function $(e,t){for(var a=Y(e),o=-1,r=t.length;++o<r;)a.remove(t[o])}function M(e){return function(){V(this,e)}}function I(e){return function(){$(this,e)}}function U(e,t){return function(){(t.apply(this,arguments)?V:$)(this,e)}}function G(){this.textContent=""}function H(e){return function(){this.textContent=e}}function F(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Z(){this.innerHTML=""}function W(e){return function(){this.innerHTML=e}}function Q(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function J(){this.nextSibling&&this.parentNode.appendChild(this)}function ee(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function te(){return null}function ne(){var e=this.parentNode;e&&e.removeChild(this)}function ie(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function ae(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}function oe(e,t,n){return e=re(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function re(e,t,n){return function(i){var a=Ai;// Events can be reentrant (e.g., focus).
Ai=i;try{e.call(this,this.__data__,t,n)}finally{Ai=a}}}function le(e){return e.trim().split(/^|\s+/).map(function(e){var n="",a=e.indexOf(".");return 0<=a&&(n=e.slice(a+1),e=e.slice(0,a)),{type:e,name:n}})}function de(e){return function(){var t=this.__on;if(t){for(var n,a=0,r=-1,l=t.length;a<l;++a)(n=t[a],(!e.type||n.type===e.type)&&n.name===e.name)?this.removeEventListener(n.type,n.listener,n.capture):t[++r]=n;++r?t.length=r:delete this.__on}}}function se(e,t,n){var a=Ni.hasOwnProperty(e.type)?oe:re;return function(r,l,i){var d,s=this.__on,c=a(t,l,i);if(s)for(var p=0,u=s.length;p<u;++p)if((d=s[p]).type===e.type&&d.name===e.name)return this.removeEventListener(d.type,d.listener,d.capture),this.addEventListener(d.type,d.listener=c,d.capture=n),void(d.value=t);this.addEventListener(e.type,c,n),d={type:e.type,name:e.name,value:t,listener:c,capture:n},s?s.push(d):this.__on=[d]}}function ce(e,t,n,i){var a=Ai;e.sourceEvent=Ai,Ai=e;try{return t.apply(n,i)}finally{Ai=a}}function pe(e,t,n){var i=N(e),a=i.CustomEvent;"function"==typeof a?a=new a(t,n):(a=i.document.createEvent("Event"),n?(a.initEvent(t,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(t,!1,!1)),e.dispatchEvent(a)}function ue(e,t){return function(){return pe(this,e,t)}}function he(e,t){return function(){return pe(this,e,t.apply(this,arguments))}}function ge(e,t){this._groups=e,this._parents=t}function me(){return new ge([[document.documentElement]],Si)}function ye(e){return"string"==typeof e?new ge([[document.querySelector(e)]],[document.documentElement]):new ge([[e]],Si)}function fe(){for(var e,t=Ai;e=t.sourceEvent;)t=e;return t}function _e(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}function xe(e){var t=fe();return t.changedTouches&&(t=t.changedTouches[0]),_e(e,t)}function ve(e,t,a){3>arguments.length&&(a=t,t=fe().changedTouches);for(var o,r=0,l=t?t.length:0;r<l;++r)if((o=t[r]).identifier===a)return _e(e,o);return null}function be(e,t){function n(){var o,r,l=a.length,n=0,d=0;for(o=0;o<l;++o)r=a[o],n+=r.x,d+=r.y;for(n=n/l-e,d=d/l-t,o=0;o<l;++o)r=a[o],r.x-=n,r.y-=d}var a;return null==e&&(e=0),null==t&&(t=0),n.initialize=function(e){a=e},n.x=function(t){return arguments.length?(e=+t,n):e},n.y=function(e){return arguments.length?(t=+e,n):t},n}function ke(e){return function(){return e}}function we(){return 1e-6*(Math.random()-.5)}function ze(e,t,n,a){if(isNaN(t)||isNaN(n))return e;// ignore invalid points
var o,r,l,d,s,c,p,u,h,g=e._root,m={data:a},y=e._x0,f=e._y0,_=e._x1,x=e._y1;// If the tree is empty, initialize the root as a leaf.
if(!g)return e._root=m,e;// Find the existing leaf for the new point, or add it.
for(;g.length;)if((c=t>=(r=(y+_)/2))?y=r:_=r,(p=n>=(l=(f+x)/2))?f=l:x=l,(o=g,!(g=g[u=p<<1|c])))return o[u]=m,e;// Is the new point is exactly coincident with the existing point?
if(d=+e._x.call(null,g.data),s=+e._y.call(null,g.data),t===d&&n===s)return m.next=g,o?o[u]=m:e._root=m,e;// Otherwise, split the leaf node until the old and new point are separated.
do o=o?o[u]=[,,,,]:e._root=[,,,,],(c=t>=(r=(y+_)/2))?y=r:_=r,(p=n>=(l=(f+x)/2))?f=l:x=l;while((u=p<<1|c)==(h=(s>=l)<<1|d>=r));return o[h]=g,o[u]=m,e}function Ne(e,t,n,i,a){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=a}function Ae(e){return e[0]}function je(e){return e[1]}function Se(e,t,n){var i=new Ee(null==t?Ae:t,null==n?je:n,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function Ee(e,t,n,i,a,o){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=a,this._y1=o,this._root=void 0}function Ce(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}function Le(e){return e.x+e.vx}function m(e){return e.y+e.vy}function y(e){function t(){function e(e,t,n,i,a){var o=e.data,s=e.r,m=h+s;if(o){if(o.index>c.index){var f=p-o.x-o.vx,_=u-o.y-o.vy,v=f*f+_*_;v<m*m&&(0===f&&(f=we(),v+=f*f),0===_&&(_=we(),v+=_*_),v=(m-(v=ki(v)))/v*d,c.vx+=(f*=v)*(m=(s*=s)/(g+s)),c.vy+=(_*=v)*m,o.vx-=f*(m=1-m),o.vy-=_*m)}return}return t>p+m||i<p-m||n>u+m||a<u-m}for(var t,o,c,p,u,h,g,y=r.length,n=0;n<s;++n)for(o=Se(r,Le,m).visitAfter(a),t=0;t<y;++t)c=r[t],h=l[c.index],g=h*h,p=c.x+c.vx,u=c.y+c.vy,o.visit(e)}function a(e){if(e.data)return e.r=l[e.data.index];for(var t=e.r=0;4>t;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function o(){if(r){var t,a,o=r.length;for(l=Array(o),t=0;t<o;++t)a=r[t],l[a.index]=+e(a,t,r)}}var r,l,d=1,s=1;return"function"!=typeof e&&(e=ke(null==e?1:+e)),t.initialize=function(e){r=e,o()},t.iterations=function(e){return arguments.length?(s=+e,t):s},t.strength=function(e){return arguments.length?(d=+e,t):d},t.radius=function(n){return arguments.length?(e="function"==typeof n?n:ke(+n),o(),t):e},t}function x(){}function Te(e,t){var a=new x;// Copy constructor.
if(e instanceof x)e.each(function(e,t){a.set(t,e)});// Index array by numeric index or specified key function.
else if(Array.isArray(e)){var r,l=-1,d=e.length;if(null==t)for(;++l<d;)a.set(l,e[l]);else for(;++l<d;)a.set(t(r=e[l],l,e),r)}// Convert object to map.
else if(e)for(var n in e)a.set(n,e[n]);return a}function De(){}function Xe(e,t){var a=new De;// Copy constructor.
if(e instanceof De)e.each(function(e){a.add(e)});// Otherwise, assume it’s an array.
else if(e){var o=-1,r=e.length;if(null==t)for(;++o<r;)a.add(e[o]);else for(;++o<r;)a.add(t(e[o],o,e))}return a}function Pe(e){return e.index}function Re(e,t){var n=e.get(t);if(!n)throw new Error("missing: "+t);return n}function Oe(e){function t(e){return 1/wi(c[e.source.index],c[e.target.index])}function n(t){for(var a=0,o=e.length;a<g;++a)for(var n,s,c,u,h,m,f,_=0;_<o;++_)n=e[_],s=n.source,c=n.target,u=c.x+c.vx-s.x-s.vx||we(),h=c.y+c.vy-s.y-s.vy||we(),m=ki(u*u+h*h),m=(m-d[_])/m*t*r[_],u*=m,h*=m,c.vx-=u*(f=p[_]),c.vy-=h*f,s.vx+=u*(f=1-f),s.vy+=h*f}function i(){if(s){var t,l,h=s.length,n=e.length,g=Te(s,u);for(t=0,c=Array(h);t<n;++t)l=e[t],l.index=t,"object"!=typeof l.source&&(l.source=Re(g,l.source)),"object"!=typeof l.target&&(l.target=Re(g,l.target)),c[l.source.index]=(c[l.source.index]||0)+1,c[l.target.index]=(c[l.target.index]||0)+1;for(t=0,p=Array(n);t<n;++t)l=e[t],p[t]=c[l.source.index]/(c[l.source.index]+c[l.target.index]);r=Array(n),a(),d=Array(n),o()}}function a(){if(s)for(var t=0,a=e.length;t<a;++t)r[t]=+l(e[t],t,e)}function o(){if(s)for(var t=0,a=e.length;t<a;++t)d[t]=+h(e[t],t,e)}var r,d,s,c,p,u=Pe,l=t,h=ke(30),g=1;return null==e&&(e=[]),n.initialize=function(e){s=e,i()},n.links=function(t){return arguments.length?(e=t,i(),n):e},n.id=function(e){return arguments.length?(u=e,n):u},n.iterations=function(e){return arguments.length?(g=+e,n):g},n.strength=function(e){return arguments.length?(l="function"==typeof e?e:ke(+e),a(),n):l},n.distance=function(e){return arguments.length?(h="function"==typeof e?e:ke(+e),o(),n):h},n}function Ye(){for(var e,a=0,o=arguments.length,n={};a<o;++a){if(!(e=arguments[a]+"")||e in n)throw new Error("illegal type: "+e);n[e]=[]}return new qe(n)}function qe(e){this._=e}function Ve(e,n){return e.trim().split(/^|\s+/).map(function(e){var a="",o=e.indexOf(".");if(0<=o&&(a=e.slice(o+1),e=e.slice(0,o)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:a}})}function $e(e,t){for(var a,o=0,r=e.length;o<r;++o)if((a=e[o]).name===t)return a.value}function Be(e,t,a){for(var o=0,r=e.length;o<r;++o)if(e[o].name===t){e[o]=Li,e=e.slice(0,o).concat(e.slice(o+1));break}return null!=a&&e.push({name:t,value:a}),e}function Me(){return Yi||($i(Ie),Yi=Vi.now()+qi)}function Ie(){Yi=0}function Ue(){this._call=this._time=this._next=null}function Ge(e,n,i){var a=new Ue;return a.restart(e,n,i),a}function He(){Me(),++Xi;for(// Pretend we’ve set an alarm, if we haven’t already.
var n,i=Ti;i;)0<=(n=Yi-i._time)&&i._call.call(null,n),i=i._next;--Xi}function Fe(){Yi=(Oi=Vi.now())+qi,Xi=Pi=0;try{He()}finally{Xi=0,We(),Yi=0}}function Ze(){var e=Vi.now(),t=e-Oi;t>1000&&(qi-=t,Oi=e)}function We(){for(var e,t,n=Ti,i=1/0;n;)n._call?(i>n._time&&(i=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Ti=t);Di=e,Qe(i)}function Qe(e){if(!Xi){Pi&&(Pi=clearTimeout(Pi));var t=e-Yi;// Strictly less than if we recomputed clockNow.
24<t?(e<1/0&&(Pi=setTimeout(Fe,e-Vi.now()-qi)),Ri&&(Ri=clearInterval(Ri))):(!Ri&&(Oi=Vi.now(),Ri=setInterval(Ze,1000)),Xi=1,$i(Fe))}// Soonest alarm already set, or will be.
}function Ke(e,n,i){var a=new Ue;return n=null==n?0:+n,a.restart(function(t){a.stop(),e(t+n)},n,i),a}function Je(e){return e.x}function et(e){return e.y}function tt(e){function t(){n(),h.call("tick",o),r<l&&(u.stop(),h.call("end",o))}function n(t){var a,l,u=e.length;void 0===t&&(t=1);for(var n=0;n<t;++n)for(r+=(s-r)*d,p.each(function(e){e(r)}),a=0;a<u;++a)l=e[a],null==l.fx?l.x+=l.vx*=c:(l.x=l.fx,l.vx=0),null==l.fy?l.y+=l.vy*=c:(l.y=l.fy,l.vy=0);return o}function i(){for(var t,a=0,o=e.length;a<o;++a){if(t=e[a],t.index=a,isNaN(t.fx)||(t.x=t.fx),isNaN(t.fy)||(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var n=10*ki(a),r=a*Bi;t.x=n*bi(r),t.y=n*vi(r)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function a(t){return t.initialize&&t.initialize(e),t}var o,r=1,l=.001,d=1-xi(l,1/300),s=0,c=.6,p=Te(),u=Ge(t),h=Ye("tick","end");return null==e&&(e=[]),i(),o={tick:n,restart:function(){return u.restart(t),o},stop:function(){return u.stop(),o},nodes:function(t){return arguments.length?(e=t,i(),p.each(a),o):e},alpha:function(e){return arguments.length?(r=+e,o):r},alphaMin:function(e){return arguments.length?(l=+e,o):l},alphaDecay:function(e){return arguments.length?(d=+e,o):+d},alphaTarget:function(e){return arguments.length?(s=+e,o):s},velocityDecay:function(e){return arguments.length?(c=1-e,o):1-c},force:function(e,t){return 1<arguments.length?(null==t?p.remove(e):p.set(e,a(t)),o):p.get(e)},find:function(t,a,o){var r,l,d,s,c,p=0,u=e.length;for(null==o?o=1/0:o*=o,p=0;p<u;++p)s=e[p],r=t-s.x,l=a-s.y,d=r*r+l*l,d<o&&(c=s,o=d);return c},on:function(e,t){return 1<arguments.length?(h.on(e,t),o):h.on(e)}}}function nt(){function e(e){var t,l=r.length,n=Se(r,Je,et).visitAfter(a);for(s=e,t=0;t<l;++t)d=r[t],n.visit(o)}function t(){if(r){var e,t,a=r.length;for(c=Array(a),e=0;e<a;++e)t=r[e],c[t.index]=+p(t,e,r)}}function a(e){var n,a,o,r,l,t=Math.abs,d=0,s=0;// For internal nodes, accumulate forces from child quadrants.
if(e.length){for(o=r=l=0;4>l;++l)(n=e[l])&&(a=t(n.value))&&(d+=n.value,s+=a,o+=a*n.x,r+=a*n.y);e.x=o/s,e.y=r/s}// For leaf nodes, accumulate forces from coincident quadrants.
else{n=e,n.x=n.data.x,n.y=n.data.y;do d+=c[n.data.index];while(n=n.next)}e.value=d}function o(e,t,n,i){if(!e.value)return!0;var a=e.x-d.x,o=e.y-d.y,r=i-t,p=a*a+o*o;// Apply the Barnes-Hut approximation if possible.
// Limit forces for very close nodes; randomize direction if coincident.
if(r*r/g<p)return p<h&&(0===a&&(a=we(),p+=a*a),0===o&&(o=we(),p+=o*o),p<u&&(p=ki(u*p)),d.vx+=a*e.value*s/p,d.vy+=o*e.value*s/p),!0;// Otherwise, process points directly.
// Limit forces for very close nodes; randomize direction if coincident.
if(!(e.length||p>=h)){(e.data!==d||e.next)&&(0===a&&(a=we(),p+=a*a),0===o&&(o=we(),p+=o*o),p<u&&(p=ki(u*p)));do e.data!==d&&(r=c[e.data.index]*s/p,d.vx+=a*r,d.vy+=o*r);while(e=e.next)}}var r,d,s,c,p=ke(-30),u=1,h=1/0,g=.81;return e.initialize=function(e){r=e,t()},e.strength=function(n){return arguments.length?(p="function"==typeof n?n:ke(+n),t(),e):p},e.distanceMin=function(t){return arguments.length?(u=t*t,e):ki(u)},e.distanceMax=function(t){return arguments.length?(h=t*t,e):ki(h)},e.theta=function(t){return arguments.length?(g=t*t,e):ki(g)},e}function it(e){function t(e){for(var t,l=0,d=a.length;l<d;++l)t=a[l],t.vx+=(r[l]-t.x)*o[l]*e}function n(){if(a){var t,d=a.length;for(o=Array(d),r=Array(d),t=0;t<d;++t)o[t]=isNaN(r[t]=+e(a[t],t,a))?0:+l(a[t],t,a)}}var a,o,r,l=ke(.1);return"function"!=typeof e&&(e=ke(null==e?0:+e)),t.initialize=function(e){a=e,n()},t.strength=function(e){return arguments.length?(l="function"==typeof e?e:ke(+e),n(),t):l},t.x=function(i){return arguments.length?(e="function"==typeof i?i:ke(+i),n(),t):e},t}function at(e){function t(e){for(var t,l=0,d=a.length;l<d;++l)t=a[l],t.vy+=(r[l]-t.y)*o[l]*e}function n(){if(a){var t,d=a.length;for(o=Array(d),r=Array(d),t=0;t<d;++t)o[t]=isNaN(r[t]=+e(a[t],t,a))?0:+l(a[t],t,a)}}var a,o,r,l=ke(.1);return"function"!=typeof e&&(e=ke(null==e?0:+e)),t.initialize=function(e){a=e,n()},t.strength=function(e){return arguments.length?(l="function"==typeof e?e:ke(+e),n(),t):l},t.y=function(i){return arguments.length?(e="function"==typeof i?i:ke(+i),n(),t):e},t}function ot(){Ai.stopImmediatePropagation()}function rt(){Ai.preventDefault(),Ai.stopImmediatePropagation()}function lt(e){var t=e.document.documentElement,n=ye(e).on("dragstart.drag",rt,!0);"onselectstart"in t?n.on("selectstart.drag",rt,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function dt(e,t){var n=e.document.documentElement,i=ye(e).on("dragstart.drag",null);t&&(i.on("click.drag",rt,!0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function st(e){return function(){return e}}function ct(e,t,n,i,a,o,r,l,d,s){this.target=e,this.type=t,this.subject=n,this.identifier=i,this.active=a,this.x=o,this.y=r,this.dx=l,this.dy=d,this._=s}// Ignore right-click, since that should open the context menu.
function pt(){return!Ai.button}function ut(){return this.parentNode}function ht(e){return null==e?{x:Ai.x,y:Ai.y}:e}function gt(){return"ontouchstart"in this}function mt(){function e(e){e.on("mousedown.drag",t).filter(m).on("touchstart.drag",a).on("touchmove.drag",o).on("touchend.drag touchcancel.drag",r).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function t(){if(!p&&u.apply(this,arguments)){var e=l("mouse",h.apply(this,arguments),xe,this,arguments);e&&(ye(Ai.view).on("mousemove.drag",n,!0).on("mouseup.drag",i,!0),lt(Ai.view),ot(),c=!1,d=Ai.clientX,s=Ai.clientY,e("start"))}}function n(){if(rt(),!c){var e=Ai.clientX-d,t=Ai.clientY-s;c=e*e+t*t>x}y.mouse("drag")}function i(){ye(Ai.view).on("mousemove.drag mouseup.drag",null),dt(Ai.view,c),rt(),y.mouse("end")}function a(){if(u.apply(this,arguments)){var e,t,a=Ai.changedTouches,o=h.apply(this,arguments),r=a.length;for(e=0;e<r;++e)(t=l(a[e].identifier,o,ve,this,arguments))&&(ot(),t("start"))}}function o(){var e,t,a=Ai.changedTouches,o=a.length;for(e=0;e<o;++e)(t=y[a[e].identifier])&&(rt(),t("drag"))}function r(){var e,t,a=Ai.changedTouches,o=a.length;// Ghost clicks are delayed!
for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),e=0;e<o;++e)(t=y[a[e].identifier])&&(ot(),t("end"))}function l(t,n,i,a,o){var r,l,d,c=i(n,t),u=f.copy();return ce(new ct(e,"beforestart",r,t,_,c[0],c[1],0,0,u),function(){return null!=(Ai.subject=r=g.apply(a,o))&&(l=r.x-c[0]||0,d=r.y-c[1]||0,!0)})?function s(p){var h,g=c;switch(p){case"start":y[t]=s,h=_++;break;case"end":delete y[t],--_;// nobreak
case"drag":c=i(n,t),h=_;}ce(new ct(e,p,r,t,h,c[0]+l,c[1]+d,c[0]-g[0],c[1]-g[1],u),u.apply,u,[p,a,o])}:void 0}var d,s,c,p,u=pt,h=ut,g=ht,m=gt,y={},f=Ye("start","drag","end"),_=0,x=0;return e.filter=function(t){return arguments.length?(u="function"==typeof t?t:st(!!t),e):u},e.container=function(t){return arguments.length?(h="function"==typeof t?t:st(t),e):h},e.subject=function(t){return arguments.length?(g="function"==typeof t?t:st(t),e):g},e.touchable=function(t){return arguments.length?(m="function"==typeof t?t:st(!!t),e):m},e.on=function(){var t=f.on.apply(f,arguments);return t===f?e:t},e.clickDistance=function(t){return arguments.length?(x=(t=+t)*t,e):ki(x)},e}function yt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function ft(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function _t(){}function xt(e){var t;return e=(e+"").trim().toLowerCase(),(t=Fi.exec(e))?(t=parseInt(t[1],16),new zt(15&t>>8|240&t>>4,15&t>>4|240&t,(15&t)<<4|15&t,1)// #f00
):(t=Zi.exec(e))?vt(parseInt(t[1],16))// #ff0000
:(t=Wi.exec(e))?new zt(t[1],t[2],t[3],1)// rgb(255, 0, 0)
:(t=Qi.exec(e))?new zt(255*t[1]/100,255*t[2]/100,255*t[3]/100,1)// rgb(100%, 0%, 0%)
:(t=Ki.exec(e))?bt(t[1],t[2],t[3],t[4])// rgba(255, 0, 0, 1)
:(t=Ji.exec(e))?bt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4])// rgb(100%, 0%, 0%, 1)
:(t=ea.exec(e))?At(t[1],t[2]/100,t[3]/100,1)// hsl(120, 50%, 50%)
:(t=ta.exec(e))?At(t[1],t[2]/100,t[3]/100,t[4])// hsla(120, 50%, 50%, 1)
:na.hasOwnProperty(e)?vt(na[e]):"transparent"===e?new zt(NaN,NaN,NaN,0):null}function vt(e){return new zt(255&e>>16,255&e>>8,255&e,1)}function bt(e,t,n,i){return 0>=i&&(e=t=n=NaN),new zt(e,t,n,i)}function kt(e){return(e instanceof _t||(e=xt(e)),!e)?new zt:(e=e.rgb(),new zt(e.r,e.g,e.b,e.opacity))}function wt(e,t,n,i){return 1===arguments.length?kt(e):new zt(e,t,n,null==i?1:i)}function zt(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function Nt(e){return e=fi(0,wi(255,_i(e)||0)),(16>e?"0":"")+e.toString(16)}function At(e,t,n,i){return 0>=i?e=t=n=NaN:0>=n||1<=n?e=t=NaN:0>=t&&(e=NaN),new St(e,t,n,i)}function jt(e){if(e instanceof St)return new St(e.h,e.s,e.l,e.opacity);if(e instanceof _t||(e=xt(e)),!e)return new St;if(e instanceof St)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,a=wi(t,n,i),r=fi(t,n,i),d=NaN,c=r-a,p=(r+a)/2;return c?(d=t===r?(n-i)/c+6*(n<i):n===r?(i-t)/c+2:(t-n)/c+4,c/=.5>p?r+a:2-r-a,d*=60):c=0<p&&1>p?0:d,new St(d,c,p,e.opacity)}function St(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}/* From FvD 13.37, CSS Color Module Level 3 */function Et(e,t,n){return 255*(60>e?t+(n-t)*e/60:180>e?n:240>e?t+(n-t)*(240-e)/60:t)}function Ct(e){if(e instanceof Lt)return new Lt(e.l,e.a,e.b,e.opacity);if(e instanceof Ot){if(isNaN(e.h))return new Lt(e.l,0,0,e.opacity);var t=e.h*ia;return new Lt(e.l,bi(t)*e.c,vi(t)*e.c,e.opacity)}e instanceof zt||(e=kt(e));var n,i,a=Pt(e.r),r=Pt(e.g),l=Pt(e.b),d=Tt((.2225045*a+.7168786*r+.0606169*l)/1);return a===r&&r===l?n=i=d:(n=Tt((.4360747*a+.3850649*r+.1430804*l)/K),i=Tt((.0139322*a+.0971045*r+.7141733*l)/Xn)),new Lt(116*d-16,500*(n-d),200*(d-i),e.opacity)}function Lt(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}function Tt(e){return e>da?xi(e,1/3):e/la+Zn}function Dt(e){return e>ra?e*e*e:la*(e-Zn)}function Xt(e){return 255*(.0031308>=e?12.92*e:1.055*xi(e,1/2.4)-.055)}function Pt(e){return .04045>=(e/=255)?e/12.92:xi((e+.055)/1.055,2.4)}function Rt(e){if(e instanceof Ot)return new Ot(e.h,e.c,e.l,e.opacity);if(e instanceof Lt||(e=Ct(e)),0===e.a&&0===e.b)return new Ot(NaN,0,e.l,e.opacity);var t=yi(e.b,e.a)*aa;return new Ot(0>t?t+360:t,ki(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Ot(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function Yt(e){if(e instanceof qt)return new qt(e.h,e.s,e.l,e.opacity);e instanceof zt||(e=kt(e));var t=e.r/255,n=e.g/255,i=e.b/255,a=(pa*i+E*t-ca*n)/(pa+E-ca),r=i-a,l=(D*(n-a)-B*r)/C,d=ki(l*l+r*r)/(D*a*(1-a)),// NaN if l=0 or l=1
s=d?yi(l,r)*aa-120:NaN;return new qt(0>s?s+360:s,d,a,e.opacity)}function qt(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function Vt(e){return function(){return e}}function $t(e,n){return function(i){return e+i*n}}function Bt(e,n,i){return e=xi(e,i),n=xi(n,i)-e,i=1/i,function(a){return xi(e+a*n,i)}}function Mt(e){return 1==(e=+e)?It:function(t,n){return n-t?Bt(t,n,e):Vt(isNaN(t)?n:t)}}function It(e,t){var n=t-e;return n?$t(e,n):Vt(isNaN(e)?t:e)}function Ut(e,n){return e=+e,n-=e,function(i){return e+n*i}}function Gt(e){return function(){return e}}function Ht(e){return function(n){return e(n)+""}}function Ft(e,n){var// scan index for next number in b
t,// current match in a
o,// current match in b
r,l=fa.lastIndex=_a.lastIndex=0,// string preceding current number in b, if any
d=-1,// index in s
c=[],// string constants and placeholders
s=[];// number interpolators
// Coerce inputs to strings.
// Interpolate pairs of numbers in a & b.
for(e+="",n+="";(t=fa.exec(e))&&(o=_a.exec(n));)(r=o.index)>l&&(r=n.slice(l,r),c[d]?c[d]+=r:// coalesce with previous string
c[++d]=r),(t=t[0])===(o=o[0])?c[d]?c[d]+=o:// coalesce with previous string
c[++d]=o:(c[++d]=null,s.push({i:d,x:Ut(t,o)})),l=_a.lastIndex;// Add remains of b.
// Special optimization for only a single match.
// Otherwise, interpolate each of the numbers and rejoin the string.
return l<n.length&&(r=n.slice(l),c[d]?c[d]+=r:// coalesce with previous string
c[++d]=r),2>c.length?s[0]?Ht(s[0].x):Gt(n):(n=s.length,function(e){for(var t,a=0;a<n;++a)c[(t=s[a]).i]=t.x(e);return c.join("")})}function Zt(t,n,i,o,r,e){var s,p,u,l=Math.atan;return(s=ki(t*t+n*n))&&(t/=s,n/=s),(u=t*i+n*o)&&(i-=t*u,o-=n*u),(p=ki(i*i+o*o))&&(i/=p,o/=p,u/=p),t*o<n*i&&(t=-t,n=-n,u=-u,s=-s),{translateX:r,translateY:e,rotate:yi(n,t)*xa,skewX:l(u)*xa,scaleX:s,scaleY:p}}function Wt(e){return"none"===e?va:(ua||(ua=document.createElement("DIV"),ha=document.documentElement,ga=document.defaultView),ua.style.transform=e,e=ga.getComputedStyle(ha.appendChild(ua),null).getPropertyValue("transform"),ha.removeChild(ua),e=e.slice(7,-1).split(","),Zt(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function Qt(e){return null==e?va:(ma||(ma=document.createElementNS("http://www.w3.org/2000/svg","g")),ma.setAttribute("transform",e),!(e=ma.transform.baseVal.consolidate()))?va:(e=e.matrix,Zt(e.a,e.b,e.c,e.d,e.e,e.f))}function Kt(e,t,n,i){function o(e){return e.length?e.pop()+" ":""}function r(e,a,o,r,l,d){if(e!==o||a!==r){var s=l.push("translate(",null,t,null,n);d.push({i:s-4,x:Ut(e,o)},{i:s-2,x:Ut(a,r)})}else(o||r)&&l.push("translate("+o+t+r+n)}function l(e,t,n,r){e===t?t&&n.push(o(n)+"rotate("+t+i):(180<e-t?t+=360:180<t-e&&(e+=360),r.push({i:n.push(o(n)+"rotate(",null,i)-2,x:Ut(e,t)}))}function d(e,t,n,a){e===t?t&&n.push(o(n)+"skewX("+t+i):a.push({i:n.push(o(n)+"skewX(",null,i)-2,x:Ut(e,t)})}function c(e,t,n,a,r,l){if(e!==n||t!==a){var d=r.push(o(r)+"scale(",null,",",null,")");l.push({i:d-4,x:Ut(e,n)},{i:d-2,x:Ut(t,a)})}else(1!==n||1!==a)&&r.push(o(r)+"scale("+n+","+a+")")}return function(t,n){var p=[],// string constants and placeholders
s=[];// number interpolators
// gc
return t=e(t),n=e(n),r(t.translateX,t.translateY,n.translateX,n.translateY,p,s),l(t.rotate,n.rotate,p,s),d(t.skewX,n.skewX,p,s),c(t.scaleX,t.scaleY,n.scaleX,n.scaleY,p,s),t=n=null,function(e){for(var t,a=-1,r=s.length;++a<r;)p[(t=s[a]).i]=t.x(e);return p.join("")}}}function Jt(e){return((e=mi(e))+1/e)/2}function en(e){return((e=mi(e))-1/e)/2}function tn(e){return((e=mi(2*e))-1)/(e+1)}// p0 = [ux0, uy0, w0]
// p1 = [ux1, uy1, w1]
function nn(e,t){var a,o,n=Math.log,r=e[0],l=e[1],d=e[2],s=t[0],c=t[1],p=t[2],h=s-r,g=c-l,u=h*h+g*g;// Special case for u0 ≅ u1.
if(u<za)o=n(p/d)/wa,a=function(e){return[r+e*h,l+e*g,d*mi(wa*e*o)]};// General case.
else{var m=ki(u),y=(p*p-d*d+4*u)/(2*(2*d)*m),f=(p*p-d*d-4*u)/(2*(2*p)*m),_=n(ki(y*y+1)-y),x=n(ki(f*f+1)-f);o=(x-_)/wa,a=function(e){var t=e*o,n=Jt(_),i=d/(2*m)*(n*tn(wa*t+_)-en(_));return[r+i*h,l+i*g,d*n/Jt(wa*t+_)]}}return a.duration=1e3*o,a}function an(e,t,n,i,a,o){var r=e.__transition;if(!r)e.__transition={};else if(n in r)return;dn(e,n,{name:t,index:i,// For context during callback.
group:a,// For context during callback.
on:Na,tween:Aa,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function on(e,t){var n=ln(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function rn(e,t){var n=ln(e,t);if(n.state>2)throw new Error("too late; already started");return n}function ln(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function dn(e,t,a){function r(p){var u,h,g,m;// If the state is not SCHEDULED, then we previously errored on start.
if(1!==a.state)return d();for(u in c)if(m=c[u],m.name===a.name){// While this element already has a starting transition during this frame,
// defer starting an interrupting transition until that transition has a
// chance to tick (and possibly end); see d3/d3-transition#54!
if(3===m.state)return Ke(r);// Interrupt the active transition, if any.
// Dispatch the interrupt event.
4===m.state?(m.state=6,m.timer.stop(),m.on.call("interrupt",e,e.__data__,m.index,m.group),delete c[u]):+u<t&&(m.state=6,m.timer.stop(),delete c[u])}// Defer the first tick to end of the current frame; see d3/d3#1576.
// Note the transition may be canceled after start and before the first tick!
// Note this must be scheduled before the start event; see d3/d3-transition#16!
// Assuming this is successful, subsequent callbacks go straight to tick.
if(Ke(function(){3===a.state&&(a.state=4,a.timer.restart(l,a.delay,a.time),l(p))}),a.state=2,a.on.call("start",e,e.__data__,a.index,a.group),2===a.state){for(a.state=3,s=Array(g=a.tween.length),(u=0,h=-1);u<g;++u)(m=a.tween[u].value.call(e,e.__data__,a.index,a.group))&&(s[++h]=m);s.length=h+1}// interrupted
}function l(o){for(var r=o<a.duration?a.ease.call(null,o/a.duration):(a.timer.restart(d),a.state=5,1),t=-1,l=s.length;++t<l;)s[t].call(null,r);// Dispatch the end event.
a.state===5&&(a.on.call("end",e,e.__data__,a.index,a.group),d())}function d(){for(var n in a.state=6,a.timer.stop(),delete c[t],c)return;// eslint-disable-line no-unused-vars
delete e.__transition}var s,c=e.__transition;// Initialize the self timer when the transition is created.
// Note the actual delay is not known until the first callback!
c[t]=a,a.timer=Ge(function(e){a.state=1,a.timer.restart(r,a.delay,a.time),a.delay<=e&&r(e-a.delay)},0,a.time)}function sn(e,t){var n,a,o,r=e.__transition,l=!0;if(r){for(o in t=null==t?null:t+"",r){if((n=r[o]).name!==t){l=!1;continue}a=2<n.state&&5>n.state,n.state=6,n.timer.stop(),a&&n.on.call("interrupt",e,e.__data__,n.index,n.group),delete r[o]}l&&delete e.__transition}}function cn(e,t){var a,o;return function(){var r=rn(this,e),l=r.tween;// If this node shared tween with the previous node,
// just assign the updated shared tween and we’re done!
// Otherwise, copy-on-write.
if(l!==a){o=a=l;for(var d=0,s=o.length;d<s;++d)if(o[d].name===t){o=o.slice(),o.splice(d,1);break}}r.tween=o}}function pn(e,a,o){var r,l;if("function"!=typeof o)throw new Error;return function(){var d=rn(this,e),s=d.tween;// If this node shared tween with the previous node,
// just assign the updated shared tween and we’re done!
// Otherwise, copy-on-write.
if(s!==r){l=(r=s).slice();for(var c={name:a,value:o},t=0,p=l.length;t<p;++t)if(l[t].name===a){l[t]=c;break}t===p&&l.push(c)}d.tween=l}}function un(e,a){var o=this._id;if(e+="",2>arguments.length){for(var r,l=ln(this.node(),o).tween,d=0,s=l.length;d<s;++d)if((r=l[d]).name===e)return r.value;return null}return this.each((null==a?cn:pn)(o,e,a))}function hn(e,t,n){var i=e._id;return e.each(function(){var e=rn(this,i);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return ln(e,i).value[t]}}function gn(e,t){var n;return("number"==typeof t?Ut:t instanceof xt?ya:(n=xt(t))?(t=n,ya):Ft)(e,t)}function mn(e){return function(){this.removeAttribute(e)}}function yn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function fn(e,t,n){var i,a;return function(){var o=this.getAttribute(e);return o===n?null:o===i?a:a=t(i=o,n)}}function _n(e,t,n){var i,a;return function(){var o=this.getAttributeNS(e.space,e.local);return o===n?null:o===i?a:a=t(i=o,n)}}function xn(e,t,n){var i,a,o;return function(){var r,l=n(this);return null==l?void this.removeAttribute(e):(r=this.getAttribute(e),r===l?null:r===i&&l===a?o:o=t(i=r,a=l))}}function vn(e,t,n){var i,a,o;return function(){var r,l=n(this);return null==l?void this.removeAttributeNS(e.space,e.local):(r=this.getAttributeNS(e.space,e.local),r===l?null:r===i&&l===a?o:o=t(i=r,a=l))}}function bn(e,t){function n(){var n=this,a=t.apply(n,arguments);return a&&function(i){n.setAttributeNS(e.space,e.local,a(i))}}return n._value=t,n}function kn(e,t){function n(){var n=this,a=t.apply(n,arguments);return a&&function(i){n.setAttribute(e,a(i))}}return n._value=t,n}function wn(e,t){return function(){on(this,e).delay=+t.apply(this,arguments)}}function zn(e,t){return t=+t,function(){on(this,e).delay=t}}function Nn(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?wn:zn)(t,e)):ln(this.node(),t).delay}function An(e,t){return function(){rn(this,e).duration=+t.apply(this,arguments)}}function jn(e,t){return t=+t,function(){rn(this,e).duration=t}}function Sn(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?An:jn)(t,e)):ln(this.node(),t).duration}function En(e,t){if("function"!=typeof t)throw new Error;return function(){rn(this,e).ease=t}}function Cn(e){var t=this._id;return arguments.length?this.each(En(t,e)):ln(this.node(),t).ease}function Ln(e){return(e+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return 0<=n&&(e=e.slice(0,n)),!e||"start"===e})}function Tn(e,t,n){var i,a,o=Ln(t)?on:rn;return function(){var r=o(this,e),l=r.on;// If this node shared a dispatch with the previous node,
// just assign the updated shared dispatch and we’re done!
// Otherwise, copy-on-write.
l!==i&&(a=(i=l).copy()).on(t,n),r.on=a}}function Dn(e,t){var n=this._id;return 2>arguments.length?ln(this.node(),n).on.on(e):this.each(Tn(n,e,t))}function Pn(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Rn(e){var t=this._name,a=this._id;"function"!=typeof e&&(e=o(e));for(var r=this._groups,l=r.length,d=Array(l),s=0;s<l;++s)for(var c,p,u=r[s],h=u.length,n=d[s]=Array(h),g=0;g<h;++g)(c=u[g])&&(p=e.call(c,c.__data__,g,u))&&("__data__"in c&&(p.__data__=c.__data__),n[g]=p,an(n[g],t,a,g,n,ln(c,a)));return new Un(d,this._parents,t,a)}function On(e){var t=this._name,a=this._id;"function"!=typeof e&&(e=d(e));for(var o=this._groups,r=o.length,s=[],c=[],p=0;p<r;++p)for(var u,h=o[p],g=h.length,n=0;n<g;++n)if(u=h[n]){for(var m,y=e.call(u,u.__data__,n,h),f=ln(u,a),_=0,x=y.length;_<x;++_)(m=y[_])&&an(m,t,a,_,y,f);s.push(y),c.push(u)}return new Un(s,c,t,a)}function Yn(e,t){var n,i,a;return function(){var o=T(this,e),r=(this.style.removeProperty(e),T(this,e));return o===r?null:o===n&&r===i?a:a=t(n=o,i=r)}}function qn(e){return function(){this.style.removeProperty(e)}}function Vn(e,t,n){var i,a;return function(){var o=T(this,e);return o===n?null:o===i?a:a=t(i=o,n)}}function $n(e,t,n){var i,a,o;return function(){var r=T(this,e),l=n(this);return null==l&&(l=(this.style.removeProperty(e),T(this,e))),r===l?null:r===i&&l===a?o:o=t(i=r,a=l)}}function Bn(e,t,n){function i(){var a=this,o=t.apply(a,arguments);return o&&function(i){a.style.setProperty(e,o(i),n)}}return i._value=t,i}function Mn(e){return function(){this.textContent=e}}function In(e){return function(){var t=e(this);this.textContent=null==t?"":t}}function Un(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function Gn(){return++Sa}function Hn(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))return Ca.time=Me(),Ca;return n}function Fn(e){var t,a;e instanceof Un?(t=e._id,e=e._name):(t=Gn(),(a=Ca).time=Me(),e=null==e?null:e+"");for(var o=this._groups,r=o.length,l=0;l<r;++l)for(var d,s=o[l],c=s.length,n=0;n<c;++n)(d=s[n])&&an(d,e,t,n,s,a||Hn(d,t));return new Un(o,this._parents,e,t)}function Wn(e){return function(){return e}}function Qn(e,t,n){this.target=e,this.type=t,this.transform=n}function Kn(e,t,n){this.k=e,this.x=t,this.y=n}function Jn(){Ai.stopImmediatePropagation()}function ei(){Ai.preventDefault(),Ai.stopImmediatePropagation()}// Ignore right-click, since that should open the context menu.
function ti(){return!Ai.button}function ni(){var t,n,i=this;return i instanceof SVGElement?(i=i.ownerSVGElement||i,t=i.width.baseVal.value,n=i.height.baseVal.value):(t=i.clientWidth,n=i.clientHeight),[[0,0],[t,n]]}function ii(){return this.__zoom||La}function ai(){return-Ai.deltaY*(Ai.deltaMode?120:1)/500}function oi(){return"ontouchstart"in this}function ri(e,t,n){var i=e.invertX(t[0][0])-n[0][0],a=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],r=e.invertY(t[1][1])-n[1][1];return e.translate(a>i?(i+a)/2:wi(0,i)||fi(0,a),r>o?(o+r)/2:wi(0,o)||fi(0,r))}function li(){function e(e){e.property("__zoom",ii).on("wheel.zoom",c).on("mousedown.zoom",p).on("dblclick.zoom",u).filter(z).on("touchstart.zoom",h).on("touchmove.zoom",g).on("touchend.zoom touchcancel.zoom",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function n(e,t){return t=fi(N[0],wi(N[1],t)),t===e.k?e:new Kn(t,e.x,e.y)}function a(e,t,n){var i=t[0]-n[0]*e.k,a=t[1]-n[1]*e.k;return i===e.x&&a===e.y?e:new Kn(e.k,i,a)}function o(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function r(e,t,n){e.on("start.zoom",function(){d(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){d(this,arguments).end()}).tween("zoom",function(){var r=this,l=arguments,s=d(r,l),c=v.apply(r,l),e=n||o(c),p=fi(c[1][0]-c[0][0],c[1][1]-c[0][1]),u=r.__zoom,a="function"==typeof t?t.apply(r,l):t,h=S(u.invert(e).concat(p/u.k),a.invert(e).concat(p/a.k));return function(n){if(1===n)n=a;// Avoid rounding error on end.
else{var i=h(n),o=p/i[2];n=new Kn(o,e[0]-i[0]*o,e[1]-i[1]*o)}s.zoom(null,n)}})}function d(e,t){for(var a,o=0,r=E.length;o<r;++o)if((a=E[o]).that===e)return a;return new s(e,t)}function s(e,t){this.that=e,this.args=t,this.index=-1,this.active=0,this.extent=v.apply(e,t)}function c(){function e(){i.wheel=null,i.end()}if(x.apply(this,arguments)){var i=d(this,arguments),o=this.__zoom,t=fi(N[0],wi(N[1],o.k*xi(2,w.apply(this,arguments)))),r=xe(this);// If the mouse is in the same location as before, reuse it.
// If there were recent wheel events, reset the wheel idle timeout.
if(i.wheel)(i.mouse[0][0]!==r[0]||i.mouse[0][1]!==r[1])&&(i.mouse[1]=o.invert(i.mouse[0]=r)),clearTimeout(i.wheel);// If this wheel event won’t trigger a transform change, ignore it.
else{if(o.k===t)return;// Otherwise, capture the mouse point and location at the start.
i.mouse=[r,o.invert(r)],sn(this),i.start()}ei(),i.wheel=setTimeout(e,150),i.zoom("mouse",b(a(n(o,t),i.mouse[0],i.mouse[1]),i.extent,A))}}function p(){function e(){if(ei(),!n.moved){var e=Ai.clientX-r,t=Ai.clientY-l;n.moved=e*e+t*t>L}n.zoom("mouse",b(a(n.that.__zoom,n.mouse[0]=xe(n.that),n.mouse[1]),n.extent,A))}function t(){i.on("mousemove.zoom mouseup.zoom",null),dt(Ai.view,n.moved),ei(),n.end()}if(!f&&x.apply(this,arguments)){var n=d(this,arguments),i=ye(Ai.view).on("mousemove.zoom",e,!0).on("mouseup.zoom",t,!0),o=xe(this),r=Ai.clientX,l=Ai.clientY;lt(Ai.view),Jn(),n.mouse=[o,this.__zoom.invert(o)],sn(this),n.start()}}function u(){if(x.apply(this,arguments)){var t=this.__zoom,i=xe(this),o=t.invert(i),l=t.k*(Ai.shiftKey?.5:2),d=b(a(n(t,l),i,o),v.apply(this,arguments),A);ei(),0<j?ye(this).transition().duration(j).call(r,d,i):ye(this).call(e.transform,d)}}function h(){if(x.apply(this,arguments)){var e,a,o,r,l=d(this,arguments),s=Ai.changedTouches,c=s.length;for(Jn(),a=0;a<c;++a)o=s[a],r=ve(this,s,o.identifier),r=[r,this.__zoom.invert(r),o.identifier],l.touch0?!l.touch1&&(l.touch1=r):(l.touch0=r,e=!0);// If this is a dbltap, reroute to the (optional) dblclick.zoom handler.
return y&&(y=clearTimeout(y),!l.touch1)?(l.end(),r=ye(this).on("dblclick.zoom"),void(r&&r.apply(this,arguments))):void(e&&(y=setTimeout(function(){y=null},500),sn(this),l.start()))}}function g(){var e,o,r,s,c=d(this,arguments),u=Ai.changedTouches,h=u.length;for(ei(),y&&(y=clearTimeout(y)),e=0;e<h;++e)o=u[e],r=ve(this,u,o.identifier),c.touch0&&c.touch0[2]===o.identifier?c.touch0[0]=r:c.touch1&&c.touch1[2]===o.identifier&&(c.touch1[0]=r);if(o=c.that.__zoom,c.touch1){var g=c.touch0[0],m=c.touch0[1],f=c.touch1[0],_=c.touch1[1],x=(x=f[0]-g[0])*x+(x=f[1]-g[1])*x,v=(v=_[0]-m[0])*v+(v=_[1]-m[1])*v;o=n(o,ki(x/v)),r=[(g[0]+f[0])/2,(g[1]+f[1])/2],s=[(m[0]+_[0])/2,(m[1]+_[1])/2]}else if(c.touch0)r=c.touch0[0],s=c.touch0[1];else return;c.zoom("touch",b(a(o,r,s),c.extent,A))}function m(){var e,a,o=d(this,arguments),r=Ai.changedTouches,l=r.length;for(Jn(),f&&clearTimeout(f),f=setTimeout(function(){f=null},500),e=0;e<l;++e)a=r[e],o.touch0&&o.touch0[2]===a.identifier?delete o.touch0:o.touch1&&o.touch1[2]===a.identifier&&delete o.touch1;o.touch1&&!o.touch0&&(o.touch0=o.touch1,delete o.touch1),o.touch0?o.touch0[1]=this.__zoom.invert(o.touch0[0]):o.end()}var y,f,x=ti,v=ni,b=ri,w=ai,z=oi,N=[0,1/0],A=[[-Infinity,-Infinity],[1/0,1/0]],j=250,S=nn,E=[],C=Ye("start","zoom","end"),L=0;return e.transform=function(e,t){var n=e.selection?e.selection():e;n.property("__zoom",ii),e===n?n.interrupt().each(function(){d(this,arguments).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()}):r(e,t)},e.scaleBy=function(t,n){e.scaleTo(t,function(){var e=this.__zoom.k,t="function"==typeof n?n.apply(this,arguments):n;return e*t})},e.scaleTo=function(t,i){e.transform(t,function(){var t=v.apply(this,arguments),e=this.__zoom,r=o(t),l=e.invert(r),d="function"==typeof i?i.apply(this,arguments):i;return b(a(n(e,d),r,l),t,A)})},e.translateBy=function(t,n,i){e.transform(t,function(){return b(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof i?i.apply(this,arguments):i),v.apply(this,arguments),A)})},e.translateTo=function(t,n,i){e.transform(t,function(){var a=v.apply(this,arguments),e=this.__zoom,t=o(a);return b(La.translate(t[0],t[1]).scale(e.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof i?-i.apply(this,arguments):-i),a,A)})},s.prototype={start:function(){return 1==++this.active&&(this.index=E.push(this)-1,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(E.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(t){ce(new Qn(e,t,this.that.__zoom),C.apply,C,[t,this.that,this.args])}},e.wheelDelta=function(t){return arguments.length?(w="function"==typeof t?t:Wn(+t),e):w},e.filter=function(t){return arguments.length?(x="function"==typeof t?t:Wn(!!t),e):x},e.touchable=function(t){return arguments.length?(z="function"==typeof t?t:Wn(!!t),e):z},e.extent=function(t){return arguments.length?(v="function"==typeof t?t:Wn([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),e):v},e.scaleExtent=function(t){return arguments.length?(N[0]=+t[0],N[1]=+t[1],e):[N[0],N[1]]},e.translateExtent=function(t){return arguments.length?(A[0][0]=+t[0][0],A[1][0]=+t[1][0],A[0][1]=+t[0][1],A[1][1]=+t[1][1],e):[[A[0][0],A[0][1]],[A[1][0],A[1][1]]]},e.constrain=function(t){return arguments.length?(b=t,e):b},e.duration=function(t){return arguments.length?(j=+t,e):j},e.interpolate=function(t){return arguments.length?(S=t,e):S},e.on=function(){var t=C.on.apply(C,arguments);return t===C?e:t},e.clickDistance=function(t){return arguments.length?(L=(t=+t)*t,e):ki(L)},e}function di(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function si(e,t){var n=di(e);return function(a,o){return t(n(a),o,e)}}// Compute unique columns in order of discovery.
function ci(e){var t=Object.create(null),n=[];return e.forEach(function(e){for(var i in e)i in t||n.push(t[i]=i)}),n}function pi(e){function t(e,i){function a(){if(p)return Da;if(u)return u=!1,Ta;// Unescape quotes.
var t,n,a=s;if(34===e.charCodeAt(a)){for(;s++<d&&34!==e.charCodeAt(s)||34===e.charCodeAt(++s););return(t=s)>=d?p=!0:10===(n=e.charCodeAt(s++))?u=!0:13===n&&(u=!0,10===e.charCodeAt(s)&&++s),e.slice(a+1,t-1).replace(/""/g,"\"")}// Find next delimiter or newline.
for(;s<d;){if((n=e.charCodeAt(t=s++))===10)u=!0;else if(n===13)u=!0,10===e.charCodeAt(s)&&++s;else if(n!==o)continue;return e.slice(a,t)}// Return last token before EOF.
return p=!0,e.slice(a,d)}var// current line number
r,l=[],// output rows
d=e.length,s=0,// current character index
c=0,// current token
p=0>=d,// current token followed by EOF?
u=!1;// current token followed by EOL?
// Strip the trailing newline.
for(10===e.charCodeAt(d-1)&&--d,13===e.charCodeAt(d-1)&&--d;(r=a())!==Da;){for(var h=[];r!==Ta&&r!==Da;)h.push(r),r=a();i&&null==(h=i(h,c++))||l.push(h)}return l}function n(t){return t.map(i).join(e)}function i(e){return null==e?"":a.test(e+="")?"\""+e.replace(/"/g,"\"\"")+"\"":e}var a=new RegExp("[\""+e+"\n\r]"),o=e.charCodeAt(0);return{parse:function(e,n){var a,o,r=t(e,function(e,t){return a?a(e,t-1):void(o=e,a=n?si(e,n):di(e))});return r.columns=o||[],r},parseRows:t,format:function(t,n){return null==n&&(n=ci(t)),[n.map(i).join(e)].concat(t.map(function(t){return n.map(function(e){return i(t[e])}).join(e)})).join("\n")},formatRows:function(e){return e.map(n).join("\n")}}}function ui(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.json()}function hi(e,t){return fetch(e,t).then(ui)}/*global window*/var zi={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};p.prototype={constructor:p,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};q.prototype={add:function(e){var t=this._names.indexOf(e);0>t&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);0<=t&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return 0<=this._names.indexOf(e)}};var Ni={},Ai=null;if("undefined"!=typeof document){var ji=document.documentElement;"onmouseenter"in ji||(Ni={mouseenter:"mouseover",mouseleave:"mouseout"})}var Si=[null];ge.prototype=me.prototype={constructor:ge,select:r,selectAll:function(e){"function"!=typeof e&&(e=d(e));for(var t=this._groups,a=t.length,o=[],r=[],l=0;l<a;++l)for(var s,c=t[l],p=c.length,n=0;n<p;++n)(s=c[n])&&(o.push(e.call(s,s.__data__,n,c)),r.push(s));return new ge(o,r)},filter:function(e){"function"!=typeof e&&(e=s(e));for(var t=this._groups,a=t.length,o=Array(a),r=0;r<a;++r)for(var l,d=t[r],c=d.length,n=o[r]=[],p=0;p<c;++p)(l=d[p])&&e.call(l,l.__data__,p,d)&&n.push(l);return new ge(o,this._parents)},data:function(e,t){if(!e)return y=Array(this.size()),s=-1,this.each(function(e){y[++s]=e}),y;var n=t?g:h,i=this._parents,a=this._groups;"function"!=typeof e&&(e=u(e));for(var o=a.length,r=Array(o),l=Array(o),d=Array(o),s=0;s<o;++s){var c=i[s],p=a[s],m=p.length,y=e.call(c,c&&c.__data__,s,i),f=y.length,_=l[s]=Array(f),x=r[s]=Array(f),v=d[s]=Array(m);n(c,p,_,x,v,y,t);// Now connect the enter nodes to their following update node, such that
// appendChild can insert the materialized enter node before this node,
// rather than at the end of the parent node.
for(var b,k,w=0,z=0;w<f;++w)if(b=_[w]){for(w>=z&&(z=w+1);!(k=x[z])&&++z<f;);b._next=k||null}}return r=new ge(r,i),r._enter=l,r._exit=d,r},enter:function(){return new ge(this._enter||this._groups.map(c),this._parents)},exit:function(){return new ge(this._exit||this._groups.map(c),this._parents)},join:function(e,t,n){var i=this.enter(),a=this,o=this.exit();return i="function"==typeof e?e(i):i.append(e+""),null!=t&&(a=t(a)),null==n?o.remove():n(o),i&&a?i.merge(a).order():a},merge:function(e){for(var t=this._groups,a=e._groups,o=t.length,r=a.length,l=wi(o,r),d=Array(o),s=0;s<l;++s)for(var c,p=t[s],u=a[s],h=p.length,n=d[s]=Array(h),g=0;g<h;++g)(c=p[g]||u[g])&&(n[g]=c);for(;s<o;++s)d[s]=t[s];return new ge(d,this._parents)},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var a,o=e[t],r=o.length-1,l=o[r];0<=--r;)(a=o[r])&&(l&&4^a.compareDocumentPosition(l)&&l.parentNode.insertBefore(a,l),l=a);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=f);for(var a=this._groups,o=a.length,r=Array(o),l=0;l<o;++l){for(var d,s=a[l],c=s.length,n=r[l]=Array(c),p=0;p<c;++p)(d=s[p])&&(n[p]=d);n.sort(t)}return new ge(r,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){var e=Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e},node:function(){for(var e=this._groups,t=0,a=e.length;t<a;++t)for(var o,r=e[t],l=0,d=r.length;l<d;++l)if(o=r[l],o)return o;return null},size:function(){var e=0;return this.each(function(){++e}),e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,a=0,o=t.length;a<o;++a)for(var r,l=t[a],d=0,s=l.length;d<s;++d)(r=l[d])&&e.call(r,r.__data__,d,l);return this},attr:function(t,n){var i=e(t);if(2>arguments.length){var a=this.node();return i.local?a.getAttributeNS(i.space,i.local):a.getAttribute(i)}return this.each((null==n?i.local?v:_:"function"==typeof n?i.local?z:w:i.local?k:b)(i,n))},style:function(e,t,n){return 1<arguments.length?this.each((null==t?j:"function"==typeof t?L:S)(e,t,null==n?"":n)):T(this.node(),e)},property:function(e,t){return 1<arguments.length?this.each((null==t?X:"function"==typeof t?R:P)(e,t)):this.node()[e]},classed:function(e,t){var a=O(e+"");if(2>arguments.length){for(var o=Y(this.node()),r=-1,l=a.length;++r<l;)if(!o.contains(a[r]))return!1;return!0}return this.each(("function"==typeof t?U:t?M:I)(a,t))},text:function(e){return arguments.length?this.each(null==e?G:("function"==typeof e?F:H)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Z:("function"==typeof e?Q:W)(e)):this.node().innerHTML},raise:function(){return this.each(J)},lower:function(){return this.each(ee)},append:function(e){var t="function"==typeof e?e:i(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:i(e),a=null==t?te:"function"==typeof t?t:o(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),a.apply(this,arguments)||null)})},remove:function(){return this.each(ne)},clone:function(e){return this.select(e?ae:ie)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,a,r){var l,d,s=le(e+""),c=s.length;if(2>arguments.length){var n=this.node().__on;if(n)for(var p,u=0,h=n.length;u<h;++u)for(l=0,p=n[u];l<c;++l)if((d=s[l]).type===p.type&&d.name===p.name)return p.value;return}for(n=a?se:de,null==r&&(r=!1),l=0;l<c;++l)this.each(n(s[l],a,r));return this},dispatch:function(e,t){return this.each(("function"==typeof t?he:ue)(e,t))}};var Ei=Se.prototype=Ee.prototype;Ei.copy=function(){var e,t,n=new Ee(this._x,this._y,this._x0,this._y0,this._x1,this._y1),a=this._root;if(!a)return n;if(!a.length)return n._root=Ce(a),n;for(e=[{source:a,target:n._root=[,,,,]}];a=e.pop();)for(var o=0;4>o;++o)(t=a.source[o])&&(t.length?e.push({source:t,target:a.target[o]=[,,,,]}):a.target[o]=Ce(t));return n},Ei.add=function(e){var t=+this._x.call(null,e),n=+this._y.call(null,e);return ze(this.cover(t,n),t,n,e)},Ei.addAll=function(e){var t,a,o,r,l=e.length,n=Array(l),s=Array(l),c=1/0,p=1/0,u=-Infinity,h=-Infinity;// Compute the points and their extent.
for(a=0;a<l;++a)isNaN(o=+this._x.call(null,t=e[a]))||isNaN(r=+this._y.call(null,t))||(n[a]=o,s[a]=r,o<c&&(c=o),o>u&&(u=o),r<p&&(p=r),r>h&&(h=r));// If there were no (valid) points, abort.
if(c>u||p>h)return this;// Expand the tree to cover the new points.
// Add the new points.
for(this.cover(c,p).cover(u,h),a=0;a<l;++a)ze(this,n[a],s[a],e[a]);return this},Ei.cover=function(e,t){var n=Math.floor;if(isNaN(e=+e)||isNaN(t=+t))return this;// ignore invalid points
var a=this._x0,o=this._y0,r=this._x1,l=this._y1;// If the quadtree has no extent, initialize them.
// Integer extent are necessary so that if we later double the extent,
// the existing quadrant boundaries don’t change due to floating point error!
if(isNaN(a))r=(a=n(e))+1,l=(o=n(t))+1;// Otherwise, double repeatedly to cover.
else{for(var d,s,c=r-a,p=this._root;a>e||e>=r||o>t||t>=l;)s=(t<o)<<1|e<a,d=[,,,,],d[s]=p,p=d,c*=2,0===s?(r=a+c,l=o+c):1===s?(a=r-c,l=o+c):2===s?(r=a+c,o=l-c):3===s?(a=r-c,o=l-c):void 0;this._root&&this._root.length&&(this._root=p)}return this._x0=a,this._y0=o,this._x1=r,this._y1=l,this},Ei.data=function(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e},Ei.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Ei.find=function(e,t,n){var a,o,r,l,s,c,p,u=this._x0,h=this._y0,g=this._x1,m=this._y1,y=[],f=this._root;for(f&&y.push(new Ne(f,u,h,g,m)),null==n?n=1/0:(u=e-n,h=t-n,g=e+n,m=t+n,n*=n);c=y.pop();)// Stop searching if this quadrant can’t contain a closer node.
if(!(!(f=c.node)||(o=c.x0)>g||(r=c.y0)>m||(l=c.x1)<u||(s=c.y1)<h))// Bisect the current quadrant.
if(f.length){var _=(o+l)/2,x=(r+s)/2;y.push(new Ne(f[3],_,x,l,s),new Ne(f[2],o,x,_,s),new Ne(f[1],_,r,l,x),new Ne(f[0],o,r,_,x)),(p=(t>=x)<<1|e>=_)&&(c=y[y.length-1],y[y.length-1]=y[y.length-1-p],y[y.length-1-p]=c)}// Visit this point. (Visiting coincident points isn’t necessary!)
else{var v=e-+this._x.call(null,f.data),b=t-+this._y.call(null,f.data),k=v*v+b*b;if(k<n){var w=ki(n=k);u=e-w,h=t-w,g=e+w,m=t+w,a=f.data}}return a},Ei.remove=function(e){if(isNaN(r=+this._x.call(null,e))||isNaN(l=+this._y.call(null,e)))return this;// ignore invalid points
var t,n,a,o,r,l,d,s,c,p,u,h,g=this._root,m=this._x0,f=this._y0,_=this._x1,v=this._y1;// If the tree is empty, initialize the root as a leaf.
if(!g)return this;// Find the leaf node for the point.
// While descending, also retain the deepest parent with a non-removed sibling.
if(g.length)for(;;){if((c=r>=(d=(m+_)/2))?m=d:_=d,(p=l>=(s=(f+v)/2))?f=s:v=s,(t=g,!(g=g[u=p<<1|c])))return this;if(!g.length)break;(t[3&u+1]||t[3&u+2]||t[3&u+3])&&(n=t,h=u)}// Find the point to remove.
for(;g.data!==e;)if(a=g,!(g=g.next))return this;// If there are multiple coincident points, remove just the point.
return((o=g.next)&&delete g.next,a)?(o?a.next=o:delete a.next,this):t?(o?t[u]=o:delete t[u],(g=t[0]||t[1]||t[2]||t[3])&&g===(t[3]||t[2]||t[1]||t[0])&&!g.length&&(n?n[h]=g:this._root=g),this):(this._root=o,this);// If this is the root point, remove it.
// Remove this leaf.
},Ei.removeAll=function(e){for(var t=0,a=e.length;t<a;++t)this.remove(e[t]);return this},Ei.root=function(){return this._root},Ei.size=function(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e},Ei.visit=function(e){var t,n,i,a,o,r,l=[],d=this._root;for(d&&l.push(new Ne(d,this._x0,this._y0,this._x1,this._y1));t=l.pop();)if(!e(d=t.node,i=t.x0,a=t.y0,o=t.x1,r=t.y1)&&d.length){var s=(i+o)/2,c=(a+r)/2;(n=d[3])&&l.push(new Ne(n,s,c,o,r)),(n=d[2])&&l.push(new Ne(n,i,c,s,r)),(n=d[1])&&l.push(new Ne(n,s,a,o,c)),(n=d[0])&&l.push(new Ne(n,i,a,s,c))}return this},Ei.visitAfter=function(e){var t,n=[],i=[];for(this._root&&n.push(new Ne(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var a=t.node;if(a.length){var o,r=t.x0,l=t.y0,d=t.x1,s=t.y1,c=(r+d)/2,p=(l+s)/2;(o=a[0])&&n.push(new Ne(o,r,l,c,p)),(o=a[1])&&n.push(new Ne(o,c,l,d,p)),(o=a[2])&&n.push(new Ne(o,r,p,c,s)),(o=a[3])&&n.push(new Ne(o,c,p,d,s))}i.push(t)}for(;t=i.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},Ei.x=function(e){return arguments.length?(this._x=e,this):this._x},Ei.y=function(e){return arguments.length?(this._y=e,this):this._y};x.prototype=Te.prototype={constructor:x,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if(e[0]==="$")return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var Ci=Te.prototype;De.prototype=Xe.prototype={constructor:De,has:Ci.has,add:function(e){return e+="",this["$"+e]=e,this},remove:Ci.remove,clear:Ci.clear,values:Ci.keys,size:Ci.size,empty:Ci.empty,each:Ci.each};var Li={value:function(){}};qe.prototype=Ye.prototype={constructor:qe,on:function(e,a){var o,r=this._,l=Ve(e+"",r),d=-1,s=l.length;// If no callback was specified, return the callback of the given type and name.
if(2>arguments.length){for(;++d<s;)if((o=(e=l[d]).type)&&(o=$e(r[o],e.name)))return o;return}// If a type was specified, set the callback for the given type and name.
// Otherwise, if a null callback was specified, remove callbacks of the given name.
if(null!=a&&"function"!=typeof a)throw new Error("invalid callback: "+a);for(;++d<s;)if(o=(e=l[d]).type)r[o]=Be(r[o],e.name,a);else if(null==a)for(o in r)r[o]=Be(r[o],e.name,null);return this},copy:function(){var e={},n=this._;for(var i in n)e[i]=n[i].slice();return new qe(e)},call:function(e,a){if(0<(o=arguments.length-2))for(var o,r,l=Array(o),d=0;d<o;++d)l[d]=arguments[d+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=this._[e],d=0,o=r.length;d<o;++d)r[d].value.apply(a,l)},apply:function(e,a,o){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],t=0,l=r.length;t<l;++t)r[t].value.apply(a,o)}};var// how frequently we check for clock skew
Ti,Di,Xi=0,// is an animation frame pending?
Pi=0,// is a timeout pending?
Ri=0,Oi=0,Yi=0,qi=0,Vi="object"==typeof performance&&performance.now?performance:Date,$i="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};Ue.prototype=Ge.prototype={constructor:Ue,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Me():+n)+(null==t?0:+t),this._next||Di===this||(Di?Di._next=this:Ti=this,Di=this),this._call=e,this._time=n,Qe()},stop:function(){this._call&&(this._call=null,this._time=1/0,Qe())}};var Bi=gi*(3-ki(5));ct.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var Mi=.7,Ii=1/Mi,Ui="\\s*([+-]?\\d+)\\s*",Gi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Hi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Fi=/^#([0-9a-f]{3})$/,Zi=/^#([0-9a-f]{6})$/,Wi=new RegExp("^rgb\\("+[Ui,Ui,Ui]+"\\)$"),Qi=new RegExp("^rgb\\("+[Hi,Hi,Hi]+"\\)$"),Ki=new RegExp("^rgba\\("+[Ui,Ui,Ui,Gi]+"\\)$"),Ji=new RegExp("^rgba\\("+[Hi,Hi,Hi,Gi]+"\\)$"),ea=new RegExp("^hsl\\("+[Gi,Hi,Hi]+"\\)$"),ta=new RegExp("^hsla\\("+[Gi,Hi,Hi,Gi]+"\\)$"),na={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};yt(_t,xt,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}}),yt(zt,wt,ft(_t,{brighter:function(e){return e=null==e?Ii:xi(Ii,e),new zt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Mi:xi(Mi,e),new zt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&255>=this.r&&0<=this.g&&255>=this.g&&0<=this.b&&255>=this.b&&0<=this.opacity&&1>=this.opacity},hex:function(){return"#"+Nt(this.r)+Nt(this.g)+Nt(this.b)},toString:function(){var e=this.opacity;return e=isNaN(e)?1:fi(0,wi(1,e)),(1===e?"rgb(":"rgba(")+fi(0,wi(255,_i(this.r)||0))+", "+fi(0,wi(255,_i(this.g)||0))+", "+fi(0,wi(255,_i(this.b)||0))+(1===e?")":", "+e+")")}})),yt(St,function(e,t,n,i){return 1===arguments.length?jt(e):new St(e,t,n,null==i?1:i)},ft(_t,{brighter:function(e){return e=null==e?Ii:xi(Ii,e),new St(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Mi:xi(Mi,e),new St(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(0>this.h),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(.5>n?n:1-n)*t,a=2*n-i;return new zt(Et(240<=e?e-240:e+120,a,i),Et(e,a,i),Et(120>e?e+240:e-120,a,i),this.opacity)},displayable:function(){return(0<=this.s&&1>=this.s||isNaN(this.s))&&0<=this.l&&1>=this.l&&0<=this.opacity&&1>=this.opacity}}));var ia=gi/180,aa=180/gi,oa=18,K=.96422,Xn=.82521,Zn=4/29,ra=6/29,la=3*ra*ra,da=ra*ra*ra;yt(Lt,function(e,t,n,i){return 1===arguments.length?Ct(e):new Lt(e,t,n,null==i?1:i)},ft(_t,{brighter:function(e){return new Lt(this.l+oa*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Lt(this.l-oa*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=K*Dt(t),e=1*Dt(e),n=Xn*Dt(n),new zt(Xt(3.1338561*t-1.6168667*e-.4906146*n),Xt(-.9787684*t+1.9161415*e+.033454*n),Xt(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),yt(Ot,function(e,t,n,i){return 1===arguments.length?Rt(e):new Ot(e,t,n,null==i?1:i)},ft(_t,{brighter:function(e){return new Ot(this.h,this.c,this.l+oa*(null==e?1:e),this.opacity)},darker:function(e){return new Ot(this.h,this.c,this.l-oa*(null==e?1:e),this.opacity)},rgb:function(){return Ct(this).rgb()}}));var sa=-.14861,A=+1.78277,B=-.29227,C=-.90649,D=+1.97294,E=D*C,ca=D*A,pa=A*B-C*sa;yt(qt,function(e,t,n,i){return 1===arguments.length?Yt(e):new qt(e,t,n,null==i?1:i)},ft(_t,{brighter:function(e){return e=null==e?Ii:xi(Ii,e),new qt(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Mi:xi(Mi,e),new qt(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*ia,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=bi(e),a=vi(e);return new zt(255*(t+n*(sa*i+A*a)),255*(t+n*(B*i+C*a)),255*(t+n*(D*i)),this.opacity)}}));var ua,ha,ga,ma,ya=function e(t){function n(e,t){var n=i((e=wt(e)).r,(t=wt(t)).r),a=i(e.g,t.g),o=i(e.b,t.b),r=It(e.opacity,t.opacity);return function(i){return e.r=n(i),e.g=a(i),e.b=o(i),e.opacity=r(i),e+""}}var i=Mt(t);return n.gamma=e,n}(1),fa=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_a=new RegExp(fa.source,"g"),xa=180/gi,va={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},ba=Kt(Wt,"px, ","px)","deg)"),ka=Kt(Qt,", ",")",")"),wa=Math.SQRT2,za=1e-12,Na=Ye("start","end","interrupt"),Aa=[],ja=me.prototype.constructor,Sa=0,Ea=me.prototype;Un.prototype=function(e){return me().transition(e)}.prototype={constructor:Un,select:Rn,selectAll:On,filter:function(e){"function"!=typeof e&&(e=s(e));for(var t=this._groups,a=t.length,o=Array(a),r=0;r<a;++r)for(var l,d=t[r],c=d.length,n=o[r]=[],p=0;p<c;++p)(l=d[p])&&e.call(l,l.__data__,p,d)&&n.push(l);return new Un(o,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,a=e._groups,o=t.length,r=a.length,l=wi(o,r),d=Array(o),s=0;s<l;++s)for(var c,p=t[s],u=a[s],h=p.length,n=d[s]=Array(h),g=0;g<h;++g)(c=p[g]||u[g])&&(n[g]=c);for(;s<o;++s)d[s]=t[s];return new Un(d,this._parents,this._name,this._id)},selection:function(){return new ja(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,a=Gn(),o=this._groups,r=o.length,l=0;l<r;++l)for(var d,s=o[l],c=s.length,n=0;n<c;++n)if(d=s[n]){var p=ln(d,t);an(d,e,a,n,s,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new Un(o,this._parents,e,a)},call:Ea.call,nodes:Ea.nodes,node:Ea.node,size:Ea.size,empty:Ea.empty,each:Ea.each,on:Dn,attr:function(t,n){var a=e(t),o="transform"===a?ka:gn;return this.attrTween(t,"function"==typeof n?(a.local?vn:xn)(a,o,hn(this,"attr."+t,n)):null==n?(a.local?yn:mn)(a):(a.local?_n:fn)(a,o,n+""))},attrTween:function(t,n){var i="attr."+t;if(2>arguments.length)return(i=this.tween(i))&&i._value;if(null==n)return this.tween(i,null);if("function"!=typeof n)throw new Error;var a=e(t);return this.tween(i,(a.local?bn:kn)(a,n))},style:function(e,t,n){var a="transform"==(e+="")?ba:gn;return null==t?this.styleTween(e,Yn(e,a)).on("end.style."+e,qn(e)):this.styleTween(e,"function"==typeof t?$n(e,a,hn(this,"style."+e,t)):Vn(e,a,t+""),n)},styleTween:function(e,t,n){var i="style."+(e+="");if(2>arguments.length)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw new Error;return this.tween(i,Bn(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?In(hn(this,"text",e)):Mn(null==e?"":e+""))},remove:function(){return this.on("end.remove",Pn(this._id))},tween:un,delay:Nn,duration:Sn,ease:Cn};var Ca={time:null,// Set on use.
delay:0,duration:250,ease:function(e){return(1>=(e*=2)?e*e*e:(e-=2)*e*e+2)/2}};me.prototype.interrupt=function(e){return this.each(function(){sn(this,e)})},me.prototype.transition=Fn,Kn.prototype={constructor:Kn,scale:function(e){return 1===e?this:new Kn(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Kn(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var La=new Kn(1,0,0),Ta={},Da={},Xa=pi(","),Pa=Xa.parse,Ra=Xa.parseRows,Oa=Xa.format,Ya=Xa.formatRows,qa=pi("\t"),Va=qa.parse,$a=qa.parseRows,Ba=qa.format,Ma=qa.formatRows;class Ia{constructor(e,t={}){function n(){const e=`translate(${Ai.transform.x||0}, ${Ai.transform.y||0}) scale(${Ai.transform.k||1})`;this.svgGroup.attr("transform",e),this.currentZoom=Ai.transform.k,this.handlers.zoom&&this.handlers.zoom(e)}function i(e,t){Ai.active||t.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}function a(e){e.fx=Ai.x,e.fy=Ai.y}function o(e,t){Ai.active||t.alphaTarget(0),e.fx=void 0,e.fy=void 0}this.options=t,this.links=[],this.nodes=[],this.handlers={},this.svg=ye(e),this.setCenter(),window.addEventListener("resize",()=>this.setCenter()),this.options.nodeRenderer.setup(this.svg),this.svgGroup=this.svg.append("g").attr("id","svgGroup");const r=nt(),l=this.options.charge&&this.options.charge(r)||r.strength(-100).distanceMin(1e3),d=y(),s=this.options.collide&&this.options.collide(d)||d.radius(e=>e.radius||e.width/2||50).iterations(2),c=it(this.center.x),p=this.options.forceX&&this.options.forceX(c)||c.strength(.1),u=at(this.center.y),h=this.options.forceY&&this.options.forceY(u)||u.strength(.1);this.simulation=tt().velocityDecay(this.options.velocityDecay||.55).force("link",Oe().distance(e=>e.distance||100).id(e=>e.id)).force("charge",l).force("collide",s).force("center",be(this.center.x,this.center.y)).force("x",p).force("y",h),this.drag=mt().on("start",e=>i(e,this.simulation)).on("drag",e=>a(e)).on("end",e=>o(e,this.simulation)),this.zoom=li().on("zoom",n.bind(this)),this.svg.call(this.zoom).call(this.drag),this.linkContainer=this.svgGroup.append("g").attr("class","links"),this.nodeContainer=this.svgGroup.append("g").attr("class","nodes"),this.update()}setCenter(){this.center={x:this.svg.node().width.baseVal.value/2,y:this.svg.node().height.baseVal.value/2}}addHandler(e,t){this.handlers[e]=t}update(){function e(e){return ki(xi(e.target.y-e.source.y,2)+xi(e.target.x-e.source.x,2))}function t(e){return e.radius||(e.width+e.height)/4||50}function n(n){const i=e(n),a=n.target.x-n.source.x;return n.source.x+a*(1-(i-t(n.source))/i)}function i(n){const i=e(n),a=n.target.x-n.source.x;return n.target.x-a*(1-(i-t(n.target))/i)}function a(n){const i=e(n),a=n.target.y-n.source.y;return n.source.y+a*(1-(i-t(n.source))/i)}function o(n){const i=e(n),a=n.target.y-n.source.y;return n.target.y-a*(1-(i-t(n.target))/i)}function r(){d.attr("x1",n).attr("y1",a).attr("x2",i).attr("y2",o).attr("class",e=>"level-"+fi(e.source.level,e.target.level)).attr("stroke-width",e=>e.width||1),c.attr("transform",e=>l.getTransformation.call(l,e)).attr("class",e=>l.getClass.call(l,e))}const l=this.options.nodeRenderer;let d=this.linkContainer.selectAll("line").data(this.links,e=>e.id);const s=d.enter().append("line");this.options.useMarkers&&s.attr("marker-start","url(#marker-start)").attr("marker-end","url(#marker-end)"),d.exit().remove(),d=s.merge(d),this.simulation.force("link").links(this.links);let c=this.nodeContainer.selectAll(".node").data(this.nodes,e=>e.id);const p=c.enter().append("g").attr("id",e=>"node-"+e.id).attr("class",l.getClass.bind(l)).call(this.drag).call(function(e){Object.keys(this.handlers).forEach(t=>e.on(t,this.handlers[t]))}.bind(this));c.exit().remove(),p.call(l.render.bind(l)),c=p.merge(c),c.call(l.update.bind(l)),this.simulation.nodes(this.nodes).on("tick",()=>r.bind(this)()),this.simulation.alpha(.3),this.simulation.restart()}getLinkedNodes(e){return this.links.filter(t=>t.source.id===e.id).map(e=>e.target).concat(this.links.filter(t=>t.target.id===e.id).map(e=>e.source))}nodesConnected(e,t){return this.getLinkedNodes(e).some(e=>e.id===t.id)}static isConnected(e,t){return e.source.id===t.id||e.target.id===t.id}add(e,t){e&&e.forEach(e=>!this.nodes.some(t=>t.id===e.id)&&this.nodes.push(e)),t&&t.forEach(e=>!this.nodesConnected(e.source,e.target)&&this.links.push(e))}static equalLinks(e,t){return t.source.id===e.source.id&&t.target.id===e.target.id||t.source.id===e.target.id&&t.target.id===e.source.id}remove(e,t){e.forEach(e=>{this.links=this.links.filter(t=>!Ia.isConnected(t,e)),this.nodes=this.nodes.filter(t=>t.id!==e.id)}),this.links=this.links.filter(e=>!t.some(t=>Ia.equalLinks(e,t)))}getConnections(e){return this.links.filter(t=>t.source.id===e.id||t.target.id===e.id)}updateNode(e){this.nodes=this.nodes.map(t=>t.id===e.id?e:t)}static fixNode(e){e.fx=e.x,e.fy=e.y}static releaseNode(e){e.fx=void 0,e.fy=void 0}scaleToNode(e,t,n=0,i=0){return new Promise(a=>{Ia.fixNode(e);const o=this.center.x+n,r=this.center.y+i;this.svg.transition().duration(1e3).call(this.zoom.transform,La.translate(o,r).scale(t).translate(-e.x,-e.y)).on("end",()=>{Ia.releaseNode(e),a({x:o,y:r})})})}scale(e){return new Promise(t=>{const n=this.svgGroup.node().getAttribute("transform"),i=n&&n.match(/[\d.]+/g).map(e=>+e)||[0,0,1];this.svg.transition().duration(1e3).call(this.zoom.transform,La.translate(e*i[0]-(e-1)*this.center.x,e*i[1]-(e-1)*this.center.y).scale(e*this.currentZoom)).on("end",()=>t(!0))})}hide(){this.svg.attr("style","opacity: 0; position: absolute; transition: opacity 0.5s")}show(){this.svg.attr("style","opacity: 1; transition: opacity 0.5s")}static getDomElement(e){return document.getElementById("node-"+e.id)}}class Ua{constructor(e={imageSuppressionLevel:-1,levelSteps:0}){this.options=e}setup(e){this.defs=e.append("defs")}render(e){this.renderCircle(e.filter(e=>"circle"===e.shape)),this.renderRect(e.filter(e=>"rect"===e.shape)),this.renderTitle(e),this.options.showRefLinks&&this.renderRefLinks(e)}update(){}//eslint-disable-line no-unused-vars
renderCircle(e){e.append("circle").attr("r",e=>e.radius||50).attr("fill",this.getBackground.bind(this))}renderRect(e){e.append("rect").attr("x",e=>(e.width||100)/-2).attr("y",e=>(e.width||70)/-2).attr("width",e=>e.width||100).attr("height",e=>e.height||70).attr("fill",this.getBackground.bind(this))}renderTitle(e){e.append("g").classed("title",!0).append("text").text(e=>e.name).call(e=>this.wrap(e,(e.width||2*e.radius||100)-10))}calculateRefLinkPosition(e){const t=Object.keys(e.links||{}),n=gi/8,a=e.radius||70;return t.map((o,r)=>({type:o,fontSize:e.fontSize,x:a*bi((r-t.length/2)*n),y:a*vi((r-t.length/2)*n)}))}renderRefLinks(e){e.append("g").attr("class","reflinks").selectAll(null).data(this.calculateRefLinkPosition.bind(this)).enter().append("g").attr("transform",e=>`translate(${e.x}, ${e.y})`).attr("data-ref",e=>e.type).append("text").call(this.renderRefLinksContent.bind(this))}renderRefLinksContent(e){e.text(e=>this.options.texts&&this.options.texts[e.type]||e.type).call(e=>this.makeTextBackground(e,!1,15,8))}getBackground(e){const t=0<=this.options.imageSuppressionLevel&&e.level>=this.options.imageSuppressionLevel;return!e.image||t?"#eef":(this.defs.select("#bg-"+e.id).remove(),this.defs.append("pattern").attr("id",()=>"bg-"+e.id).attr("height",1).attr("width",1).append("image").attr("xlink:href",e.image.replace(/ /g,"%20")).attr("height","100px").attr("width","100px").attr("preserveAspectRatio","xMidYMid slice"),"url(#bg-"+e.id+")")}getTransformation(e){const t=this.options.levelSteps?` scale(${1-(e.level||1)*this.options.levelSteps})`:"";return`translate(${[e.x||0,e.y||0]})${t}`}getClass(e){return["node",e.className,e.open&&"open",e.image&&"withBg","level-"+e.level].filter(e=>e).join(" ")}wrap(e,t,n=!1){const i=this;e.each(function(e){e.fontSize=e.fontSize||1;const a=ye(this).attr("style","font-size: "+14*e.fontSize+"px"),o=(e.name||"").split(/[\s-]+/).reverse();let r,l=[],d=a.text(null).append("tspan"),s=0;for(;r=o.pop();)l.push(r),d.text(l.join(" ")),1<l.length&&d.node().getComputedTextLength()>t&&(l.pop(),d.text(l.join(" ")),s++,l=[r],d=a.append("tspan").attr("x",0).attr("dy",1.1+"em").text(r));a.attr("y",.3*-s+"em"),e.bbox=i.makeTextBackground(a,n&&t)})}makeTextBackground(e,t,n=5,i=3){let a;return e.each(function(){const e=document.createElementNS("http://www.w3.org/2000/svg","rect");a=this.getBBox(),e.setAttribute("class","text-bg"),e.setAttribute("x",a.x-n),e.setAttribute("y",a.y-i),e.setAttribute("width",(t||a.width)+2*n),e.setAttribute("height",a.height+2*i),this.parentNode.insertBefore(e,this)}),a}}let Ga=1;const Ha=e=>e.reduce((e,t)=>fi(e,t.id),0)+1,Fa={maxLevel:99999,handlers:{error:()=>{}},logger:console};class Za{constructor(e,t,n={}){"string"==typeof e&&(Fa.logger.warn("Deprecation notice: Using separate parameters for Network constructor is deprecated, use options structure instead."),e={dataUrl:e,domSelector:t,handlers:n}),this.options=Object.assign({},Fa,e),this.options.nodeRenderer=this.options.nodeRenderer||new Ua,hi(this.options.dataUrl,e.fetchOptions).then(e=>this.options.handlers.prepare?this.options.handlers.prepare(e):e).then(e=>{function t(e){return e.source.open||e.target.open||e.source.visible&&e.target.visible}const n=document.querySelector(this.options.domSelector);this.diagram=new Ia(n,this.options),this.options.handlers.showDetails&&(this.details=document.createElement("div"),this.details.setAttribute("class","details"),document.body.append(this.details)),this.options.handlers.clickOnNode=this.options.handlers.clickOnNode||this.showDetails.bind(this),this.options.handlers.clickOnRefLink=this.options.handlers.clickOnRefLink||this.toggleNodes.bind(this),this.nodes=e.nodes,this.links=this.computeLinks(this.nodes),this.links.filter(e=>t(e)).map(function(e){e.source.visible=e.target.visible=e.visible=!0}),this.setDistancesToNode(this.nodes.filter(e=>e.visible)[0]||this.nodes[0]),this.update(),setTimeout(()=>{document.body.classList.add("initialized"),this.options.handlers.initialized&&this.options.handlers.initialized()},0)}).catch(e=>this.options.logger.error(e));const i=this;document.addEventListener("click",function(e){if(!1===i.handleClicks(e))return e.stopImmediatePropagation(),e.preventDefault(),!1})}handleClicks(e){const t=e.path||e.composedPath&&e.composedPath()||[],n={reflinks:e=>this.options.handlers.clickOnRefLink(t[e+1].__data__,t[e-1].dataset.ref),node:e=>this.options.handlers.clickOnNode(t[e].__data__)};return!!Object.keys(n).findIndex(e=>{const i=t.findIndex(n=>n.classList&&n.classList.contains(e));return 0<=i&&n[e](i),0<=i})}computeLinks(e){const t=this.options.handlers.prepareLink||(e=>e);return e.forEach(e=>{e.links=e.links||{},e.linkedNodes={}}),e.map(e=>Object.keys(e.links).map(n=>e.links[n]=e.links[n].map(n=>{if(n.target&&n.target.id)return n;else{const i=this.getNode(n);return e.linkedNodes[i.id]=i,i.linkedNodes[e.id]=e,t({id:Ga++,source:e,target:i})}})).reduce((e,t)=>e.concat(t),[])).reduce((e,t)=>e.concat(t),[])}setLevel(e,t){e.level>t&&(e.level=t,t<this.options.maxLevel&&Object.values(e.linkedNodes).forEach(e=>this.setLevel(e,t+1)))}setDistancesToNode(e){this.nodes.forEach(e=>e.level=this.options.maxLevel),this.setLevel(e,0)}showDetails(e){Ia.fixNode(e);const t=Ia.getDomElement(e),n=document.createElement("div"),i=document.createElement("div");i.setAttribute("class","detailForm"),n.appendChild(i),this.details.appendChild(n);const a=this.options.detailsDialogOffsetX||-175,o=this.options.detailsDialogOffsetY||-30;this.diagram.scaleToNode(e,1.2,a,o).then(({y:i})=>{document.body.classList.add("dialogOpen"),t.classList.add("menuActive"),this.setDistancesToNode(e),n.setAttribute("style","padding-top: "+(i-123)+"px")}).then(()=>e.details?hi(e.details):e).then(t=>this.options.handlers.showDetails(t,i,e)).catch(this.options.logger.error).then(n=>{e=n||e,document.body.classList.remove("dialogOpen"),t.classList.remove("menuActive"),this.details.innerHTML="",this.diagram.updateNode(e),this.diagram.update()})}getNumClosedLinks(e){return Object.keys(e.linkedNodes).length-this.getNumOpenLinks(e)}getNumOpenLinks(e){return this.diagram.links.filter(t=>t.source.id===e.id||t.target.id===e.id).length}toggleNodes(e,t){const n=e.links[t];if(n&&n.length){const e=!n.some(e=>!e.visible);e?n.map(e=>(e.visible=!1,e.target)).filter(e=>!Object.values(e.links).some(e=>e.some(e=>e.visible))).forEach(e=>e.visible=!1):n.forEach(e=>{e.visible=!0,e.target.visible=!0}),this.update()}}showNodes(e,t){const n=(e.links[t]||[]).filter(e=>!e.target.visible).map(e=>e.target).filter(e=>e.visible=!0);n.length&&(e.links[t].forEach(e=>e.visible=!0),this.update())}getNumberOfVisibleConnections(e){return Object.keys(e.links).reduce((t,n)=>t+e.links[n].filter(e=>e.target.visible).length,0)}hideNodes(e,t){const n=(e.links[t]||[]).map(e=>(e.visible=!1,e.target)).filter(e=>e.visible&&1===this.getNumberOfVisibleConnections(e)).filter(e=>!(e.visible=!1));(n.length||e.links[t].length)&&this.update()}toggle(e){return e.open?this.closeNode(e):this.openNode(e)}closeNode(e){e.open=!1,this.links.filter(t=>t.source.id===e.id||t.target.id===e.id).forEach(t=>{const n=t.source.id===e.id?t.target:t.source;1===this.diagram.getLinkedNodes(n).length?n.visible=n.keepVisible:t.visible=!1}),this.diagram.scaleToNode(e,1),this.update()}openNode(e){e.open=!0,this.links.filter(t=>t.source.id===e.id||t.target.id===e.id).forEach(t=>{const n=t.source.id===e.id?t.target:t.source;n.visible=!0,n.x=e.x,n.y=e.y,t.visible=!0}),this.diagram.scaleToNode(e,1),this.update()}addNode(e){const t=this.computeLinks([e]);e.visible=!0,this.nodes.push(e),t.forEach(e=>{e.visible=!0,this.links.push(e)})}removeNode(e){this.nodes=this.nodes.filter(t=>t.id!==e.id),this.links=this.links.filter(t=>t.source.id!==e.id&&t.target.id!==e.id),e.visible=!1,this.update(),this.options.handlers.nodeRemoved&&this.options.handlers.nodeRemoved(e)}getNode(e){return this.nodes.find(t=>t.id===e)}updateNode(e){this.updateNodes([e])}updateNodes(e){this.computeLinks(e),e.forEach(e=>this.diagram.updateNode(e)),this.diagram.update()}scaleToNode(e){this.diagram.scaleToNode(e,1)}addLinks(e){e.forEach(e=>{this.links.push({id:Ga++,source:this.getNode(e.source.id),target:this.getNode(e.target.id)})})}removeLinks(e){const t=(e,t)=>e.source.id===t.source.id&&e.target.id===t.target.id;this.links=this.links.filter(n=>!e.some(e=>t(n,e)))}newConnection(e){this.options.handlers.nameRequired().then(e=>e?e:Promise.reject("no name given")).then(t=>{let n=this.nodes.find(e=>e.name.toLowerCase()===t.toLowerCase());if(n||(n=this.options.handlers.newNode?this.options.handlers.newNode(t):{name:t},n.id=n.id||Ha(this.nodes),this.nodes.push(n),this.diagram.add([n],[])),!this.diagram.nodesConnected(e,n)){const t={id:Ga++,source:e,target:n};this.options.handlers.newLink&&this.options.handlers.newLink(t),this.links.push(t),this.diagram.add([],[t])}this.diagram.update()}).catch(this.options.handlers.error)}update(){this.diagram.links=this.links.filter(e=>e.visible),this.diagram.nodes=this.nodes.filter(e=>e.visible),this.diagram.update()}scale(e){return this.diagram.scale(e)}}window.ForceDiagram=Ia,window.Network=Za,window.NodeRenderer=Ua;return{Network:Za,ForceDiagram:Ia,NodeRenderer:Ua}}();
//# sourceMappingURL=bundle.js.map
