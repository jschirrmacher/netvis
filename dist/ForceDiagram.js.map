{"version":3,"sources":["../ForceDiagram.js"],"names":["currentZoom","ForceDiagram","domSelector","links","nodes","handlers","svg","d3","select","setCenter","window","addEventListener","defs","append","svgGroup","attr","simulation","forceSimulation","velocityDecay","force","forceLink","distance","d","id","forceManyBody","strength","distanceMin","forceCollide","radius","iterations","forceCenter","center","x","y","forceX","forceY","drag","on","handleDragStarted","handleDragged","handleDragEnded","zoom","handleZoom","bind","call","linkContainer","nodeContainer","update","transform","event","k","active","alphaTarget","restart","fx","fy","undefined","node","width","baseVal","value","height","type","handler","linkData","selectAll","data","linkEnter","enter","exit","remove","merge","nodeData","nodeEnter","className","classed","open","image","bindHandlers","filter","shape","addCircleNode","addRectNode","text","name","wrap","handleTicks","alpha","Object","keys","forEach","getBackground","source","target","replace","each","fontSize","words","split","reverse","lineHeight","line","tspan","word","lineCount","pop","push","join","getComputedTextLength","rect","document","createElementNS","bbox","getBBox","setAttribute","parentNode","insertBefore","l","map","concat","node1","node2","getLinkedNodes","some","n","nodesToAdd","linksToAdd","nodesConnected","nodesToRemove","linksToRemove","isConnected","r","assign","splice","findIndex","scale","diffX","diffY","Promise","fixNode","transition","duration","zoomIdentity","translate","releaseNode","resolve","factor","m","getAttribute","match","a","link","getElementById","module","exports"],"mappings":";;;;;;AAAA;AACA,IAAIA,cAAc,CAAlB;;IAEMC,Y;AACJ,wBAAYC,WAAZ,EAAyB;AAAA;;AAAA;;AACvB,SAAKC,KAAL,GAAa,EAAb;AACA,SAAKC,KAAL,GAAa,EAAb;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACA,SAAKC,GAAL,GAAWC,GAAGC,MAAH,CAAUN,WAAV,CAAX;AACA,SAAKO,SAAL;AACAC,WAAOC,gBAAP,CAAwB,QAAxB,EAAkC;AAAA,aAAM,MAAKF,SAAL,EAAN;AAAA,KAAlC;AACA,SAAKG,IAAL,GAAY,KAAKN,GAAL,CAASO,MAAT,CAAgB,MAAhB,CAAZ;AACA,SAAKC,QAAL,GAAgB,KAAKR,GAAL,CACbO,MADa,CACN,GADM,EAEbE,IAFa,CAER,IAFQ,EAEF,UAFE,CAAhB;;AAIA,SAAKC,UAAL,GAAkBT,GAAGU,eAAH,GACfC,aADe,CACD,IADC,EAEfC,KAFe,CAET,MAFS,EAEDZ,GAAGa,SAAH,GAAeC,QAAf,CAAwB;AAAA,aAAKC,EAAED,QAAF,IAAc,GAAnB;AAAA,KAAxB,EAAgDE,EAAhD,CAAmD;AAAA,aAAKD,EAAEC,EAAP;AAAA,KAAnD,CAFC,EAGfJ,KAHe,CAGT,QAHS,EAGCZ,GAAGiB,aAAH,GAAmBC,QAAnB,CAA4B,CAAC,GAA7B,EAAkCC,WAAlC,CAA8C,IAA9C,CAHD,EAIfP,KAJe,CAIT,SAJS,EAIEZ,GAAGoB,YAAH,GAAkBC,MAAlB,CAAyB;AAAA,aAAKN,EAAED,QAAF,IAAc,GAAnB;AAAA,KAAzB,EAAiDQ,UAAjD,CAA4D,CAA5D,CAJF,EAKfV,KALe,CAKT,QALS,EAKCZ,GAAGuB,WAAH,CAAe,KAAKC,MAAL,CAAYC,CAA3B,EAA8B,KAAKD,MAAL,CAAYE,CAA1C,CALD,EAMfd,KANe,CAMT,GANS,EAMJZ,GAAG2B,MAAH,CAAU,KAAKH,MAAL,CAAYC,CAAtB,EAAyBP,QAAzB,CAAkC,GAAlC,CANI,EAOfN,KAPe,CAOT,GAPS,EAOJZ,GAAG4B,MAAH,CAAU,KAAKJ,MAAL,CAAYE,CAAtB,EAAyBR,QAAzB,CAAkC,GAAlC,CAPI,CAAlB;;AASA,SAAKW,IAAL,GAAY7B,GAAG6B,IAAH,GACTC,EADS,CACN,OADM,EACG;AAAA,aAAKC,kBAAkBhB,CAAlB,EAAqB,MAAKN,UAA1B,CAAL;AAAA,KADH,EAETqB,EAFS,CAEN,MAFM,EAEE;AAAA,aAAKE,cAAcjB,CAAd,CAAL;AAAA,KAFF,EAGTe,EAHS,CAGN,KAHM,EAGC;AAAA,aAAKG,gBAAgBlB,CAAhB,EAAmB,MAAKN,UAAxB,CAAL;AAAA,KAHD,CAAZ;;AAKA,SAAKyB,IAAL,GAAYlC,GAAGkC,IAAH,GAAUJ,EAAV,CAAa,MAAb,EAAqBK,WAAWC,IAAX,CAAgB,IAAhB,CAArB,CAAZ;;AAEA,SAAKrC,GAAL,CACGsC,IADH,CACQ,KAAKH,IADb,EAEGG,IAFH,CAEQ,KAAKR,IAFb;;AAIA,SAAKS,aAAL,GAAqB,KAAK/B,QAAL,CAAcD,MAAd,CAAqB,GAArB,EAA0BE,IAA1B,CAA+B,OAA/B,EAAwC,OAAxC,CAArB;AACA,SAAK+B,aAAL,GAAqB,KAAKhC,QAAL,CAAcD,MAAd,CAAqB,GAArB,EAA0BE,IAA1B,CAA+B,OAA/B,EAAwC,OAAxC,CAArB;;AAEA,SAAKgC,MAAL;;AAEA,aAASL,UAAT,GAAsB;AACpB,UAAMM,4BAAyBzC,GAAG0C,KAAH,CAASD,SAAT,CAAmBhB,CAAnB,IAAwB,CAAjD,YAAuDzB,GAAG0C,KAAH,CAASD,SAAT,CAAmBf,CAAnB,IAAwB,CAA/E,kBAA2F1B,GAAG0C,KAAH,CAASD,SAAT,CAAmBE,CAAnB,IAAwB,CAAnH,OAAN;AACA,WAAKpC,QAAL,CAAcC,IAAd,CAAmB,WAAnB,EAAgCiC,SAAhC;AACAhD,oBAAcO,GAAG0C,KAAH,CAASD,SAAT,CAAmBE,CAAjC;AACA,UAAI,KAAK7C,QAAL,CAAcoC,IAAlB,EAAwB;AACtB,aAAKpC,QAAL,CAAcoC,IAAd,CAAmBO,SAAnB;AACD;AACF;;AAED,aAASV,iBAAT,CAA2BhB,CAA3B,EAA8BN,UAA9B,EAA0C;AACxC,UAAI,CAACT,GAAG0C,KAAH,CAASE,MAAd,EAAsB;AACpBnC,mBAAWoC,WAAX,CAAuB,GAAvB,EAA4BC,OAA5B;AACD;AACD/B,QAAEgC,EAAF,GAAOhC,EAAEU,CAAT;AACAV,QAAEiC,EAAF,GAAOjC,EAAEW,CAAT;AACD;;AAED,aAASM,aAAT,CAAuBjB,CAAvB,EAA0B;AACxBA,QAAEgC,EAAF,GAAO/C,GAAG0C,KAAH,CAASjB,CAAhB;AACAV,QAAEiC,EAAF,GAAOhD,GAAG0C,KAAH,CAAShB,CAAhB;AACD;;AAED,aAASO,eAAT,CAAyBlB,CAAzB,EAA4BN,UAA5B,EAAwC;AACtC,UAAI,CAACT,GAAG0C,KAAH,CAASE,MAAd,EAAsB;AACpBnC,mBAAWoC,WAAX,CAAuB,CAAvB;AACD;AACD9B,QAAEgC,EAAF,GAAOE,SAAP;AACAlC,QAAEiC,EAAF,GAAOC,SAAP;AACD;AACF;;;;gCAEW;AACV,WAAKzB,MAAL,GAAc,EAACC,GAAG,KAAK1B,GAAL,CAASmD,IAAT,GAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BC,KAA9B,GAAsC,CAA1C,EAA6C3B,GAAG,KAAK3B,GAAL,CAASmD,IAAT,GAAgBI,MAAhB,CAAuBF,OAAvB,CAA+BC,KAA/B,GAAuC,CAAvF,EAAd;AACD;;;+BAEUE,I,EAAMC,O,EAAS;AACxB,WAAK1D,QAAL,CAAcyD,IAAd,IAAsBC,OAAtB;AACD;;;6BAEQ;AACP,UAAIC,WAAW,KAAKnB,aAAL,CAAmBoB,SAAnB,CAA6B,MAA7B,EAAqCC,IAArC,CAA0C,KAAK/D,KAA/C,EAAsD;AAAA,eAAKmB,EAAEC,EAAP;AAAA,OAAtD,CAAf;AACA,UAAI4C,YAAYH,SAASI,KAAT,GAAiBvD,MAAjB,CAAwB,MAAxB,CAAhB;AACAmD,eAASK,IAAT,GAAgBC,MAAhB;AACAN,iBAAWG,UAAUI,KAAV,CAAgBP,QAAhB,CAAX;AACA,WAAKhD,UAAL,CAAgBG,KAAhB,CAAsB,MAAtB,EAA8BhB,KAA9B,CAAoC,KAAKA,KAAzC;;AAEA,UAAIqE,WAAW,KAAK1B,aAAL,CAAmBmB,SAAnB,CAA6B,OAA7B,EAAsCC,IAAtC,CAA2C,KAAK9D,KAAhD,EAAuD;AAAA,eAAKkB,EAAEC,EAAP;AAAA,OAAvD,CAAf;AACA,UAAIkD,YAAYD,SACbJ,KADa,GAEbvD,MAFa,CAEN,GAFM,EAGbE,IAHa,CAGR,IAHQ,EAGF;AAAA,eAAK,UAAUO,EAAEC,EAAjB;AAAA,OAHE,EAIbR,IAJa,CAIR,OAJQ,EAIC;AAAA,eAAKO,EAAEoD,SAAF,IAAe,EAApB;AAAA,OAJD,EAKbC,OALa,CAKL,MALK,EAKG,IALH,EAMbA,OANa,CAML,MANK,EAMG;AAAA,eAAKrD,EAAEsD,IAAP;AAAA,OANH,EAObD,OAPa,CAOL,QAPK,EAOK;AAAA,eAAKrD,EAAEuD,KAAP;AAAA,OAPL,EAQbjC,IARa,CAQR,KAAKR,IARG,EASbQ,IATa,CASRkC,aAAanC,IAAb,CAAkB,IAAlB,CATQ,CAAhB;;AAWA6B,eAASH,IAAT,GAAgBC,MAAhB;;AAEAG,gBAAUM,MAAV,CAAiB;AAAA,eAAKzD,EAAE0D,KAAF,KAAY,QAAjB;AAAA,OAAjB,EAA4CpC,IAA5C,CAAiDqC,cAActC,IAAd,CAAmB,IAAnB,CAAjD;AACA8B,gBAAUM,MAAV,CAAiB;AAAA,eAAKzD,EAAE0D,KAAF,KAAY,MAAjB;AAAA,OAAjB,EAA0CpC,IAA1C,CAA+CsC,YAAYvC,IAAZ,CAAiB,IAAjB,CAA/C;;AAEA8B,gBAAU5D,MAAV,CAAiB,GAAjB,EACGA,MADH,CACU,MADV,EAEG8D,OAFH,CAEW,OAFX,EAEoB,IAFpB,EAGGQ,IAHH,CAGQ;AAAA,eAAK7D,EAAE8D,IAAP;AAAA,OAHR,EAIGxC,IAJH,CAIQ;AAAA,eAAKyC,KAAK/D,CAAL,EAAQ,EAAR,CAAL;AAAA,OAJR;;AAMAkD,iBAAWC,UAAUF,KAAV,CAAgBC,QAAhB,CAAX;AACA,WAAKxD,UAAL,CAAgBZ,KAAhB,CAAsB,KAAKA,KAA3B,EAAkCiC,EAAlC,CAAqC,MAArC,EAA6C;AAAA,eAAMiD,aAAN;AAAA,OAA7C;;AAEA,WAAKtE,UAAL,CAAgBuE,KAAhB,CAAsB,GAAtB;AACA,WAAKvE,UAAL,CAAgBqC,OAAhB;;AAEA,eAASyB,YAAT,CAAsBrB,IAAtB,EAA4B;AAAA;;AAC1B+B,eAAOC,IAAP,CAAY,KAAKpF,QAAjB,EAA2BqF,OAA3B,CAAmC;AAAA,iBAAQjC,KAAKpB,EAAL,CAAQyB,IAAR,EAAc,OAAKzD,QAAL,CAAcyD,IAAd,CAAd,CAAR;AAAA,SAAnC;AACD;;AAED,eAASmB,aAAT,CAAuBb,KAAvB,EAA8B;AAC5BA,cAAMvD,MAAN,CAAa,QAAb,EACGE,IADH,CACQ,GADR,EACa,EADb,EAEGA,IAFH,CAEQ,MAFR,EAEgB4E,cAAchD,IAAd,CAAmB,IAAnB,CAFhB;AAGD;;AAED,eAASuC,WAAT,CAAqBd,KAArB,EAA4B;AAC1BA,cAAMvD,MAAN,CAAa,MAAb,EACGE,IADH,CACQ,GADR,EACa,CAAC,EADd,EAEGA,IAFH,CAEQ,GAFR,EAEa,CAAC,EAFd,EAGGA,IAHH,CAGQ,OAHR,EAGiB,GAHjB,EAIGA,IAJH,CAIQ,QAJR,EAIkB,EAJlB,EAKGA,IALH,CAKQ,MALR,EAKgB4E,cAAchD,IAAd,CAAmB,IAAnB,CALhB;AAMD;;AAED,eAAS2C,WAAT,GAAuB;AACrBtB,iBACGjD,IADH,CACQ,IADR,EACc;AAAA,iBAAKO,EAAEsE,MAAF,CAAS5D,CAAd;AAAA,SADd,EAEGjB,IAFH,CAEQ,IAFR,EAEc;AAAA,iBAAKO,EAAEsE,MAAF,CAAS3D,CAAd;AAAA,SAFd,EAGGlB,IAHH,CAGQ,IAHR,EAGc;AAAA,iBAAKO,EAAEuE,MAAF,CAAS7D,CAAd;AAAA,SAHd,EAIGjB,IAJH,CAIQ,IAJR,EAIc;AAAA,iBAAKO,EAAEuE,MAAF,CAAS5D,CAAd;AAAA,SAJd;;AAMAuC,iBAASzD,IAAT,CAAc,WAAd,EAA2B;AAAA,iBAAK,eAAe,CAACO,EAAEU,CAAH,EAAMV,EAAEW,CAAR,CAAf,GAA4B,GAAjC;AAAA,SAA3B;AACD;;AAED,eAAS0D,aAAT,CAAuBlC,IAAvB,EAA6B;AAC3B,YAAIA,KAAKoB,KAAT,EAAgB;AACd,eAAKjE,IAAL,CAAUJ,MAAV,CAAiB,SAASiD,KAAKlC,EAA/B,EAAmC+C,MAAnC;AACA,eAAK1D,IAAL,CAAUC,MAAV,CAAiB,SAAjB,EACGE,IADH,CACQ,IADR,EACc;AAAA,mBAAM,QAAQ0C,KAAKlC,EAAnB;AAAA,WADd,EAEGR,IAFH,CAEQ,QAFR,EAEkB,CAFlB,EAEqBA,IAFrB,CAE0B,OAF1B,EAEmC,CAFnC,EAGGF,MAHH,CAGU,OAHV,EAIGE,IAJH,CAIQ,YAJR,EAIsB0C,KAAKoB,KAAL,CAAWiB,OAAX,CAAmB,IAAnB,EAAyB,KAAzB,CAJtB,EAKG/E,IALH,CAKQ,QALR,EAKkB,OALlB,EAK2BA,IAL3B,CAKgC,OALhC,EAKyC,OALzC,EAMGA,IANH,CAMQ,qBANR,EAM+B,gBAN/B;AAOD;;AAED,eAAO0C,KAAKoB,KAAL,GAAa,aAAapB,KAAKlC,EAAlB,GAAuB,GAApC,GAA0C,MAAjD;AACD;;AAED,eAAS8D,IAAT,CAAcF,IAAd,EAAoBzB,KAApB,EAA2B;AACzByB,aAAKY,IAAL,CAAU,UAAUtC,IAAV,EAAgB;AACxBA,eAAKuC,QAAL,GAAgBvC,KAAKuC,QAAL,IAAiB,CAAjC;AACA,cAAMb,OAAO5E,GAAGC,MAAH,CAAU,IAAV,CAAb;AACA,cAAMyF,QAAQ,CAACxC,KAAK2B,IAAL,IAAa,EAAd,EAAkBc,KAAlB,CAAwB,QAAxB,EAAkCC,OAAlC,EAAd;AACA,cAAMC,aAAa,GAAnB;AACA,cAAIC,OAAO,EAAX;AACA,cAAIC,QAAQnB,KAAKA,IAAL,CAAU,IAAV,EAAgBtE,MAAhB,CAAuB,OAAvB,EAAgCE,IAAhC,CAAqC,OAArC,EAA8C,gBAAiB0C,KAAKuC,QAAL,GAAgB,EAAjC,GAAuC,IAArF,CAAZ;AACA,cAAIO,aAAJ;AACA,cAAIC,YAAY,CAAhB;AACA,iBAAQD,OAAON,MAAMQ,GAAN,EAAf,EAA6B;AAC3BJ,iBAAKK,IAAL,CAAUH,IAAV;AACAD,kBAAMnB,IAAN,CAAWkB,KAAKM,IAAL,CAAU,GAAV,CAAX;AACA,gBAAIL,MAAM7C,IAAN,GAAamD,qBAAb,KAAuClD,KAA3C,EAAkD;AAChD2C,mBAAKI,GAAL;AACAH,oBAAMnB,IAAN,CAAWkB,KAAKM,IAAL,CAAU,GAAV,CAAX;AACAH;AACAH,qBAAO,CAACE,IAAD,CAAP;AACAD,sBAAQnB,KAAKtE,MAAL,CAAY,OAAZ,EAAqBE,IAArB,CAA0B,GAA1B,EAA+B,CAA/B,EAAkCA,IAAlC,CAAuC,IAAvC,EAA6CqF,aAAa,IAA1D,EAAgEjB,IAAhE,CAAqEoB,IAArE,EACLxF,IADK,CACA,OADA,EACS,gBAAiB0C,KAAKuC,QAAL,GAAgB,EAAjC,GAAuC,IADhD,CAAR;AAED;AACF;AACDb,eAAKpE,IAAL,CAAU,GAAV,EAAgB,CAACyF,SAAD,GAAa,GAAd,GAAqB,IAApC;;AAEA,cAAMK,OAAOC,SAASC,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAb;AACA,cAAMC,OAAO,KAAKC,OAAL,EAAb;AACAJ,eAAKK,YAAL,CAAkB,OAAlB,EAA2B,SAA3B;AACAL,eAAKK,YAAL,CAAkB,GAAlB,EAAuBF,KAAKhF,CAAL,GAAS,CAAhC;AACA6E,eAAKK,YAAL,CAAkB,GAAlB,EAAuBF,KAAK/E,CAAL,GAAS,CAAhC;AACA4E,eAAKK,YAAL,CAAkB,OAAlB,EAA2BF,KAAKtD,KAAL,GAAa,EAAxC;AACAmD,eAAKK,YAAL,CAAkB,QAAlB,EAA4BF,KAAKnD,MAAL,GAAc,CAA1C;AACAsB,eAAK1B,IAAL,GAAY0D,UAAZ,CAAuBC,YAAvB,CAAoCP,IAApC,EAA0C,IAA1C;AACD,SA/BD;AAgCD;AACF;;;mCAEcpD,I,EAAM;AACnB,aAAO,KAAKtD,KAAL,CAAW4E,MAAX,CAAkB;AAAA,eAAKsC,EAAEzB,MAAF,CAASrE,EAAT,KAAgBkC,KAAKlC,EAA1B;AAAA,OAAlB,EAAgD+F,GAAhD,CAAoD;AAAA,eAAKD,EAAExB,MAAP;AAAA,OAApD,EACJ0B,MADI,CACG,KAAKpH,KAAL,CAAW4E,MAAX,CAAkB;AAAA,eAAKsC,EAAExB,MAAF,CAAStE,EAAT,KAAgBkC,KAAKlC,EAA1B;AAAA,OAAlB,EAAgD+F,GAAhD,CAAoD;AAAA,eAAKD,EAAEzB,MAAP;AAAA,OAApD,CADH,CAAP;AAED;;;mCAEc4B,K,EAAOC,K,EAAO;AAC3B,aAAO,KAAKC,cAAL,CAAoBF,KAApB,EAA2BG,IAA3B,CAAgC;AAAA,eAAKC,EAAErG,EAAF,KAASkG,MAAMlG,EAApB;AAAA,OAAhC,CAAP;AACD;;;wBAMGsG,U,EAAYC,U,EAAY;AAAA;;AAC1B,UAAID,UAAJ,EAAgB;AACdA,mBAAWnC,OAAX,CAAmB;AAAA,iBAAK,CAAC,OAAKtF,KAAL,CAAWuH,IAAX,CAAgB;AAAA,mBAAKrG,EAAEC,EAAF,KAASqG,EAAErG,EAAhB;AAAA,WAAhB,CAAD,IAAwC,OAAKnB,KAAL,CAAWsG,IAAX,CAAgBkB,CAAhB,CAA7C;AAAA,SAAnB;AACD;AACD,UAAIE,UAAJ,EAAgB;AACdA,mBAAWpC,OAAX,CAAmB;AAAA,iBAAK,CAAC,OAAKqC,cAAL,CAAoBV,EAAEzB,MAAtB,EAA8ByB,EAAExB,MAAhC,CAAD,IAA4C,OAAK1F,KAAL,CAAWuG,IAAX,CAAgBW,CAAhB,CAAjD;AAAA,SAAnB;AACD;AACF;;;2BAEMW,a,EAAeC,a,EAAe;AAAA;;AACnCD,oBAActC,OAAd,CAAsB,gBAAQ;AAC5B,eAAKvF,KAAL,GAAa,OAAKA,KAAL,CAAW4E,MAAX,CAAkB;AAAA,iBAAK,CAAC9E,aAAaiI,WAAb,CAAyBb,CAAzB,EAA4B5D,IAA5B,CAAN;AAAA,SAAlB,CAAb;AACA,eAAKrD,KAAL,GAAa,OAAKA,KAAL,CAAW2E,MAAX,CAAkB;AAAA,iBAAK6C,EAAErG,EAAF,KAASkC,KAAKlC,EAAnB;AAAA,SAAlB,CAAb;AACD,OAHD;AAIA,WAAKpB,KAAL,GAAa,KAAKA,KAAL,CAAW4E,MAAX,CAAkB;AAAA,eAAK,CAACkD,cAAcN,IAAd,CAAmB,aAAK;AAC3D,iBAAQQ,EAAEvC,MAAF,CAASrE,EAAT,KAAgB8F,EAAEzB,MAAF,CAASrE,EAAzB,IAA+B4G,EAAEtC,MAAF,CAAStE,EAAT,KAAgB8F,EAAExB,MAAF,CAAStE,EAAzD,IACD4G,EAAEvC,MAAF,CAASrE,EAAT,KAAgB8F,EAAExB,MAAF,CAAStE,EAAzB,IAA+B4G,EAAEvC,MAAF,CAASrE,EAAT,KAAgB8F,EAAEzB,MAAF,CAASrE,EAD9D;AAED,SAHoC,CAAN;AAAA,OAAlB,CAAb;AAID;;;+BAEUkC,I,EAAM;AACfA,aAAO+B,OAAO4C,MAAP,CAAc,KAAKhI,KAAL,CAAWiI,MAAX,CAAkB,KAAKjI,KAAL,CAAWkI,SAAX,CAAqB;AAAA,eAAKV,EAAErG,EAAF,KAASkC,KAAKlC,EAAnB;AAAA,OAArB,CAAlB,EAA+D,CAA/D,EAAkE,CAAlE,CAAd,EAAoFkC,IAApF,CAAP;AACA,WAAKV,MAAL;AACA,WAAK3C,KAAL,CAAWsG,IAAX,CAAgBjD,IAAhB;AACD;;;gCAYWA,I,EAAM8E,K,EAA6B;AAAA;;AAAA,UAAtBC,KAAsB,uEAAd,CAAc;AAAA,UAAXC,KAAW,uEAAH,CAAG;;AAC7C,aAAO,IAAIC,OAAJ,CAAY,mBAAW;AAC5BzI,qBAAa0I,OAAb,CAAqBlF,IAArB;AACA,eAAKnD,GAAL,CAASsI,UAAT,GAAsBC,QAAtB,CAA+B,IAA/B,EACGjG,IADH,CACQ,OAAKH,IAAL,CAAUO,SADlB,EAC6BzC,GAAGuI,YAAH,CACxBC,SADwB,CACd,OAAKhH,MAAL,CAAYC,CAAZ,GAAgBwG,KADF,EACS,OAAKzG,MAAL,CAAYE,CAAZ,GAAgBwG,KADzB,EAExBF,KAFwB,CAElBA,KAFkB,EAGxBQ,SAHwB,CAGd,CAACtF,KAAKzB,CAHQ,EAGL,CAACyB,KAAKxB,CAHD,CAD7B,EAMGI,EANH,CAMM,KANN,EAMa,YAAM;AACfpC,uBAAa+I,WAAb,CAAyBvF,IAAzB;AACAwF,kBAAQ,IAAR;AACD,SATH;AAUD,OAZM,CAAP;AAaD;;;0BAEKC,M,EAAQ;AAAA;;AACZ,aAAO,IAAIR,OAAJ,CAAY,mBAAW;AAC5B,YAAMS,IAAI,OAAKrI,QAAL,CAAc2C,IAAd,GAAqB2F,YAArB,CAAkC,WAAlC,CAAV;AACA,YAAM9H,IAAK6H,KAAKA,EAAEE,KAAF,CAAQ,SAAR,EAAmB/B,GAAnB,CAAuB;AAAA,iBAAK,CAACgC,CAAN;AAAA,SAAvB,CAAN,IAA0C,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAApD;AACA,eAAKhJ,GAAL,CAASsI,UAAT,GAAsBC,QAAtB,CAA+B,IAA/B,EACGjG,IADH,CACQ,OAAKH,IAAL,CAAUO,SADlB,EAC6BzC,GAAGuI,YAAH,CACxBC,SADwB,CACdG,SAAS5H,EAAE,CAAF,CAAT,GAAgB,CAAC4H,SAAS,CAAV,IAAe,OAAKnH,MAAL,CAAYC,CAD7B,EACgCkH,SAAS5H,EAAE,CAAF,CAAT,GAAgB,CAAC4H,SAAS,CAAV,IAAe,OAAKnH,MAAL,CAAYE,CAD3E,EAExBsG,KAFwB,CAElBW,SAASlJ,WAFS,CAD7B,EAIGqC,EAJH,CAIM,KAJN,EAIa;AAAA,iBAAM4G,QAAQ,IAAR,CAAN;AAAA,SAJb;AAKD,OARM,CAAP;AASD;;;2BAEM;AACL,WAAK3I,GAAL,CAASS,IAAT,CAAc,OAAd,EAAuB,0DAAvB;AACD;;;2BAEM;AACL,WAAKT,GAAL,CAASS,IAAT,CAAc,OAAd,EAAuB,sCAAvB;AACD;;;gCA1EkBwI,I,EAAM9F,I,EAAM;AAC7B,aAAO8F,KAAK3D,MAAL,CAAYrE,EAAZ,KAAmBkC,KAAKlC,EAAxB,IAA8BgI,KAAK1D,MAAL,CAAYtE,EAAZ,KAAmBkC,KAAKlC,EAA7D;AACD;;;4BA4BckC,I,EAAM;AACnBA,WAAKH,EAAL,GAAUG,KAAKzB,CAAf;AACAyB,WAAKF,EAAL,GAAUE,KAAKxB,CAAf;AACD;;;gCAEkBwB,I,EAAM;AACvBA,WAAKH,EAAL,GAAUE,SAAV;AACAC,WAAKF,EAAL,GAAUC,SAAV;AACD;;;kCAsCoBC,I,EAAM;AACzB,aAAOqD,SAAS0C,cAAT,CAAwB,UAAU/F,KAAKlC,EAAvC,CAAP;AACD;;;;;;AAGHkI,OAAOC,OAAP,GAAiBzJ,YAAjB","file":"ForceDiagram.js","sourcesContent":["/*global d3, window, module*/\nlet currentZoom = 1\n\nclass ForceDiagram {\n  constructor(domSelector) {\n    this.links = []\n    this.nodes = []\n    this.handlers = {}\n    this.svg = d3.select(domSelector)\n    this.setCenter()\n    window.addEventListener('resize', () => this.setCenter())\n    this.defs = this.svg.append('defs')\n    this.svgGroup = this.svg\n      .append('g')\n      .attr('id', 'svgGroup')\n\n    this.simulation = d3.forceSimulation()\n      .velocityDecay(0.55)\n      .force('link', d3.forceLink().distance(d => d.distance || 100).id(d => d.id))\n      .force('charge', d3.forceManyBody().strength(-100).distanceMin(1000))\n      .force('collide', d3.forceCollide().radius(d => d.distance || 100).iterations(2))\n      .force('center', d3.forceCenter(this.center.x, this.center.y))\n      .force('x', d3.forceX(this.center.x).strength(0.1))\n      .force('y', d3.forceY(this.center.y).strength(0.1))\n\n    this.drag = d3.drag()\n      .on('start', d => handleDragStarted(d, this.simulation))\n      .on('drag', d => handleDragged(d))\n      .on('end', d => handleDragEnded(d, this.simulation))\n\n    this.zoom = d3.zoom().on('zoom', handleZoom.bind(this))\n\n    this.svg\n      .call(this.zoom)\n      .call(this.drag)\n\n    this.linkContainer = this.svgGroup.append('g').attr('class', 'links')\n    this.nodeContainer = this.svgGroup.append('g').attr('class', 'nodes')\n\n    this.update()\n\n    function handleZoom() {\n      const transform = `translate(${d3.event.transform.x || 0}, ${d3.event.transform.y || 0}) scale(${d3.event.transform.k || 1})`\n      this.svgGroup.attr('transform', transform)\n      currentZoom = d3.event.transform.k\n      if (this.handlers.zoom) {\n        this.handlers.zoom(transform)\n      }\n    }\n\n    function handleDragStarted(d, simulation) {\n      if (!d3.event.active) {\n        simulation.alphaTarget(0.3).restart()\n      }\n      d.fx = d.x\n      d.fy = d.y\n    }\n\n    function handleDragged(d) {\n      d.fx = d3.event.x\n      d.fy = d3.event.y\n    }\n\n    function handleDragEnded(d, simulation) {\n      if (!d3.event.active) {\n        simulation.alphaTarget(0)\n      }\n      d.fx = undefined\n      d.fy = undefined\n    }\n  }\n\n  setCenter() {\n    this.center = {x: this.svg.node().width.baseVal.value / 2, y: this.svg.node().height.baseVal.value / 2}\n  }\n\n  addHandler(type, handler) {\n    this.handlers[type] = handler\n  }\n\n  update() {\n    let linkData = this.linkContainer.selectAll('line').data(this.links, d => d.id)\n    let linkEnter = linkData.enter().append('line')\n    linkData.exit().remove()\n    linkData = linkEnter.merge(linkData)\n    this.simulation.force('link').links(this.links)\n\n    let nodeData = this.nodeContainer.selectAll('.node').data(this.nodes, d => d.id)\n    let nodeEnter = nodeData\n      .enter()\n      .append('g')\n      .attr('id', d => 'node-' + d.id)\n      .attr('class', d => d.className || '')\n      .classed('node', true)\n      .classed('open', d => d.open)\n      .classed('withBg', d => d.image)\n      .call(this.drag)\n      .call(bindHandlers.bind(this))\n\n    nodeData.exit().remove()\n\n    nodeEnter.filter(d => d.shape === 'circle').call(addCircleNode.bind(this))\n    nodeEnter.filter(d => d.shape === 'rect').call(addRectNode.bind(this))\n\n    nodeEnter.append('g')\n      .append('text')\n      .classed('title', true)\n      .text(d => d.name)\n      .call(d => wrap(d, 90))\n\n    nodeData = nodeEnter.merge(nodeData)\n    this.simulation.nodes(this.nodes).on('tick', () => handleTicks())\n\n    this.simulation.alpha(0.3)\n    this.simulation.restart()\n\n    function bindHandlers(node) {\n      Object.keys(this.handlers).forEach(type => node.on(type, this.handlers[type]))\n    }\n\n    function addCircleNode(enter) {\n      enter.append('circle')\n        .attr('r', 50)\n        .attr('fill', getBackground.bind(this))\n    }\n\n    function addRectNode(enter) {\n      enter.append('rect')\n        .attr('x', -50)\n        .attr('y', -35)\n        .attr('width', 100)\n        .attr('height', 70)\n        .attr('fill', getBackground.bind(this))\n    }\n\n    function handleTicks() {\n      linkData\n        .attr('x1', d => d.source.x)\n        .attr('y1', d => d.source.y)\n        .attr('x2', d => d.target.x)\n        .attr('y2', d => d.target.y)\n\n      nodeData.attr('transform', d => 'translate(' + [d.x, d.y] + ')')\n    }\n\n    function getBackground(node) {\n      if (node.image) {\n        this.defs.select('#bg-' + node.id).remove()\n        this.defs.append('pattern')\n          .attr('id', () => 'bg-' + node.id)\n          .attr('height', 1).attr('width', 1)\n          .append('image')\n          .attr('xlink:href', node.image.replace(/ /g, '%20'))\n          .attr('height', '100px').attr('width', '100px')\n          .attr('preserveAspectRatio', 'xMidYMid slice')\n      }\n\n      return node.image ? 'url(#bg-' + node.id + ')' : '#eef'\n    }\n\n    function wrap(text, width) {\n      text.each(function (node) {\n        node.fontSize = node.fontSize || 1\n        const text = d3.select(this)\n        const words = (node.name || '').split(/[\\s-]+/).reverse()\n        const lineHeight = 1.1\n        let line = []\n        let tspan = text.text(null).append('tspan').attr('style', 'font-size: ' + (node.fontSize * 14) + 'px')\n        let word\n        let lineCount = 0\n        while ((word = words.pop())) {\n          line.push(word)\n          tspan.text(line.join(' '))\n          if (tspan.node().getComputedTextLength() > width) {\n            line.pop()\n            tspan.text(line.join(' '))\n            lineCount++\n            line = [word]\n            tspan = text.append('tspan').attr('x', 0).attr('dy', lineHeight + 'em').text(word)\n              .attr('style', 'font-size: ' + (node.fontSize * 14) + 'px')\n          }\n        }\n        text.attr('y', (-lineCount * 0.3) + 'em')\n\n        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect')\n        const bbox = this.getBBox()\n        rect.setAttribute('class', 'text-bg')\n        rect.setAttribute('x', bbox.x - 5)\n        rect.setAttribute('y', bbox.y - 3)\n        rect.setAttribute('width', bbox.width + 10)\n        rect.setAttribute('height', bbox.height + 6)\n        text.node().parentNode.insertBefore(rect, this)\n      })\n    }\n  }\n\n  getLinkedNodes(node) {\n    return this.links.filter(l => l.source.id === node.id).map(l => l.target)\n      .concat(this.links.filter(l => l.target.id === node.id).map(l => l.source))\n  }\n\n  nodesConnected(node1, node2) {\n    return this.getLinkedNodes(node1).some(n => n.id === node2.id)\n  }\n\n  static isConnected(link, node) {\n    return link.source.id === node.id || link.target.id === node.id\n  }\n\n  add(nodesToAdd, linksToAdd) {\n    if (nodesToAdd) {\n      nodesToAdd.forEach(n => !this.nodes.some(d => d.id === n.id) && this.nodes.push(n))\n    }\n    if (linksToAdd) {\n      linksToAdd.forEach(l => !this.nodesConnected(l.source, l.target) && this.links.push(l))\n    }\n  }\n\n  remove(nodesToRemove, linksToRemove) {\n    nodesToRemove.forEach(node => {\n      this.links = this.links.filter(l => !ForceDiagram.isConnected(l, node))\n      this.nodes = this.nodes.filter(n => n.id !== node.id)\n    })\n    this.links = this.links.filter(l => !linksToRemove.some(r => {\n      return (r.source.id === l.source.id && r.target.id === l.target.id)\n        || (r.source.id === l.target.id && r.source.id === l.source.id)\n    }))\n  }\n\n  updateNode(node) {\n    node = Object.assign(this.nodes.splice(this.nodes.findIndex(n => n.id === node.id), 1)[0], node)\n    this.update()\n    this.nodes.push(node)\n  }\n\n  static fixNode(node) {\n    node.fx = node.x\n    node.fy = node.y\n  }\n\n  static releaseNode(node) {\n    node.fx = undefined\n    node.fy = undefined\n  }\n\n  scaleToNode(node, scale, diffX = 0, diffY = 0) {\n    return new Promise(resolve => {\n      ForceDiagram.fixNode(node)\n      this.svg.transition().duration(1000)\n        .call(this.zoom.transform, d3.zoomIdentity\n          .translate(this.center.x + diffX, this.center.y + diffY)\n          .scale(scale)\n          .translate(-node.x, -node.y)\n        )\n        .on('end', () => {\n          ForceDiagram.releaseNode(node)\n          resolve(true)\n        })\n    })\n  }\n\n  scale(factor) {\n    return new Promise(resolve => {\n      const m = this.svgGroup.node().getAttribute('transform')\n      const d = (m && m.match(/[\\d.]+/g).map(a => +a)) || [0, 0, 1]\n      this.svg.transition().duration(1000)\n        .call(this.zoom.transform, d3.zoomIdentity\n          .translate(factor * d[0] - (factor - 1) * this.center.x, factor * d[1] - (factor - 1) * this.center.y)\n          .scale(factor * currentZoom))\n        .on('end', () => resolve(true))\n    })\n  }\n\n  hide() {\n    this.svg.attr('style', 'opacity: 0; position: absolute; transition: opacity 0.5s')\n  }\n\n  show() {\n    this.svg.attr('style', 'opacity: 1; transition: opacity 0.5s')\n  }\n\n  static getDomElement(node) {\n    return document.getElementById('node-' + node.id)\n  }\n}\n\nmodule.exports = ForceDiagram\n"]}